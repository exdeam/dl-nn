function getQueryStringParams(e){if(null==e)var t=window.location.search.substr(1);else if(e=e.split("?"),null!=e[1])var t=e[1];else var t="";for(var a=t.split("&"),n={},r=0;r<a.length;r++){var i=a[r].split("=");n[i[0]]=Url.decode(i[1])}return n}function convertImageToCanvas(e,t){var a=document.createElement("canvas"),n=e.naturalWidth,r=e.naturalHeight,i=1;return t&&(i=n>r?t/n:t/r),i<1&&(n=parseInt(n*i),r=parseInt(r*i)),a.width=n,a.height=r,a.getContext("2d").drawImage(e,0,0,n,r),a}function convertCanvasToImage(e,t,a){var n=new Image;return n.src=e.toDataURL("image/"+t,a),n}function twoDigits(e){return 0<=e&&e<10?"0"+e.toString():-10<e&&e<0?"-0"+(-1*e).toString():e.toString()}function renderRecaptchas(){var e=setInterval(function(){(chat.isOpened()||"support"!=chat.type)&&(clearInterval(e),chat.captcha.ready())},500)}!function(e,t){function a(e){return E.isWindow(e)?e:9===e.nodeType&&(e.defaultView||e.parentWindow)}function n(e){if(!yt[e]){var t=N.body,a=E("<"+e+">").appendTo(t),n=a.css("display");a.remove(),"none"!==n&&""!==n||(ft||(ft=N.createElement("iframe"),ft.frameBorder=ft.width=ft.height=0),t.appendChild(ft),mt&&ft.createElement||(mt=(ft.contentWindow||ft.contentDocument).document,mt.write(("CSS1Compat"===N.compatMode?"<!doctype html>":"")+"<html><body>"),mt.close()),a=mt.createElement(e),mt.body.appendChild(a),n=E.css(a,"display"),t.removeChild(ft)),yt[e]=n}return yt[e]}function r(e,t){var a={};return E.each(Ct.concat.apply([],Ct.slice(0,t)),function(){a[this]=e}),a}function i(){vt=t}function o(){return setTimeout(i,0),vt=E.now()}function s(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}function c(){try{return new e.XMLHttpRequest}catch(e){}}function l(e,a){e.dataFilter&&(a=e.dataFilter(a,e.dataType));var n,r,i,o,s,c,l,u,h=e.dataTypes,d={},p=h.length,f=h[0];for(n=1;n<p;n++){if(1===n)for(r in e.converters)"string"==typeof r&&(d[r.toLowerCase()]=e.converters[r]);if(o=f,f=h[n],"*"===f)f=o;else if("*"!==o&&o!==f){if(s=o+" "+f,c=d[s]||d["* "+f],!c){u=t;for(l in d)if(i=l.split(" "),(i[0]===o||"*"===i[0])&&(u=d[i[1]+" "+f])){l=d[l],l===!0?c=u:u===!0&&(c=l);break}}!c&&!u&&E.error("No conversion from "+s.replace(" "," to ")),c!==!0&&(a=c?c(a):u(l(a)))}}return a}function u(e,a,n){var r,i,o,s,c=e.contents,l=e.dataTypes,u=e.responseFields;for(i in u)i in n&&(a[u[i]]=n[i]);for(;"*"===l[0];)l.shift(),r===t&&(r=e.mimeType||a.getResponseHeader("content-type"));if(r)for(i in c)if(c[i]&&c[i].test(r)){l.unshift(i);break}if(l[0]in n)o=l[0];else{for(i in n){if(!l[0]||e.converters[i+" "+l[0]]){o=i;break}s||(s=i)}o=o||s}if(o)return o!==l[0]&&l.unshift(o),n[o]}function h(e,t,a,n){if(E.isArray(t))E.each(t,function(t,r){a||Ve.test(e)?n(e,r):h(e+"["+("object"==typeof r||E.isArray(r)?t:"")+"]",r,a,n)});else if(a||null==t||"object"!=typeof t)n(e,t);else for(var r in t)h(e+"["+r+"]",t[r],a,n)}function d(e,a){var n,r,i=E.ajaxSettings.flatOptions||{};for(n in a)a[n]!==t&&((i[n]?e:r||(r={}))[n]=a[n]);r&&E.extend(!0,e,r)}function p(e,a,n,r,i,o){i=i||a.dataTypes[0],o=o||{},o[i]=!0;for(var s,c=e[i],l=0,u=c?c.length:0,h=e===ot;l<u&&(h||!s);l++)s=c[l](a,n,r),"string"==typeof s&&(!h||o[s]?s=t:(a.dataTypes.unshift(s),s=p(e,a,n,r,s,o)));return(h||!s)&&!o["*"]&&(s=p(e,a,n,r,"*",o)),s}function f(e){return function(t,a){if("string"!=typeof t&&(a=t,t="*"),E.isFunction(a))for(var n,r,i,o=t.toLowerCase().split(at),s=0,c=o.length;s<c;s++)n=o[s],i=/^\+/.test(n),i&&(n=n.substr(1)||"*"),r=e[n]=e[n]||[],r[i?"unshift":"push"](a)}}function m(e,t,a){var n="width"===t?e.offsetWidth:e.offsetHeight,r="width"===t?He:We,i=0,o=r.length;if(n>0){if("border"!==a)for(;i<o;i++)a||(n-=parseFloat(E.css(e,"padding"+r[i]))||0),"margin"===a?n+=parseFloat(E.css(e,a+r[i]))||0:n-=parseFloat(E.css(e,"border"+r[i]+"Width"))||0;return n+"px"}if(n=Oe(e,t,t),(n<0||null==n)&&(n=e.style[t]||0),n=parseFloat(n)||0,a)for(;i<o;i++)n+=parseFloat(E.css(e,"padding"+r[i]))||0,"padding"!==a&&(n+=parseFloat(E.css(e,"border"+r[i]+"Width"))||0),"margin"===a&&(n+=parseFloat(E.css(e,a+r[i]))||0);return n+"px"}function g(e,t){t.src?E.ajax({url:t.src,async:!1,dataType:"script"}):E.globalEval((t.text||t.textContent||t.innerHTML||"").replace(Pe,"/*$0*/")),t.parentNode&&t.parentNode.removeChild(t)}function v(e){var t=N.createElement("div");return De.appendChild(t),t.innerHTML=e.outerHTML,t.firstChild}function y(e){var t=(e.nodeName||"").toLowerCase();"input"===t?b(e):"script"!==t&&"undefined"!=typeof e.getElementsByTagName&&E.grep(e.getElementsByTagName("input"),b)}function b(e){"checkbox"!==e.type&&"radio"!==e.type||(e.defaultChecked=e.checked)}function w(e){return"undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName("*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll("*"):[]}function C(e,t){var a;1===t.nodeType&&(t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(e),a=t.nodeName.toLowerCase(),"object"===a?t.outerHTML=e.outerHTML:"input"!==a||"checkbox"!==e.type&&"radio"!==e.type?"option"===a?t.selected=e.defaultSelected:"input"!==a&&"textarea"!==a||(t.defaultValue=e.defaultValue):(e.checked&&(t.defaultChecked=t.checked=e.checked),t.value!==e.value&&(t.value=e.value)),t.removeAttribute(E.expando))}function T(e,t){if(1===t.nodeType&&E.hasData(e)){var a,n,r,i=E._data(e),o=E._data(t,i),s=i.events;if(s){delete o.handle,o.events={};for(a in s)for(n=0,r=s[a].length;n<r;n++)E.event.add(t,a+(s[a][n].namespace?".":"")+s[a][n].namespace,s[a][n],s[a][n].data)}o.data&&(o.data=E.extend({},o.data))}}function k(e,t){return E.nodeName(e,"table")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function x(e){var t=me.split("|"),a=e.createDocumentFragment();if(a.createElement)for(;t.length;)a.createElement(t.pop());return a}function $(e,t,a){if(t=t||0,E.isFunction(t))return E.grep(e,function(e,n){var r=!!t.call(e,n,e);return r===a});if(t.nodeType)return E.grep(e,function(e,n){return e===t===a});if("string"==typeof t){var n=E.grep(e,function(e){return 1===e.nodeType});if(he.test(t))return E.filter(t,n,!a);t=E.filter(t,n)}return E.grep(e,function(e,n){return E.inArray(e,t)>=0===a})}function S(e){return!e||!e.parentNode||11===e.parentNode.nodeType}function P(){return!0}function I(){return!1}function D(e,t,a){var n=t+"defer",r=t+"queue",i=t+"mark",o=E._data(e,n);o&&("queue"===a||!E._data(e,r))&&("mark"===a||!E._data(e,i))&&setTimeout(function(){!E._data(e,r)&&!E._data(e,i)&&(E.removeData(e,n,!0),o.fire())},0)}function O(e){for(var t in e)if(("data"!==t||!E.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function M(e,a,n){if(n===t&&1===e.nodeType){var r="data-"+a.replace(H,"-$1").toLowerCase();if(n=e.getAttribute(r),"string"==typeof n){try{n="true"===n||"false"!==n&&("null"===n?null:E.isNumeric(n)?parseFloat(n):_.test(n)?E.parseJSON(n):n)}catch(e){}E.data(e,a,n)}else n=t}return n}function A(e){var t,a,n=R[e]={};for(e=e.split(/\s+/),t=0,a=e.length;t<a;t++)n[e[t]]=!0;return n}var N=e.document,F=e.navigator,L=e.location,E=function(){function a(){if(!s.isReady){try{N.documentElement.doScroll("left")}catch(e){return void setTimeout(a,1)}s.ready()}}var n,r,i,o,s=function(e,t){return new s.fn.init(e,t,n)},c=e.jQuery,l=e.$,u=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,h=/\S/,d=/^\s+/,p=/\s+$/,f=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,m=/^[\],:{}\s]*$/,g=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,v=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,y=/(?:^|:|,)(?:\s*\[)+/g,b=/(webkit)[ \/]([\w.]+)/,w=/(opera)(?:.*version)?[ \/]([\w.]+)/,C=/(msie) ([\w.]+)/,T=/(mozilla)(?:.*? rv:([\w.]+))?/,k=/-([a-z]|[0-9])/gi,x=/^-ms-/,$=function(e,t){return(t+"").toUpperCase()},S=F.userAgent,P=Object.prototype.toString,I=Object.prototype.hasOwnProperty,D=Array.prototype.push,O=Array.prototype.slice,M=String.prototype.trim,A=Array.prototype.indexOf,L={};return s.fn=s.prototype={constructor:s,init:function(e,a,n){var r,i,o,c;if(!e)return this;if(e.nodeType)return this.context=this[0]=e,this.length=1,this;if("body"===e&&!a&&N.body)return this.context=N,this[0]=N.body,this.selector=e,this.length=1,this;if("string"==typeof e){if(r="<"!==e.charAt(0)||">"!==e.charAt(e.length-1)||e.length<3?u.exec(e):[null,e,null],r&&(r[1]||!a)){if(r[1])return a=a instanceof s?a[0]:a,c=a?a.ownerDocument||a:N,o=f.exec(e),o?s.isPlainObject(a)?(e=[N.createElement(o[1])],s.fn.attr.call(e,a,!0)):e=[c.createElement(o[1])]:(o=s.buildFragment([r[1]],[c]),e=(o.cacheable?s.clone(o.fragment):o.fragment).childNodes),s.merge(this,e);if(i=N.getElementById(r[2]),i&&i.parentNode){if(i.id!==r[2])return n.find(e);this.length=1,this[0]=i}return this.context=N,this.selector=e,this}return!a||a.jquery?(a||n).find(e):this.constructor(a).find(e)}return s.isFunction(e)?n.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),s.makeArray(e,this))},selector:"",jquery:"1.7.1",length:0,size:function(){return this.length},toArray:function(){return O.call(this,0)},get:function(e){return null==e?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,a){var n=this.constructor();return s.isArray(e)?D.apply(n,e):s.merge(n,e),n.prevObject=this,n.context=this.context,"find"===t?n.selector=this.selector+(this.selector?" ":"")+a:t&&(n.selector=this.selector+"."+t+"("+a+")"),n},each:function(e,t){return s.each(this,e,t)},ready:function(e){return s.bindReady(),i.add(e),this},eq:function(e){return e=+e,e===-1?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(O.apply(this,arguments),"slice",O.call(arguments).join(","))},map:function(e){return this.pushStack(s.map(this,function(t,a){return e.call(t,a,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:D,sort:[].sort,splice:[].splice},s.fn.init.prototype=s.fn,s.extend=s.fn.extend=function(){var e,a,n,r,i,o,c=arguments[0]||{},l=1,u=arguments.length,h=!1;for("boolean"==typeof c&&(h=c,c=arguments[1]||{},l=2),"object"!=typeof c&&!s.isFunction(c)&&(c={}),u===l&&(c=this,--l);l<u;l++)if(null!=(e=arguments[l]))for(a in e)n=c[a],r=e[a],c!==r&&(h&&r&&(s.isPlainObject(r)||(i=s.isArray(r)))?(i?(i=!1,o=n&&s.isArray(n)?n:[]):o=n&&s.isPlainObject(n)?n:{},c[a]=s.extend(h,o,r)):r!==t&&(c[a]=r));return c},s.extend({noConflict:function(t){return e.$===s&&(e.$=l),t&&e.jQuery===s&&(e.jQuery=c),s},isReady:!1,readyWait:1,holdReady:function(e){e?s.readyWait++:s.ready(!0)},ready:function(e){if(e===!0&&!--s.readyWait||e!==!0&&!s.isReady){if(!N.body)return setTimeout(s.ready,1);if(s.isReady=!0,e!==!0&&--s.readyWait>0)return;i.fireWith(N,[s]),s.fn.trigger&&s(N).trigger("ready").off("ready")}},bindReady:function(){if(!i){if(i=s.Callbacks("once memory"),"complete"===N.readyState)return setTimeout(s.ready,1);if(N.addEventListener)N.addEventListener("DOMContentLoaded",o,!1),e.addEventListener("load",s.ready,!1);else if(N.attachEvent){N.attachEvent("onreadystatechange",o),e.attachEvent("onload",s.ready);var t=!1;try{t=null==e.frameElement}catch(e){}N.documentElement.doScroll&&t&&a()}}},isFunction:function(e){return"function"===s.type(e)},isArray:Array.isArray||function(e){return"array"===s.type(e)},isWindow:function(e){return e&&"object"==typeof e&&"setInterval"in e},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?String(e):L[P.call(e)]||"object"},isPlainObject:function(e){if(!e||"object"!==s.type(e)||e.nodeType||s.isWindow(e))return!1;try{if(e.constructor&&!I.call(e,"constructor")&&!I.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}var a;for(a in e);return a===t||I.call(e,a)},isEmptyObject:function(e){for(var t in e)return!1;return!0},error:function(e){throw new Error(e)},parseJSON:function(t){return"string"==typeof t&&t?(t=s.trim(t),e.JSON&&e.JSON.parse?e.JSON.parse(t):m.test(t.replace(g,"@").replace(v,"]").replace(y,""))?new Function("return "+t)():void s.error("Invalid JSON: "+t)):null},parseXML:function(a){var n,r;try{e.DOMParser?(r=new DOMParser,n=r.parseFromString(a,"text/xml")):(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(a))}catch(e){n=t}return(!n||!n.documentElement||n.getElementsByTagName("parsererror").length)&&s.error("Invalid XML: "+a),n},noop:function(){},globalEval:function(t){t&&h.test(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(x,"ms-").replace(k,$)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toUpperCase()===t.toUpperCase()},each:function(e,a,n){var r,i=0,o=e.length,c=o===t||s.isFunction(e);if(n)if(c){for(r in e)if(a.apply(e[r],n)===!1)break}else for(;i<o&&a.apply(e[i++],n)!==!1;);else if(c){for(r in e)if(a.call(e[r],r,e[r])===!1)break}else for(;i<o&&a.call(e[i],i,e[i++])!==!1;);return e},trim:M?function(e){return null==e?"":M.call(e)}:function(e){return null==e?"":(e+"").replace(d,"").replace(p,"")},makeArray:function(e,t){var a=t||[];if(null!=e){var n=s.type(e);null==e.length||"string"===n||"function"===n||"regexp"===n||s.isWindow(e)?D.call(a,e):s.merge(a,e)}return a},inArray:function(e,t,a){var n;if(t){if(A)return A.call(t,e,a);for(n=t.length,a=a?a<0?Math.max(0,n+a):a:0;a<n;a++)if(a in t&&t[a]===e)return a}return-1},merge:function(e,a){var n=e.length,r=0;if("number"==typeof a.length)for(var i=a.length;r<i;r++)e[n++]=a[r];else for(;a[r]!==t;)e[n++]=a[r++];return e.length=n,e},grep:function(e,t,a){var n,r=[];a=!!a;for(var i=0,o=e.length;i<o;i++)n=!!t(e[i],i),a!==n&&r.push(e[i]);return r},map:function(e,a,n){var r,i,o=[],c=0,l=e.length,u=e instanceof s||l!==t&&"number"==typeof l&&(l>0&&e[0]&&e[l-1]||0===l||s.isArray(e));if(u)for(;c<l;c++)r=a(e[c],c,n),null!=r&&(o[o.length]=r);else for(i in e)r=a(e[i],i,n),null!=r&&(o[o.length]=r);return o.concat.apply([],o)},guid:1,proxy:function(e,a){if("string"==typeof a){var n=e[a];a=e,e=n}if(!s.isFunction(e))return t;var r=O.call(arguments,2),i=function(){return e.apply(a,r.concat(O.call(arguments)))};return i.guid=e.guid=e.guid||i.guid||s.guid++,i},access:function(e,a,n,r,i,o){var c=e.length;if("object"==typeof a){for(var l in a)s.access(e,l,a[l],r,i,n);return e}if(n!==t){r=!o&&r&&s.isFunction(n);for(var u=0;u<c;u++)i(e[u],a,r?n.call(e[u],u,i(e[u],a)):n,o);return e}return c?i(e[0],a):t},now:function(){return(new Date).getTime()},uaMatch:function(e){e=e.toLowerCase();var t=b.exec(e)||w.exec(e)||C.exec(e)||e.indexOf("compatible")<0&&T.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},sub:function(){function e(t,a){return new e.fn.init(t,a)}s.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function(a,n){return n&&n instanceof s&&!(n instanceof e)&&(n=e(n)),s.fn.init.call(this,a,n,t)},e.fn.init.prototype=e.fn;var t=e(N);return e},browser:{}}),s.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){L["[object "+t+"]"]=t.toLowerCase()}),r=s.uaMatch(S),r.browser&&(s.browser[r.browser]=!0,s.browser.version=r.version),s.browser.webkit&&(s.browser.safari=!0),h.test(" ")&&(d=/^[\s\xA0]+/,p=/[\s\xA0]+$/),n=s(N),N.addEventListener?o=function(){N.removeEventListener("DOMContentLoaded",o,!1),s.ready()}:N.attachEvent&&(o=function(){"complete"===N.readyState&&(N.detachEvent("onreadystatechange",o),s.ready())}),s}(),R={};E.Callbacks=function(e){e=e?R[e]||A(e):{};var a,n,r,i,o,s=[],c=[],l=function(t){var a,n,r,i;for(a=0,n=t.length;a<n;a++)r=t[a],i=E.type(r),"array"===i?l(r):"function"===i&&(!e.unique||!h.has(r))&&s.push(r)},u=function(t,l){for(l=l||[],a=!e.memory||[t,l],n=!0,o=r||0,r=0,i=s.length;s&&o<i;o++)if(s[o].apply(t,l)===!1&&e.stopOnFalse){a=!0;break}n=!1,s&&(e.once?a===!0?h.disable():s=[]:c&&c.length&&(a=c.shift(),h.fireWith(a[0],a[1])))},h={add:function(){if(s){var e=s.length;l(arguments),n?i=s.length:a&&a!==!0&&(r=e,u(a[0],a[1]))}return this},remove:function(){if(s)for(var t=arguments,a=0,r=t.length;a<r;a++)for(var c=0;c<s.length&&(t[a]!==s[c]||(n&&c<=i&&(i--,c<=o&&o--),s.splice(c--,1),!e.unique));c++);return this},has:function(e){if(s)for(var t=0,a=s.length;t<a;t++)if(e===s[t])return!0;return!1},empty:function(){return s=[],this},disable:function(){return s=c=a=t,this},disabled:function(){return!s},lock:function(){return c=t,(!a||a===!0)&&h.disable(),this},locked:function(){return!c},fireWith:function(t,r){return c&&(n?e.once||c.push([t,r]):(!e.once||!a)&&u(t,r)),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!a}};return h};var j=[].slice;E.extend({Deferred:function(e){var t,a=E.Callbacks("once memory"),n=E.Callbacks("once memory"),r=E.Callbacks("memory"),i="pending",o={resolve:a,reject:n,notify:r},s={done:a.add,fail:n.add,progress:r.add,state:function(){return i},isResolved:a.fired,isRejected:n.fired,then:function(e,t,a){return c.done(e).fail(t).progress(a),this},always:function(){return c.done.apply(c,arguments).fail.apply(c,arguments),this},pipe:function(e,t,a){return E.Deferred(function(n){E.each({done:[e,"resolve"],fail:[t,"reject"],progress:[a,"notify"]},function(e,t){var a,r=t[0],i=t[1];E.isFunction(r)?c[e](function(){a=r.apply(this,arguments),a&&E.isFunction(a.promise)?a.promise().then(n.resolve,n.reject,n.notify):n[i+"With"](this===c?n:this,[a])}):c[e](n[i])})}).promise()},promise:function(e){if(null==e)e=s;else for(var t in s)e[t]=s[t];return e}},c=s.promise({});for(t in o)c[t]=o[t].fire,c[t+"With"]=o[t].fireWith;return c.done(function(){i="resolved"},n.disable,r.lock).fail(function(){i="rejected"},a.disable,r.lock),e&&e.call(c,c),c},when:function(e){function t(e){return function(t){o[e]=arguments.length>1?j.call(arguments,0):t,c.notifyWith(l,o)}}function a(e){return function(t){n[e]=arguments.length>1?j.call(arguments,0):t,--s||c.resolveWith(c,n)}}var n=j.call(arguments,0),r=0,i=n.length,o=Array(i),s=i,c=i<=1&&e&&E.isFunction(e.promise)?e:E.Deferred(),l=c.promise();if(i>1){for(;r<i;r++)n[r]&&n[r].promise&&E.isFunction(n[r].promise)?n[r].promise().then(a(r),c.reject,t(r)):--s;s||c.resolveWith(c,n)}else c!==e&&c.resolveWith(c,i?[e]:[]);return l}}),E.support=function(){var t,a,n,r,i,o,s,c,l,u,h,d,p=N.createElement("div");N.documentElement;if(p.setAttribute("className","t"),p.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",a=p.getElementsByTagName("*"),n=p.getElementsByTagName("a")[0],!a||!a.length||!n)return{};r=N.createElement("select"),i=r.appendChild(N.createElement("option")),o=p.getElementsByTagName("input")[0],t={leadingWhitespace:3===p.firstChild.nodeType,tbody:!p.getElementsByTagName("tbody").length,htmlSerialize:!!p.getElementsByTagName("link").length,style:/top/.test(n.getAttribute("style")),hrefNormalized:"/a"===n.getAttribute("href"),opacity:/^0.55/.test(n.style.opacity),cssFloat:!!n.style.cssFloat,checkOn:"on"===o.value,optSelected:i.selected,getSetAttribute:"t"!==p.className,enctype:!!N.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==N.createElement("nav").cloneNode(!0).outerHTML,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},o.checked=!0,t.noCloneChecked=o.cloneNode(!0).checked,r.disabled=!0,t.optDisabled=!i.disabled;try{delete p.test}catch(e){t.deleteExpando=!1}if(!p.addEventListener&&p.attachEvent&&p.fireEvent&&(p.attachEvent("onclick",function(){t.noCloneEvent=!1}),p.cloneNode(!0).fireEvent("onclick")),o=N.createElement("input"),o.value="t",o.setAttribute("type","radio"),t.radioValue="t"===o.value,o.setAttribute("checked","checked"),p.appendChild(o),c=N.createDocumentFragment(),c.appendChild(p.lastChild),t.checkClone=c.cloneNode(!0).cloneNode(!0).lastChild.checked,t.appendChecked=o.checked,c.removeChild(o),c.appendChild(p),p.innerHTML="",e.getComputedStyle&&(s=N.createElement("div"),s.style.width="0",s.style.marginRight="0",p.style.width="2px",p.appendChild(s),t.reliableMarginRight=0===(parseInt((e.getComputedStyle(s,null)||{marginRight:0}).marginRight,10)||0)),p.attachEvent)for(h in{submit:1,change:1,focusin:1})u="on"+h,d=u in p,d||(p.setAttribute(u,"return;"),d="function"==typeof p[u]),t[h+"Bubbles"]=d;return c.removeChild(p),c=r=i=s=p=o=null,E(function(){var e,a,n,r,i,o,s,c,u,h,f=N.getElementsByTagName("body")[0];!f||(o=1,s="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;",c="visibility:hidden;border:0;",u="style='"+s+"border:5px solid #000;padding:0;'",h="<div "+u+"><div></div></div><table "+u+" cellpadding='0' cellspacing='0'><tr><td></td></tr></table>",e=N.createElement("div"),e.style.cssText=c+"width:0;height:0;position:static;top:0;margin-top:"+o+"px",f.insertBefore(e,f.firstChild),p=N.createElement("div"),e.appendChild(p),p.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",l=p.getElementsByTagName("td"),d=0===l[0].offsetHeight,l[0].style.display="",l[1].style.display="none",t.reliableHiddenOffsets=d&&0===l[0].offsetHeight,p.innerHTML="",p.style.width=p.style.paddingLeft="1px",E.boxModel=t.boxModel=2===p.offsetWidth,"undefined"!=typeof p.style.zoom&&(p.style.display="inline",p.style.zoom=1,t.inlineBlockNeedsLayout=2===p.offsetWidth,p.style.display="",p.innerHTML="<div style='width:4px;'></div>",t.shrinkWrapBlocks=2!==p.offsetWidth),p.style.cssText=s+c,p.innerHTML=h,a=p.firstChild,n=a.firstChild,r=a.nextSibling.firstChild.firstChild,i={doesNotAddBorder:5!==n.offsetTop,doesAddBorderForTableAndCells:5===r.offsetTop},n.style.position="fixed",n.style.top="20px",i.fixedPosition=20===n.offsetTop||15===n.offsetTop,n.style.position=n.style.top="",a.style.overflow="hidden",a.style.position="relative",i.subtractsBorderForOverflowNotVisible=n.offsetTop===-5,i.doesNotIncludeMarginInBodyOffset=f.offsetTop!==o,f.removeChild(e),p=e=null,E.extend(t,i))}),t}();var _=/^(?:\{.*\}|\[.*\])$/,H=/([A-Z])/g;E.extend({cache:{},uuid:0,expando:"jQuery"+(E.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?E.cache[e[E.expando]]:e[E.expando],!!e&&!O(e)},data:function(e,a,n,r){if(E.acceptData(e)){var i,o,s,c=E.expando,l="string"==typeof a,u=e.nodeType,h=u?E.cache:e,d=u?e[c]:e[c]&&c,p="events"===a;if((!d||!h[d]||!p&&!r&&!h[d].data)&&l&&n===t)return;return d||(u?e[c]=d=++E.uuid:d=c),h[d]||(h[d]={},u||(h[d].toJSON=E.noop)),"object"!=typeof a&&"function"!=typeof a||(r?h[d]=E.extend(h[d],a):h[d].data=E.extend(h[d].data,a)),i=o=h[d],r||(o.data||(o.data={}),o=o.data),n!==t&&(o[E.camelCase(a)]=n),p&&!o[a]?i.events:(l?(s=o[a],null==s&&(s=o[E.camelCase(a)])):s=o,s)}},removeData:function(e,t,a){if(E.acceptData(e)){var n,r,i,o=E.expando,s=e.nodeType,c=s?E.cache:e,l=s?e[o]:o;if(!c[l])return;if(t&&(n=a?c[l]:c[l].data)){E.isArray(t)||(t in n?t=[t]:(t=E.camelCase(t),t=t in n?[t]:t.split(" ")));for(r=0,i=t.length;r<i;r++)delete n[t[r]];if(!(a?O:E.isEmptyObject)(n))return}if(!a&&(delete c[l].data,!O(c[l])))return;E.support.deleteExpando||!c.setInterval?delete c[l]:c[l]=null,s&&(E.support.deleteExpando?delete e[o]:e.removeAttribute?e.removeAttribute(o):e[o]=null)}},_data:function(e,t,a){return E.data(e,t,a,!0)},acceptData:function(e){if(e.nodeName){var t=E.noData[e.nodeName.toLowerCase()];if(t)return t!==!0&&e.getAttribute("classid")===t}return!0}}),E.fn.extend({data:function(e,a){var n,r,i,o=null;if("undefined"==typeof e){if(this.length&&(o=E.data(this[0]),1===this[0].nodeType&&!E._data(this[0],"parsedAttrs"))){r=this[0].attributes;for(var s=0,c=r.length;s<c;s++)i=r[s].name,0===i.indexOf("data-")&&(i=E.camelCase(i.substring(5)),M(this[0],i,o[i]));E._data(this[0],"parsedAttrs",!0)}return o}return"object"==typeof e?this.each(function(){E.data(this,e)}):(n=e.split("."),n[1]=n[1]?"."+n[1]:"",a===t?(o=this.triggerHandler("getData"+n[1]+"!",[n[0]]),o===t&&this.length&&(o=E.data(this[0],e),o=M(this[0],e,o)),o===t&&n[1]?this.data(n[0]):o):this.each(function(){var t=E(this),r=[n[0],a];t.triggerHandler("setData"+n[1]+"!",r),E.data(this,e,a),t.triggerHandler("changeData"+n[1]+"!",r)}))},removeData:function(e){return this.each(function(){E.removeData(this,e)})}}),E.extend({_mark:function(e,t){e&&(t=(t||"fx")+"mark",E._data(e,t,(E._data(e,t)||0)+1))},_unmark:function(e,t,a){if(e!==!0&&(a=t,t=e,e=!1),t){a=a||"fx";var n=a+"mark",r=e?0:(E._data(t,n)||1)-1;r?E._data(t,n,r):(E.removeData(t,n,!0),D(t,a,"mark"))}},queue:function(e,t,a){var n;if(e)return t=(t||"fx")+"queue",n=E._data(e,t),a&&(!n||E.isArray(a)?n=E._data(e,t,E.makeArray(a)):n.push(a)),n||[]},dequeue:function(e,t){t=t||"fx";var a=E.queue(e,t),n=a.shift(),r={};"inprogress"===n&&(n=a.shift()),n&&("fx"===t&&a.unshift("inprogress"),E._data(e,t+".run",r),n.call(e,function(){E.dequeue(e,t)},r)),a.length||(E.removeData(e,t+"queue "+t+".run",!0),D(e,t,"queue"))}}),E.fn.extend({queue:function(e,a){return"string"!=typeof e&&(a=e,e="fx"),a===t?E.queue(this[0],e):this.each(function(){var t=E.queue(this,e,a);"fx"===e&&"inprogress"!==t[0]&&E.dequeue(this,e)})},dequeue:function(e){return this.each(function(){E.dequeue(this,e)})},delay:function(e,t){return e=E.fx?E.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,a){var n=setTimeout(t,e);a.stop=function(){clearTimeout(n)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,a){function n(){--c||i.resolveWith(o,[o])}"string"!=typeof e&&(a=e,e=t),e=e||"fx";for(var r,i=E.Deferred(),o=this,s=o.length,c=1,l=e+"defer",u=e+"queue",h=e+"mark";s--;)(r=E.data(o[s],l,t,!0)||(E.data(o[s],u,t,!0)||E.data(o[s],h,t,!0))&&E.data(o[s],l,E.Callbacks("once memory"),!0))&&(c++,r.add(n));return n(),i.promise()}});var W,B,U,q=/[\n\t\r]/g,V=/\s+/,G=/\r/g,z=/^(?:button|input)$/i,X=/^(?:button|input|object|select|textarea)$/i,J=/^a(?:rea)?$/i,K=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,Y=E.support.getSetAttribute;E.fn.extend({attr:function(e,t){return E.access(this,e,t,!0,E.attr)},removeAttr:function(e){return this.each(function(){E.removeAttr(this,e)})},prop:function(e,t){return E.access(this,e,t,!0,E.prop)},removeProp:function(e){return e=E.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(e){}})},addClass:function(e){var t,a,n,r,i,o,s;if(E.isFunction(e))return this.each(function(t){E(this).addClass(e.call(this,t,this.className))});if(e&&"string"==typeof e)for(t=e.split(V),a=0,n=this.length;a<n;a++)if(r=this[a],1===r.nodeType)if(r.className||1!==t.length){for(i=" "+r.className+" ",o=0,s=t.length;o<s;o++)~i.indexOf(" "+t[o]+" ")||(i+=t[o]+" ");r.className=E.trim(i)}else r.className=e;return this},removeClass:function(e){var a,n,r,i,o,s,c;if(E.isFunction(e))return this.each(function(t){E(this).removeClass(e.call(this,t,this.className))});if(e&&"string"==typeof e||e===t)for(a=(e||"").split(V),n=0,r=this.length;n<r;n++)if(i=this[n],1===i.nodeType&&i.className)if(e){for(o=(" "+i.className+" ").replace(q," "),s=0,c=a.length;s<c;s++)o=o.replace(" "+a[s]+" "," ");i.className=E.trim(o)}else i.className="";return this},toggleClass:function(e,t){var a=typeof e,n="boolean"==typeof t;return E.isFunction(e)?this.each(function(a){E(this).toggleClass(e.call(this,a,this.className,t),t)}):this.each(function(){if("string"===a)for(var r,i=0,o=E(this),s=t,c=e.split(V);r=c[i++];)s=n?s:!o.hasClass(r),o[s?"addClass":"removeClass"](r);else"undefined"!==a&&"boolean"!==a||(this.className&&E._data(this,"__className__",this.className),this.className=this.className||e===!1?"":E._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",a=0,n=this.length;a<n;a++)if(1===this[a].nodeType&&(" "+this[a].className+" ").replace(q," ").indexOf(t)>-1)return!0;return!1},val:function(e){var a,n,r,i=this[0];return arguments.length?(r=E.isFunction(e),this.each(function(n){var i,o=E(this);1===this.nodeType&&(i=r?e.call(this,n,o.val()):e,null==i?i="":"number"==typeof i?i+="":E.isArray(i)&&(i=E.map(i,function(e){return null==e?"":e+""})),a=E.valHooks[this.nodeName.toLowerCase()]||E.valHooks[this.type],a&&"set"in a&&a.set(this,i,"value")!==t||(this.value=i))})):i?(a=E.valHooks[i.nodeName.toLowerCase()]||E.valHooks[i.type],a&&"get"in a&&(n=a.get(i,"value"))!==t?n:(n=i.value,"string"==typeof n?n.replace(G,""):null==n?"":n)):void 0}}),E.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,a,n,r,i=e.selectedIndex,o=[],s=e.options,c="select-one"===e.type;if(i<0)return null;for(a=c?i:0,n=c?i+1:s.length;a<n;a++)if(r=s[a],r.selected&&(E.support.optDisabled?!r.disabled:null===r.getAttribute("disabled"))&&(!r.parentNode.disabled||!E.nodeName(r.parentNode,"optgroup"))){if(t=E(r).val(),c)return t;o.push(t)}return c&&!o.length&&s.length?E(s[i]).val():o},set:function(e,t){var a=E.makeArray(t);return E(e).find("option").each(function(){this.selected=E.inArray(E(this).val(),a)>=0}),a.length||(e.selectedIndex=-1),a}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(e,a,n,r){var i,o,s,c=e.nodeType;if(e&&3!==c&&8!==c&&2!==c)return r&&a in E.attrFn?E(e)[a](n):"undefined"==typeof e.getAttribute?E.prop(e,a,n):(s=1!==c||!E.isXMLDoc(e),s&&(a=a.toLowerCase(),o=E.attrHooks[a]||(K.test(a)?B:W)),n!==t?null===n?void E.removeAttr(e,a):o&&"set"in o&&s&&(i=o.set(e,n,a))!==t?i:(e.setAttribute(a,""+n),n):o&&"get"in o&&s&&null!==(i=o.get(e,a))?i:(i=e.getAttribute(a),null===i?t:i))},removeAttr:function(e,t){var a,n,r,i,o=0;if(t&&1===e.nodeType)for(n=t.toLowerCase().split(V),i=n.length;o<i;o++)r=n[o],r&&(a=E.propFix[r]||r,E.attr(e,r,""),e.removeAttribute(Y?r:a),K.test(r)&&a in e&&(e[a]=!1))},attrHooks:{type:{set:function(e,t){if(z.test(e.nodeName)&&e.parentNode)E.error("type property can't be changed");else if(!E.support.radioValue&&"radio"===t&&E.nodeName(e,"input")){var a=e.value;return e.setAttribute("type",t),a&&(e.value=a),t}}},value:{get:function(e,t){return W&&E.nodeName(e,"button")?W.get(e,t):t in e?e.value:null},set:function(e,t,a){return W&&E.nodeName(e,"button")?W.set(e,t,a):void(e.value=t)}}},propFix:{tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,a,n){var r,i,o,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return o=1!==s||!E.isXMLDoc(e),o&&(a=E.propFix[a]||a,i=E.propHooks[a]),n!==t?i&&"set"in i&&(r=i.set(e,n,a))!==t?r:e[a]=n:i&&"get"in i&&null!==(r=i.get(e,a))?r:e[a]},propHooks:{tabIndex:{get:function(e){var a=e.getAttributeNode("tabindex");return a&&a.specified?parseInt(a.value,10):X.test(e.nodeName)||J.test(e.nodeName)&&e.href?0:t}}}}),E.attrHooks.tabindex=E.propHooks.tabIndex,B={get:function(e,a){var n,r=E.prop(e,a);return r===!0||"boolean"!=typeof r&&(n=e.getAttributeNode(a))&&n.nodeValue!==!1?a.toLowerCase():t},set:function(e,t,a){var n;return t===!1?E.removeAttr(e,a):(n=E.propFix[a]||a,n in e&&(e[n]=!0),e.setAttribute(a,a.toLowerCase())),a}},Y||(U={name:!0,id:!0},W=E.valHooks.button={get:function(e,a){var n;return n=e.getAttributeNode(a),n&&(U[a]?""!==n.nodeValue:n.specified)?n.nodeValue:t},set:function(e,t,a){var n=e.getAttributeNode(a);return n||(n=N.createAttribute(a),e.setAttributeNode(n)),n.nodeValue=t+""}},E.attrHooks.tabindex.set=W.set,E.each(["width","height"],function(e,t){E.attrHooks[t]=E.extend(E.attrHooks[t],{set:function(e,a){if(""===a)return e.setAttribute(t,"auto"),a}})}),E.attrHooks.contenteditable={get:W.get,set:function(e,t,a){""===t&&(t="false"),W.set(e,t,a)}}),E.support.hrefNormalized||E.each(["href","src","width","height"],function(e,a){E.attrHooks[a]=E.extend(E.attrHooks[a],{get:function(e){var n=e.getAttribute(a,2);return null===n?t:n}})}),E.support.style||(E.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||t},set:function(e,t){return e.style.cssText=""+t}}),E.support.optSelected||(E.propHooks.selected=E.extend(E.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),E.support.enctype||(E.propFix.enctype="encoding"),E.support.checkOn||E.each(["radio","checkbox"],function(){
E.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),E.each(["radio","checkbox"],function(){E.valHooks[this]=E.extend(E.valHooks[this],{set:function(e,t){if(E.isArray(t))return e.checked=E.inArray(E(e).val(),t)>=0}})});var Q=/^(?:textarea|input|select)$/i,Z=/^([^\.]*)?(?:\.(.+))?$/,ee=/\bhover(\.\S+)?\b/,te=/^key/,ae=/^(?:mouse|contextmenu)|click/,ne=/^(?:focusinfocus|focusoutblur)$/,re=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,ie=function(e){var t=re.exec(e);return t&&(t[1]=(t[1]||"").toLowerCase(),t[3]=t[3]&&new RegExp("(?:^|\\s)"+t[3]+"(?:\\s|$)")),t},oe=function(e,t){var a=e.attributes||{};return(!t[1]||e.nodeName.toLowerCase()===t[1])&&(!t[2]||(a.id||{}).value===t[2])&&(!t[3]||t[3].test((a.class||{}).value))},se=function(e){return E.event.special.hover?e:e.replace(ee,"mouseenter$1 mouseleave$1")};E.event={add:function(e,a,n,r,i){var o,s,c,l,u,h,d,p,f,m,g;if(3!==e.nodeType&&8!==e.nodeType&&a&&n&&(o=E._data(e))){for(n.handler&&(f=n,n=f.handler),n.guid||(n.guid=E.guid++),c=o.events,c||(o.events=c={}),s=o.handle,s||(o.handle=s=function(e){return"undefined"==typeof E||e&&E.event.triggered===e.type?t:E.event.dispatch.apply(s.elem,arguments)},s.elem=e),a=E.trim(se(a)).split(" "),l=0;l<a.length;l++)u=Z.exec(a[l])||[],h=u[1],d=(u[2]||"").split(".").sort(),g=E.event.special[h]||{},h=(i?g.delegateType:g.bindType)||h,g=E.event.special[h]||{},p=E.extend({type:h,origType:u[1],data:r,handler:n,guid:n.guid,selector:i,quick:ie(i),namespace:d.join(".")},f),m=c[h],m||(m=c[h]=[],m.delegateCount=0,g.setup&&g.setup.call(e,r,d,s)!==!1||(e.addEventListener?e.addEventListener(h,s,!1):e.attachEvent&&e.attachEvent("on"+h,s))),g.add&&(g.add.call(e,p),p.handler.guid||(p.handler.guid=n.guid)),i?m.splice(m.delegateCount++,0,p):m.push(p),E.event.global[h]=!0;e=null}},global:{},remove:function(e,t,a,n,r){var i,o,s,c,l,u,h,d,p,f,m,g,v=E.hasData(e)&&E._data(e);if(v&&(d=v.events)){for(t=E.trim(se(t||"")).split(" "),i=0;i<t.length;i++)if(o=Z.exec(t[i])||[],s=c=o[1],l=o[2],s){for(p=E.event.special[s]||{},s=(n?p.delegateType:p.bindType)||s,m=d[s]||[],u=m.length,l=l?new RegExp("(^|\\.)"+l.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null,h=0;h<m.length;h++)g=m[h],(r||c===g.origType)&&(!a||a.guid===g.guid)&&(!l||l.test(g.namespace))&&(!n||n===g.selector||"**"===n&&g.selector)&&(m.splice(h--,1),g.selector&&m.delegateCount--,p.remove&&p.remove.call(e,g));0===m.length&&u!==m.length&&((!p.teardown||p.teardown.call(e,l)===!1)&&E.removeEvent(e,s,v.handle),delete d[s])}else for(s in d)E.event.remove(e,s+t[i],a,n,!0);E.isEmptyObject(d)&&(f=v.handle,f&&(f.elem=null),E.removeData(e,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(a,n,r,i){if(!r||3!==r.nodeType&&8!==r.nodeType){var o,s,c,l,u,h,d,p,f,m,g=a.type||a,v=[];if(ne.test(g+E.event.triggered))return;if(g.indexOf("!")>=0&&(g=g.slice(0,-1),s=!0),g.indexOf(".")>=0&&(v=g.split("."),g=v.shift(),v.sort()),(!r||E.event.customEvent[g])&&!E.event.global[g])return;if(a="object"==typeof a?a[E.expando]?a:new E.Event(g,a):new E.Event(g),a.type=g,a.isTrigger=!0,a.exclusive=s,a.namespace=v.join("."),a.namespace_re=a.namespace?new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,h=g.indexOf(":")<0?"on"+g:"",!r){o=E.cache;for(c in o)o[c].events&&o[c].events[g]&&E.event.trigger(a,n,o[c].handle.elem,!0);return}if(a.result=t,a.target||(a.target=r),n=null!=n?E.makeArray(n):[],n.unshift(a),d=E.event.special[g]||{},d.trigger&&d.trigger.apply(r,n)===!1)return;if(f=[[r,d.bindType||g]],!i&&!d.noBubble&&!E.isWindow(r)){for(m=d.delegateType||g,l=ne.test(m+g)?r:r.parentNode,u=null;l;l=l.parentNode)f.push([l,m]),u=l;u&&u===r.ownerDocument&&f.push([u.defaultView||u.parentWindow||e,m])}for(c=0;c<f.length&&!a.isPropagationStopped();c++)l=f[c][0],a.type=f[c][1],p=(E._data(l,"events")||{})[a.type]&&E._data(l,"handle"),p&&p.apply(l,n),p=h&&l[h],p&&E.acceptData(l)&&p.apply(l,n)===!1&&a.preventDefault();return a.type=g,!i&&!a.isDefaultPrevented()&&(!d._default||d._default.apply(r.ownerDocument,n)===!1)&&("click"!==g||!E.nodeName(r,"a"))&&E.acceptData(r)&&h&&r[g]&&("focus"!==g&&"blur"!==g||0!==a.target.offsetWidth)&&!E.isWindow(r)&&(u=r[h],u&&(r[h]=null),E.event.triggered=g,r[g](),E.event.triggered=t,u&&(r[h]=u)),a.result}},dispatch:function(a){a=E.event.fix(a||e.event);var n,r,i,o,s,c,l,u,h,d,p=(E._data(this,"events")||{})[a.type]||[],f=p.delegateCount,m=[].slice.call(arguments,0),g=!a.exclusive&&!a.namespace,v=[];if(m[0]=a,a.delegateTarget=this,f&&!a.target.disabled&&(!a.button||"click"!==a.type))for(o=E(this),o.context=this.ownerDocument||this,i=a.target;i!=this;i=i.parentNode||this){for(c={},u=[],o[0]=i,n=0;n<f;n++)h=p[n],d=h.selector,c[d]===t&&(c[d]=h.quick?oe(i,h.quick):o.is(d)),c[d]&&u.push(h);u.length&&v.push({elem:i,matches:u})}for(p.length>f&&v.push({elem:this,matches:p.slice(f)}),n=0;n<v.length&&!a.isPropagationStopped();n++)for(l=v[n],a.currentTarget=l.elem,r=0;r<l.matches.length&&!a.isImmediatePropagationStopped();r++)h=l.matches[r],(g||!a.namespace&&!h.namespace||a.namespace_re&&a.namespace_re.test(h.namespace))&&(a.data=h.data,a.handleObj=h,s=((E.event.special[h.origType]||{}).handle||h.handler).apply(l.elem,m),s!==t&&(a.result=s,s===!1&&(a.preventDefault(),a.stopPropagation())));return a.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,a){var n,r,i,o=a.button,s=a.fromElement;return null==e.pageX&&null!=a.clientX&&(n=e.target.ownerDocument||N,r=n.documentElement,i=n.body,e.pageX=a.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0),e.pageY=a.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)),!e.relatedTarget&&s&&(e.relatedTarget=s===e.target?a.toElement:s),!e.which&&o!==t&&(e.which=1&o?1:2&o?3:4&o?2:0),e}},fix:function(e){if(e[E.expando])return e;var a,n,r=e,i=E.event.fixHooks[e.type]||{},o=i.props?this.props.concat(i.props):this.props;for(e=E.Event(r),a=o.length;a;)n=o[--a],e[n]=r[n];return e.target||(e.target=r.srcElement||N),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey===t&&(e.metaKey=e.ctrlKey),i.filter?i.filter(e,r):e},special:{ready:{setup:E.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(e,t,a){E.isWindow(this)&&(this.onbeforeunload=a)},teardown:function(e,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(e,t,a,n){var r=E.extend(new E.Event,a,{type:e,isSimulated:!0,originalEvent:{}});n?E.event.trigger(r,null,t):E.event.dispatch.call(t,r),r.isDefaultPrevented()&&a.preventDefault()}},E.event.handle=E.event.dispatch,E.removeEvent=N.removeEventListener?function(e,t,a){e.removeEventListener&&e.removeEventListener(t,a,!1)}:function(e,t,a){e.detachEvent&&e.detachEvent("on"+t,a)},E.Event=function(e,t){return this instanceof E.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?P:I):this.type=e,t&&E.extend(this,t),this.timeStamp=e&&e.timeStamp||E.now(),this[E.expando]=!0,void 0):new E.Event(e,t)},E.Event.prototype={preventDefault:function(){this.isDefaultPrevented=P;var e=this.originalEvent;!e||(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=P;var e=this.originalEvent;!e||(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=P,this.stopPropagation()},isDefaultPrevented:I,isPropagationStopped:I,isImmediatePropagationStopped:I},E.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){E.event.special[e]={delegateType:t,bindType:t,handle:function(e){var a,n=this,r=e.relatedTarget,i=e.handleObj;i.selector;return r&&(r===n||E.contains(n,r))||(e.type=i.origType,a=i.handler.apply(this,arguments),e.type=t),a}}}),E.support.submitBubbles||(E.event.special.submit={setup:function(){return!E.nodeName(this,"form")&&void E.event.add(this,"click._submit keypress._submit",function(e){var a=e.target,n=E.nodeName(a,"input")||E.nodeName(a,"button")?a.form:t;n&&!n._submit_attached&&(E.event.add(n,"submit._submit",function(e){this.parentNode&&!e.isTrigger&&E.event.simulate("submit",this.parentNode,e,!0)}),n._submit_attached=!0)})},teardown:function(){return!E.nodeName(this,"form")&&void E.event.remove(this,"._submit")}}),E.support.changeBubbles||(E.event.special.change={setup:function(){return Q.test(this.nodeName)?("checkbox"!==this.type&&"radio"!==this.type||(E.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),E.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1,E.event.simulate("change",this,e,!0))})),!1):void E.event.add(this,"beforeactivate._change",function(e){var t=e.target;Q.test(t.nodeName)&&!t._change_attached&&(E.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&E.event.simulate("change",this.parentNode,e,!0)}),t._change_attached=!0)})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type)return e.handleObj.handler.apply(this,arguments)},teardown:function(){return E.event.remove(this,"._change"),Q.test(this.nodeName)}}),E.support.focusinBubbles||E.each({focus:"focusin",blur:"focusout"},function(e,t){var a=0,n=function(e){E.event.simulate(t,e.target,E.event.fix(e),!0)};E.event.special[t]={setup:function(){0===a++&&N.addEventListener(e,n,!0)},teardown:function(){0===--a&&N.removeEventListener(e,n,!0)}}}),E.fn.extend({on:function(e,a,n,r,i){var o,s;if("object"==typeof e){"string"!=typeof a&&(n=a,a=t);for(s in e)this.on(s,a,n,e[s],i);return this}if(null==n&&null==r?(r=a,n=a=t):null==r&&("string"==typeof a?(r=n,n=t):(r=n,n=a,a=t)),r===!1)r=I;else if(!r)return this;return 1===i&&(o=r,r=function(e){return E().off(e),o.apply(this,arguments)},r.guid=o.guid||(o.guid=E.guid++)),this.each(function(){E.event.add(this,e,r,n,a)})},one:function(e,t,a,n){return this.on.call(this,e,t,a,n,1)},off:function(e,a,n){if(e&&e.preventDefault&&e.handleObj){var r=e.handleObj;return E(e.delegateTarget).off(r.namespace?r.type+"."+r.namespace:r.type,r.selector,r.handler),this}if("object"==typeof e){for(var i in e)this.off(i,a,e[i]);return this}return a!==!1&&"function"!=typeof a||(n=a,a=t),n===!1&&(n=I),this.each(function(){E.event.remove(this,e,n,a)})},bind:function(e,t,a){return this.on(e,null,t,a)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,a){return E(this.context).on(e,this.selector,t,a),this},die:function(e,t){return E(this.context).off(e,this.selector||"**",t),this},delegate:function(e,t,a,n){return this.on(t,e,a,n)},undelegate:function(e,t,a){return 1==arguments.length?this.off(e,"**"):this.off(t,e,a)},trigger:function(e,t){return this.each(function(){E.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0])return E.event.trigger(e,t,this[0],!0)},toggle:function(e){var t=arguments,a=e.guid||E.guid++,n=0,r=function(a){var r=(E._data(this,"lastToggle"+e.guid)||0)%n;return E._data(this,"lastToggle"+e.guid,r+1),a.preventDefault(),t[r].apply(this,arguments)||!1};for(r.guid=a;n<t.length;)t[n++].guid=a;return this.click(r)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),E.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){E.fn[t]=function(e,a){return null==a&&(a=e,e=null),arguments.length>0?this.on(t,null,e,a):this.trigger(t)},E.attrFn&&(E.attrFn[t]=!0),te.test(t)&&(E.event.fixHooks[t]=E.event.keyHooks),ae.test(t)&&(E.event.fixHooks[t]=E.event.mouseHooks)}),function(){function e(e,t,a,n,i,o){for(var s=0,c=n.length;s<c;s++){var l=n[s];if(l){var u=!1;for(l=l[e];l;){if(l[r]===a){u=n[l.sizset];break}if(1===l.nodeType)if(o||(l[r]=a,l.sizset=s),"string"!=typeof t){if(l===t){u=!0;break}}else if(d.filter(t,[l]).length>0){u=l;break}l=l[e]}n[s]=u}}}function a(e,t,a,n,i,o){for(var s=0,c=n.length;s<c;s++){var l=n[s];if(l){var u=!1;for(l=l[e];l;){if(l[r]===a){u=n[l.sizset];break}if(1===l.nodeType&&!o&&(l[r]=a,l.sizset=s),l.nodeName.toLowerCase()===t){u=l;break}l=l[e]}n[s]=u}}}var n=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,r="sizcache"+(Math.random()+"").replace(".",""),i=0,o=Object.prototype.toString,s=!1,c=!0,l=/\\/g,u=/\r\n/g,h=/\W/;[0,0].sort(function(){return c=!1,0});var d=function(e,t,a,r){a=a||[],t=t||N;var i=t;if(1!==t.nodeType&&9!==t.nodeType)return[];if(!e||"string"!=typeof e)return a;var s,c,l,u,h,p,g,v,b=!0,w=d.isXML(t),T=[],k=e;do if(n.exec(""),s=n.exec(k),s&&(k=s[3],T.push(s[1]),s[2])){u=s[3];break}while(s);if(T.length>1&&m.exec(e))if(2===T.length&&f.relative[T[0]])c=C(T[0]+T[1],t,r);else for(c=f.relative[T[0]]?[t]:d(T.shift(),t);T.length;)e=T.shift(),f.relative[e]&&(e+=T.shift()),c=C(e,c,r);else if(!r&&T.length>1&&9===t.nodeType&&!w&&f.match.ID.test(T[0])&&!f.match.ID.test(T[T.length-1])&&(h=d.find(T.shift(),t,w),t=h.expr?d.filter(h.expr,h.set)[0]:h.set[0]),t)for(h=r?{expr:T.pop(),set:y(r)}:d.find(T.pop(),1!==T.length||"~"!==T[0]&&"+"!==T[0]||!t.parentNode?t:t.parentNode,w),c=h.expr?d.filter(h.expr,h.set):h.set,T.length>0?l=y(c):b=!1;T.length;)p=T.pop(),g=p,f.relative[p]?g=T.pop():p="",null==g&&(g=t),f.relative[p](l,g,w);else l=T=[];if(l||(l=c),l||d.error(p||e),"[object Array]"===o.call(l))if(b)if(t&&1===t.nodeType)for(v=0;null!=l[v];v++)l[v]&&(l[v]===!0||1===l[v].nodeType&&d.contains(t,l[v]))&&a.push(c[v]);else for(v=0;null!=l[v];v++)l[v]&&1===l[v].nodeType&&a.push(c[v]);else a.push.apply(a,l);else y(l,a);return u&&(d(u,i,a,r),d.uniqueSort(a)),a};d.uniqueSort=function(e){if(b&&(s=c,e.sort(b),s))for(var t=1;t<e.length;t++)e[t]===e[t-1]&&e.splice(t--,1);return e},d.matches=function(e,t){return d(e,null,null,t)},d.matchesSelector=function(e,t){return d(t,null,null,[e]).length>0},d.find=function(e,t,a){var n,r,i,o,s,c;if(!e)return[];for(r=0,i=f.order.length;r<i;r++)if(s=f.order[r],(o=f.leftMatch[s].exec(e))&&(c=o[1],o.splice(1,1),"\\"!==c.substr(c.length-1)&&(o[1]=(o[1]||"").replace(l,""),n=f.find[s](o,t,a),null!=n))){e=e.replace(f.match[s],"");break}return n||(n="undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName("*"):[]),{set:n,expr:e}},d.filter=function(e,a,n,r){for(var i,o,s,c,l,u,h,p,m,g=e,v=[],y=a,b=a&&a[0]&&d.isXML(a[0]);e&&a.length;){for(s in f.filter)if(null!=(i=f.leftMatch[s].exec(e))&&i[2]){if(u=f.filter[s],h=i[1],o=!1,i.splice(1,1),"\\"===h.substr(h.length-1))continue;if(y===v&&(v=[]),f.preFilter[s])if(i=f.preFilter[s](i,y,n,v,r,b)){if(i===!0)continue}else o=c=!0;if(i)for(p=0;null!=(l=y[p]);p++)l&&(c=u(l,i,p,y),m=r^c,n&&null!=c?m?o=!0:y[p]=!1:m&&(v.push(l),o=!0));if(c!==t){if(n||(y=v),e=e.replace(f.match[s],""),!o)return[];break}}if(e===g){if(null!=o)break;d.error(e)}g=e}return y},d.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)};var p=d.getText=function(e){var t,a,n=e.nodeType,r="";if(n){if(1===n||9===n){if("string"==typeof e.textContent)return e.textContent;if("string"==typeof e.innerText)return e.innerText.replace(u,"");for(e=e.firstChild;e;e=e.nextSibling)r+=p(e)}else if(3===n||4===n)return e.nodeValue}else for(t=0;a=e[t];t++)8!==a.nodeType&&(r+=p(a));return r},f=d.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{class:"className",for:"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")},type:function(e){return e.getAttribute("type")}},relative:{"+":function(e,t){var a="string"==typeof t,n=a&&!h.test(t),r=a&&!n;n&&(t=t.toLowerCase());for(var i,o=0,s=e.length;o<s;o++)if(i=e[o]){for(;(i=i.previousSibling)&&1!==i.nodeType;);e[o]=r||i&&i.nodeName.toLowerCase()===t?i||!1:i===t}r&&d.filter(t,e,!0)},">":function(e,t){var a,n="string"==typeof t,r=0,i=e.length;if(n&&!h.test(t)){for(t=t.toLowerCase();r<i;r++)if(a=e[r]){var o=a.parentNode;e[r]=o.nodeName.toLowerCase()===t&&o}}else{for(;r<i;r++)a=e[r],a&&(e[r]=n?a.parentNode:a.parentNode===t);n&&d.filter(t,e,!0)}},"":function(t,n,r){var o,s=i++,c=e;"string"==typeof n&&!h.test(n)&&(n=n.toLowerCase(),o=n,c=a),c("parentNode",n,s,t,o,r)},"~":function(t,n,r){var o,s=i++,c=e;"string"==typeof n&&!h.test(n)&&(n=n.toLowerCase(),o=n,c=a),c("previousSibling",n,s,t,o,r)}},find:{ID:function(e,t,a){if("undefined"!=typeof t.getElementById&&!a){var n=t.getElementById(e[1]);return n&&n.parentNode?[n]:[]}},NAME:function(e,t){if("undefined"!=typeof t.getElementsByName){for(var a=[],n=t.getElementsByName(e[1]),r=0,i=n.length;r<i;r++)n[r].getAttribute("name")===e[1]&&a.push(n[r]);return 0===a.length?null:a}},TAG:function(e,t){if("undefined"!=typeof t.getElementsByTagName)return t.getElementsByTagName(e[1])}},preFilter:{CLASS:function(e,t,a,n,r,i){if(e=" "+e[1].replace(l,"")+" ",i)return e;for(var o,s=0;null!=(o=t[s]);s++)o&&(r^(o.className&&(" "+o.className+" ").replace(/[\t\n\r]/g," ").indexOf(e)>=0)?a||n.push(o):a&&(t[s]=!1));return!1},ID:function(e){return e[1].replace(l,"")},TAG:function(e,t){return e[1].replace(l,"").toLowerCase()},CHILD:function(e){if("nth"===e[1]){e[2]||d.error(e[0]),e[2]=e[2].replace(/^\+|\s*/g,"");var t=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec("even"===e[2]&&"2n"||"odd"===e[2]&&"2n+1"||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=t[1]+(t[2]||1)-0,e[3]=t[3]-0}else e[2]&&d.error(e[0]);return e[0]=i++,e},ATTR:function(e,t,a,n,r,i){var o=e[1]=e[1].replace(l,"");return!i&&f.attrMap[o]&&(e[1]=f.attrMap[o]),e[4]=(e[4]||e[5]||"").replace(l,""),"~="===e[2]&&(e[4]=" "+e[4]+" "),e},PSEUDO:function(e,t,a,r,i){if("not"===e[1]){if(!((n.exec(e[3])||"").length>1||/^\w/.test(e[3]))){var o=d.filter(e[3],t,a,!0^i);return a||r.push.apply(r,o),!1}e[3]=d(e[3],null,null,t)}else if(f.match.POS.test(e[0])||f.match.CHILD.test(e[0]))return!0;return e},POS:function(e){return e.unshift(!0),e}},filters:{enabled:function(e){return e.disabled===!1&&"hidden"!==e.type},disabled:function(e){return e.disabled===!0},checked:function(e){return e.checked===!0},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},parent:function(e){return!!e.firstChild},empty:function(e){return!e.firstChild},has:function(e,t,a){return!!d(a[3],e).length},header:function(e){return/h\d/i.test(e.nodeName)},text:function(e){var t=e.getAttribute("type"),a=e.type;return"input"===e.nodeName.toLowerCase()&&"text"===a&&(t===a||null===t)},radio:function(e){return"input"===e.nodeName.toLowerCase()&&"radio"===e.type},checkbox:function(e){return"input"===e.nodeName.toLowerCase()&&"checkbox"===e.type},file:function(e){return"input"===e.nodeName.toLowerCase()&&"file"===e.type},password:function(e){return"input"===e.nodeName.toLowerCase()&&"password"===e.type},submit:function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&"submit"===e.type},image:function(e){return"input"===e.nodeName.toLowerCase()&&"image"===e.type},reset:function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&"reset"===e.type},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},input:function(e){return/input|select|textarea|button/i.test(e.nodeName)},focus:function(e){return e===e.ownerDocument.activeElement}},setFilters:{first:function(e,t){return 0===t},last:function(e,t,a,n){return t===n.length-1},even:function(e,t){return t%2===0},odd:function(e,t){return t%2===1},lt:function(e,t,a){return t<a[3]-0},gt:function(e,t,a){return t>a[3]-0},nth:function(e,t,a){return a[3]-0===t},eq:function(e,t,a){return a[3]-0===t}},filter:{PSEUDO:function(e,t,a,n){var r=t[1],i=f.filters[r];if(i)return i(e,a,t,n);if("contains"===r)return(e.textContent||e.innerText||p([e])||"").indexOf(t[3])>=0;if("not"===r){for(var o=t[3],s=0,c=o.length;s<c;s++)if(o[s]===e)return!1;return!0}d.error(r)},CHILD:function(e,t){var a,n,i,o,s,c,l=t[1],u=e;switch(l){case"only":case"first":for(;u=u.previousSibling;)if(1===u.nodeType)return!1;if("first"===l)return!0;u=e;case"last":for(;u=u.nextSibling;)if(1===u.nodeType)return!1;return!0;case"nth":if(a=t[2],n=t[3],1===a&&0===n)return!0;if(i=t[0],o=e.parentNode,o&&(o[r]!==i||!e.nodeIndex)){for(s=0,u=o.firstChild;u;u=u.nextSibling)1===u.nodeType&&(u.nodeIndex=++s);o[r]=i}return c=e.nodeIndex-n,0===a?0===c:c%a===0&&c/a>=0}},ID:function(e,t){return 1===e.nodeType&&e.getAttribute("id")===t},TAG:function(e,t){return"*"===t&&1===e.nodeType||!!e.nodeName&&e.nodeName.toLowerCase()===t},CLASS:function(e,t){return(" "+(e.className||e.getAttribute("class"))+" ").indexOf(t)>-1},ATTR:function(e,t){var a=t[1],n=d.attr?d.attr(e,a):f.attrHandle[a]?f.attrHandle[a](e):null!=e[a]?e[a]:e.getAttribute(a),r=n+"",i=t[2],o=t[4];return null==n?"!="===i:!i&&d.attr?null!=n:"="===i?r===o:"*="===i?r.indexOf(o)>=0:"~="===i?(" "+r+" ").indexOf(o)>=0:o?"!="===i?r!==o:"^="===i?0===r.indexOf(o):"$="===i?r.substr(r.length-o.length)===o:"|="===i&&(r===o||r.substr(0,o.length+1)===o+"-"):r&&n!==!1},POS:function(e,t,a,n){var r=t[2],i=f.setFilters[r];if(i)return i(e,a,t,n)}}},m=f.match.POS,g=function(e,t){return"\\"+(t-0+1)};for(var v in f.match)f.match[v]=new RegExp(f.match[v].source+/(?![^\[]*\])(?![^\(]*\))/.source),f.leftMatch[v]=new RegExp(/(^(?:.|\r|\n)*?)/.source+f.match[v].source.replace(/\\(\d+)/g,g));var y=function(e,t){return e=Array.prototype.slice.call(e,0),t?(t.push.apply(t,e),t):e};try{Array.prototype.slice.call(N.documentElement.childNodes,0)[0].nodeType}catch(e){y=function(e,t){var a=0,n=t||[];if("[object Array]"===o.call(e))Array.prototype.push.apply(n,e);else if("number"==typeof e.length)for(var r=e.length;a<r;a++)n.push(e[a]);else for(;e[a];a++)n.push(e[a]);return n}}var b,w;N.documentElement.compareDocumentPosition?b=function(e,t){return e===t?(s=!0,0):e.compareDocumentPosition&&t.compareDocumentPosition?4&e.compareDocumentPosition(t)?-1:1:e.compareDocumentPosition?-1:1}:(b=function(e,t){if(e===t)return s=!0,0;if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var a,n,r=[],i=[],o=e.parentNode,c=t.parentNode,l=o;if(o===c)return w(e,t);if(!o)return-1;if(!c)return 1;for(;l;)r.unshift(l),l=l.parentNode;for(l=c;l;)i.unshift(l),l=l.parentNode;a=r.length,n=i.length;for(var u=0;u<a&&u<n;u++)if(r[u]!==i[u])return w(r[u],i[u]);return u===a?w(e,i[u],-1):w(r[u],t,1)},w=function(e,t,a){if(e===t)return a;for(var n=e.nextSibling;n;){if(n===t)return-1;n=n.nextSibling}return 1}),function(){var e=N.createElement("div"),a="script"+(new Date).getTime(),n=N.documentElement;e.innerHTML="<a name='"+a+"'/>",n.insertBefore(e,n.firstChild),N.getElementById(a)&&(f.find.ID=function(e,a,n){if("undefined"!=typeof a.getElementById&&!n){var r=a.getElementById(e[1]);return r?r.id===e[1]||"undefined"!=typeof r.getAttributeNode&&r.getAttributeNode("id").nodeValue===e[1]?[r]:t:[]}},f.filter.ID=function(e,t){var a="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return 1===e.nodeType&&a&&a.nodeValue===t}),n.removeChild(e),n=e=null}(),function(){var e=N.createElement("div");e.appendChild(N.createComment("")),e.getElementsByTagName("*").length>0&&(f.find.TAG=function(e,t){var a=t.getElementsByTagName(e[1]);if("*"===e[1]){for(var n=[],r=0;a[r];r++)1===a[r].nodeType&&n.push(a[r]);a=n}return a}),e.innerHTML="<a href='#'></a>",e.firstChild&&"undefined"!=typeof e.firstChild.getAttribute&&"#"!==e.firstChild.getAttribute("href")&&(f.attrHandle.href=function(e){return e.getAttribute("href",2)}),e=null}(),N.querySelectorAll&&function(){var e=d,t=N.createElement("div"),a="__sizzle__";if(t.innerHTML="<p class='TEST'></p>",!t.querySelectorAll||0!==t.querySelectorAll(".TEST").length){d=function(t,n,r,i){if(n=n||N,!i&&!d.isXML(n)){var o=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(t);if(o&&(1===n.nodeType||9===n.nodeType)){if(o[1])return y(n.getElementsByTagName(t),r);if(o[2]&&f.find.CLASS&&n.getElementsByClassName)return y(n.getElementsByClassName(o[2]),r)}if(9===n.nodeType){if("body"===t&&n.body)return y([n.body],r);if(o&&o[3]){var s=n.getElementById(o[3]);if(!s||!s.parentNode)return y([],r);if(s.id===o[3])return y([s],r)}try{return y(n.querySelectorAll(t),r)}catch(e){}}else if(1===n.nodeType&&"object"!==n.nodeName.toLowerCase()){var c=n,l=n.getAttribute("id"),u=l||a,h=n.parentNode,p=/^\s*[+~]/.test(t);l?u=u.replace(/'/g,"\\$&"):n.setAttribute("id",u),p&&h&&(n=n.parentNode);try{if(!p||h)return y(n.querySelectorAll("[id='"+u+"'] "+t),r)}catch(e){}finally{l||c.removeAttribute("id")}}}return e(t,n,r,i)};for(var n in e)d[n]=e[n];t=null}}(),function(){var e=N.documentElement,t=e.matchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.msMatchesSelector;if(t){var a=!t.call(N.createElement("div"),"div"),n=!1;try{t.call(N.documentElement,"[test!='']:sizzle")}catch(e){n=!0}d.matchesSelector=function(e,r){if(r=r.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']"),!d.isXML(e))try{if(n||!f.match.PSEUDO.test(r)&&!/!=/.test(r)){var i=t.call(e,r);if(i||!a||e.document&&11!==e.document.nodeType)return i}}catch(e){}return d(r,null,null,[e]).length>0}}}(),function(){var e=N.createElement("div");if(e.innerHTML="<div class='test e'></div><div class='test'></div>",e.getElementsByClassName&&0!==e.getElementsByClassName("e").length){if(e.lastChild.className="e",1===e.getElementsByClassName("e").length)return;f.order.splice(1,0,"CLASS"),f.find.CLASS=function(e,t,a){if("undefined"!=typeof t.getElementsByClassName&&!a)return t.getElementsByClassName(e[1])},e=null}}(),N.documentElement.contains?d.contains=function(e,t){return e!==t&&(!e.contains||e.contains(t))}:N.documentElement.compareDocumentPosition?d.contains=function(e,t){return!!(16&e.compareDocumentPosition(t))}:d.contains=function(){return!1},d.isXML=function(e){var t=(e?e.ownerDocument||e:0).documentElement;return!!t&&"HTML"!==t.nodeName};var C=function(e,t,a){for(var n,r=[],i="",o=t.nodeType?[t]:t;n=f.match.PSEUDO.exec(e);)i+=n[0],e=e.replace(f.match.PSEUDO,"");e=f.relative[e]?e+"*":e;for(var s=0,c=o.length;s<c;s++)d(e,o[s],r,a);return d.filter(i,r)};d.attr=E.attr,d.selectors.attrMap={},E.find=d,E.expr=d.selectors,E.expr[":"]=E.expr.filters,E.unique=d.uniqueSort,E.text=d.getText,E.isXMLDoc=d.isXML,E.contains=d.contains}();var ce=/Until$/,le=/^(?:parents|prevUntil|prevAll)/,ue=/,/,he=/^.[^:#\[\.,]*$/,de=Array.prototype.slice,pe=E.expr.match.POS,fe={children:!0,contents:!0,next:!0,prev:!0};E.fn.extend({find:function(e){var t,a,n=this;if("string"!=typeof e)return E(e).filter(function(){for(t=0,a=n.length;t<a;t++)if(E.contains(n[t],this))return!0});var r,i,o,s=this.pushStack("","find",e);for(t=0,a=this.length;t<a;t++)if(r=s.length,E.find(e,this[t],s),t>0)for(i=r;i<s.length;i++)for(o=0;o<r;o++)if(s[o]===s[i]){s.splice(i--,1);break}return s},has:function(e){var t=E(e);return this.filter(function(){for(var e=0,a=t.length;e<a;e++)if(E.contains(this,t[e]))return!0})},not:function(e){return this.pushStack($(this,e,!1),"not",e)},filter:function(e){return this.pushStack($(this,e,!0),"filter",e)},is:function(e){return!!e&&("string"==typeof e?pe.test(e)?E(e,this.context).index(this[0])>=0:E.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var a,n,r=[],i=this[0];if(E.isArray(e)){for(var o=1;i&&i.ownerDocument&&i!==t;){for(a=0;a<e.length;a++)E(i).is(e[a])&&r.push({selector:e[a],elem:i,level:o});i=i.parentNode,o++}return r}var s=pe.test(e)||"string"!=typeof e?E(e,t||this.context):0;for(a=0,n=this.length;a<n;a++)for(i=this[a];i;){if(s?s.index(i)>-1:E.find.matchesSelector(i,e)){r.push(i);break}if(i=i.parentNode,!i||!i.ownerDocument||i===t||11===i.nodeType)break}return r=r.length>1?E.unique(r):r,this.pushStack(r,"closest",e)},index:function(e){return e?"string"==typeof e?E.inArray(this[0],E(e)):E.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(e,t){var a="string"==typeof e?E(e,t):E.makeArray(e&&e.nodeType?[e]:e),n=E.merge(this.get(),a);return this.pushStack(S(a[0])||S(n[0])?n:E.unique(n))},andSelf:function(){return this.add(this.prevObject)}}),E.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return E.dir(e,"parentNode")},parentsUntil:function(e,t,a){return E.dir(e,"parentNode",a)},next:function(e){return E.nth(e,2,"nextSibling")},prev:function(e){return E.nth(e,2,"previousSibling")},nextAll:function(e){return E.dir(e,"nextSibling")},prevAll:function(e){return E.dir(e,"previousSibling")},nextUntil:function(e,t,a){return E.dir(e,"nextSibling",a)},prevUntil:function(e,t,a){return E.dir(e,"previousSibling",a)},siblings:function(e){return E.sibling(e.parentNode.firstChild,e)},children:function(e){return E.sibling(e.firstChild)},contents:function(e){return E.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:E.makeArray(e.childNodes)}},function(e,t){E.fn[e]=function(a,n){var r=E.map(this,t,a);return ce.test(e)||(n=a),n&&"string"==typeof n&&(r=E.filter(n,r)),r=this.length>1&&!fe[e]?E.unique(r):r,(this.length>1||ue.test(n))&&le.test(e)&&(r=r.reverse()),this.pushStack(r,e,de.call(arguments).join(","))}}),E.extend({filter:function(e,t,a){return a&&(e=":not("+e+")"),1===t.length?E.find.matchesSelector(t[0],e)?[t[0]]:[]:E.find.matches(e,t)},dir:function(e,a,n){for(var r=[],i=e[a];i&&9!==i.nodeType&&(n===t||1!==i.nodeType||!E(i).is(n));)1===i.nodeType&&r.push(i),i=i[a];return r},nth:function(e,t,a,n){t=t||1;for(var r=0;e&&(1!==e.nodeType||++r!==t);e=e[a]);return e},sibling:function(e,t){for(var a=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&a.push(e);return a}});var me="abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",ge=/ jQuery\d+="(?:\d+|null)"/g,ve=/^\s+/,ye=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,be=/<([\w:]+)/,we=/<tbody/i,Ce=/<|&#?\w+;/,Te=/<(?:script|style)/i,ke=/<(?:script|object|embed|option|style)/i,xe=new RegExp("<(?:"+me+")","i"),$e=/checked\s*(?:[^=]|=\s*.checked.)/i,Se=/\/(java|ecma)script/i,Pe=/^\s*<!(?:\[CDATA\[|\-\-)/,Ie={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},De=x(N);Ie.optgroup=Ie.option,Ie.tbody=Ie.tfoot=Ie.colgroup=Ie.caption=Ie.thead,Ie.th=Ie.td,E.support.htmlSerialize||(Ie._default=[1,"div<div>","</div>"]),E.fn.extend({text:function(e){return E.isFunction(e)?this.each(function(t){var a=E(this);a.text(e.call(this,t,a.text()))}):"object"!=typeof e&&e!==t?this.empty().append((this[0]&&this[0].ownerDocument||N).createTextNode(e)):E.text(this)},wrapAll:function(e){if(E.isFunction(e))return this.each(function(t){E(this).wrapAll(e.call(this,t))});if(this[0]){var t=E(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;
return e}).append(this)}return this},wrapInner:function(e){return E.isFunction(e)?this.each(function(t){E(this).wrapInner(e.call(this,t))}):this.each(function(){var t=E(this),a=t.contents();a.length?a.wrapAll(e):t.append(e)})},wrap:function(e){var t=E.isFunction(e);return this.each(function(a){E(this).wrapAll(t?e.call(this,a):e)})},unwrap:function(){return this.parent().each(function(){E.nodeName(this,"body")||E(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){1===this.nodeType&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){1===this.nodeType&&this.insertBefore(e,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this)});if(arguments.length){var e=E.clean(arguments);return e.push.apply(e,this.toArray()),this.pushStack(e,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this.nextSibling)});if(arguments.length){var e=this.pushStack(this,"after",arguments);return e.push.apply(e,E.clean(arguments)),e}},remove:function(e,t){for(var a,n=0;null!=(a=this[n]);n++)e&&!E.filter(e,[a]).length||(!t&&1===a.nodeType&&(E.cleanData(a.getElementsByTagName("*")),E.cleanData([a])),a.parentNode&&a.parentNode.removeChild(a));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)for(1===e.nodeType&&E.cleanData(e.getElementsByTagName("*"));e.firstChild;)e.removeChild(e.firstChild);return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return E.clone(this,e,t)})},html:function(e){if(e===t)return this[0]&&1===this[0].nodeType?this[0].innerHTML.replace(ge,""):null;if("string"!=typeof e||Te.test(e)||!E.support.leadingWhitespace&&ve.test(e)||Ie[(be.exec(e)||["",""])[1].toLowerCase()])E.isFunction(e)?this.each(function(t){var a=E(this);a.html(e.call(this,t,a.html()))}):this.empty().append(e);else{e=e.replace(ye,"<$1></$2>");try{for(var a=0,n=this.length;a<n;a++)1===this[a].nodeType&&(E.cleanData(this[a].getElementsByTagName("*")),this[a].innerHTML=e)}catch(t){this.empty().append(e)}}return this},replaceWith:function(e){return this[0]&&this[0].parentNode?E.isFunction(e)?this.each(function(t){var a=E(this),n=a.html();a.replaceWith(e.call(this,t,n))}):("string"!=typeof e&&(e=E(e).detach()),this.each(function(){var t=this.nextSibling,a=this.parentNode;E(this).remove(),t?E(t).before(e):E(a).append(e)})):this.length?this.pushStack(E(E.isFunction(e)?e():e),"replaceWith",e):this},detach:function(e){return this.remove(e,!0)},domManip:function(e,a,n){var r,i,o,s,c=e[0],l=[];if(!E.support.checkClone&&3===arguments.length&&"string"==typeof c&&$e.test(c))return this.each(function(){E(this).domManip(e,a,n,!0)});if(E.isFunction(c))return this.each(function(r){var i=E(this);e[0]=c.call(this,r,a?i.html():t),i.domManip(e,a,n)});if(this[0]){if(s=c&&c.parentNode,r=E.support.parentNode&&s&&11===s.nodeType&&s.childNodes.length===this.length?{fragment:s}:E.buildFragment(e,this,l),o=r.fragment,i=1===o.childNodes.length?o=o.firstChild:o.firstChild,i){a=a&&E.nodeName(i,"tr");for(var u=0,h=this.length,d=h-1;u<h;u++)n.call(a?k(this[u],i):this[u],r.cacheable||h>1&&u<d?E.clone(o,!0,!0):o)}l.length&&E.each(l,g)}return this}}),E.buildFragment=function(e,t,a){var n,r,i,o,s=e[0];return t&&t[0]&&(o=t[0].ownerDocument||t[0]),o.createDocumentFragment||(o=N),1===e.length&&"string"==typeof s&&s.length<512&&o===N&&"<"===s.charAt(0)&&!ke.test(s)&&(E.support.checkClone||!$e.test(s))&&(E.support.html5Clone||!xe.test(s))&&(r=!0,i=E.fragments[s],i&&1!==i&&(n=i)),n||(n=o.createDocumentFragment(),E.clean(e,o,n,a)),r&&(E.fragments[s]=i?n:1),{fragment:n,cacheable:r}},E.fragments={},E.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){E.fn[e]=function(a){var n=[],r=E(a),i=1===this.length&&this[0].parentNode;if(i&&11===i.nodeType&&1===i.childNodes.length&&1===r.length)return r[t](this[0]),this;for(var o=0,s=r.length;o<s;o++){var c=(o>0?this.clone(!0):this).get();E(r[o])[t](c),n=n.concat(c)}return this.pushStack(n,e,r.selector)}}),E.extend({clone:function(e,t,a){var n,r,i,o=E.support.html5Clone||!xe.test("<"+e.nodeName)?e.cloneNode(!0):v(e);if(!(E.support.noCloneEvent&&E.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||E.isXMLDoc(e)))for(C(e,o),n=w(e),r=w(o),i=0;n[i];++i)r[i]&&C(n[i],r[i]);if(t&&(T(e,o),a))for(n=w(e),r=w(o),i=0;n[i];++i)T(n[i],r[i]);return n=r=null,o},clean:function(e,t,a,n){var r;t=t||N,"undefined"==typeof t.createElement&&(t=t.ownerDocument||t[0]&&t[0].ownerDocument||N);for(var i,o,s=[],c=0;null!=(o=e[c]);c++)if("number"==typeof o&&(o+=""),o){if("string"==typeof o)if(Ce.test(o)){o=o.replace(ye,"<$1></$2>");var l=(be.exec(o)||["",""])[1].toLowerCase(),u=Ie[l]||Ie._default,h=u[0],d=t.createElement("div");for(t===N?De.appendChild(d):x(t).appendChild(d),d.innerHTML=u[1]+o+u[2];h--;)d=d.lastChild;if(!E.support.tbody){var p=we.test(o),f="table"!==l||p?"<table>"!==u[1]||p?[]:d.childNodes:d.firstChild&&d.firstChild.childNodes;for(i=f.length-1;i>=0;--i)E.nodeName(f[i],"tbody")&&!f[i].childNodes.length&&f[i].parentNode.removeChild(f[i])}!E.support.leadingWhitespace&&ve.test(o)&&d.insertBefore(t.createTextNode(ve.exec(o)[0]),d.firstChild),o=d.childNodes}else o=t.createTextNode(o);var m;if(!E.support.appendChecked)if(o[0]&&"number"==typeof(m=o.length))for(i=0;i<m;i++)y(o[i]);else y(o);o.nodeType?s.push(o):s=E.merge(s,o)}if(a)for(r=function(e){return!e.type||Se.test(e.type)},c=0;s[c];c++)if(!n||!E.nodeName(s[c],"script")||s[c].type&&"text/javascript"!==s[c].type.toLowerCase()){if(1===s[c].nodeType){var g=E.grep(s[c].getElementsByTagName("script"),r);s.splice.apply(s,[c+1,0].concat(g))}a.appendChild(s[c])}else n.push(s[c].parentNode?s[c].parentNode.removeChild(s[c]):s[c]);return s},cleanData:function(e){for(var t,a,n,r=E.cache,i=E.event.special,o=E.support.deleteExpando,s=0;null!=(n=e[s]);s++)if((!n.nodeName||!E.noData[n.nodeName.toLowerCase()])&&(a=n[E.expando])){if(t=r[a],t&&t.events){for(var c in t.events)i[c]?E.event.remove(n,c):E.removeEvent(n,c,t.handle);t.handle&&(t.handle.elem=null)}o?delete n[E.expando]:n.removeAttribute&&n.removeAttribute(E.expando),delete r[a]}}});var Oe,Me,Ae,Ne=/alpha\([^)]*\)/i,Fe=/opacity=([^)]*)/,Le=/([A-Z]|^ms)/g,Ee=/^-?\d+(?:px)?$/i,Re=/^-?\d/,je=/^([\-+])=([\-+.\de]+)/,_e={position:"absolute",visibility:"hidden",display:"block"},He=["Left","Right"],We=["Top","Bottom"];E.fn.css=function(e,a){return 2===arguments.length&&a===t?this:E.access(this,e,a,!0,function(e,a,n){return n!==t?E.style(e,a,n):E.css(e,a)})},E.extend({cssHooks:{opacity:{get:function(e,t){if(t){var a=Oe(e,"opacity","opacity");return""===a?"1":a}return e.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:E.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,a,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,s=E.camelCase(a),c=e.style,l=E.cssHooks[s];if(a=E.cssProps[s]||s,n===t)return l&&"get"in l&&(i=l.get(e,!1,r))!==t?i:c[a];if(o=typeof n,"string"===o&&(i=je.exec(n))&&(n=+(i[1]+1)*+i[2]+parseFloat(E.css(e,a)),o="number"),null==n||"number"===o&&isNaN(n))return;if("number"===o&&!E.cssNumber[s]&&(n+="px"),!(l&&"set"in l&&(n=l.set(e,n))===t))try{c[a]=n}catch(e){}}},css:function(e,a,n){var r,i;return a=E.camelCase(a),i=E.cssHooks[a],a=E.cssProps[a]||a,"cssFloat"===a&&(a="float"),i&&"get"in i&&(r=i.get(e,!0,n))!==t?r:Oe?Oe(e,a):void 0},swap:function(e,t,a){var n={};for(var r in t)n[r]=e.style[r],e.style[r]=t[r];a.call(e);for(r in t)e.style[r]=n[r]}}),E.curCSS=E.css,E.each(["height","width"],function(e,t){E.cssHooks[t]={get:function(e,a,n){var r;if(a)return 0!==e.offsetWidth?m(e,t,n):(E.swap(e,_e,function(){r=m(e,t,n)}),r)},set:function(e,t){return Ee.test(t)?(t=parseFloat(t),t>=0?t+"px":void 0):t}}}),E.support.opacity||(E.cssHooks.opacity={get:function(e,t){return Fe.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?parseFloat(RegExp.$1)/100+"":t?"1":""},set:function(e,t){var a=e.style,n=e.currentStyle,r=E.isNumeric(t)?"alpha(opacity="+100*t+")":"",i=n&&n.filter||a.filter||"";a.zoom=1,t>=1&&""===E.trim(i.replace(Ne,""))&&(a.removeAttribute("filter"),n&&!n.filter)||(a.filter=Ne.test(i)?i.replace(Ne,r):i+" "+r)}}),E(function(){E.support.reliableMarginRight||(E.cssHooks.marginRight={get:function(e,t){var a;return E.swap(e,{display:"inline-block"},function(){a=t?Oe(e,"margin-right","marginRight"):e.style.marginRight}),a}})}),N.defaultView&&N.defaultView.getComputedStyle&&(Me=function(e,t){var a,n,r;return t=t.replace(Le,"-$1").toLowerCase(),(n=e.ownerDocument.defaultView)&&(r=n.getComputedStyle(e,null))&&(a=r.getPropertyValue(t),""===a&&!E.contains(e.ownerDocument.documentElement,e)&&(a=E.style(e,t))),a}),N.documentElement.currentStyle&&(Ae=function(e,t){var a,n,r,i=e.currentStyle&&e.currentStyle[t],o=e.style;return null===i&&o&&(r=o[t])&&(i=r),!Ee.test(i)&&Re.test(i)&&(a=o.left,n=e.runtimeStyle&&e.runtimeStyle.left,n&&(e.runtimeStyle.left=e.currentStyle.left),o.left="fontSize"===t?"1em":i||0,i=o.pixelLeft+"px",o.left=a,n&&(e.runtimeStyle.left=n)),""===i?"auto":i}),Oe=Me||Ae,E.expr&&E.expr.filters&&(E.expr.filters.hidden=function(e){var t=e.offsetWidth,a=e.offsetHeight;return 0===t&&0===a||!E.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||E.css(e,"display"))},E.expr.filters.visible=function(e){return!E.expr.filters.hidden(e)});var Be,Ue,qe=/%20/g,Ve=/\[\]$/,Ge=/\r?\n/g,ze=/#.*$/,Xe=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Je=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,Ke=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,Ye=/^(?:GET|HEAD)$/,Qe=/^\/\//,Ze=/\?/,et=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,tt=/^(?:select|textarea)/i,at=/\s+/,nt=/([?&])_=[^&]*/,rt=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,it=E.fn.load,ot={},st={},ct=["*/"]+["*"];try{Be=L.href}catch(e){Be=N.createElement("a"),Be.href="",Be=Be.href}Ue=rt.exec(Be.toLowerCase())||[],E.fn.extend({load:function(e,a,n){if("string"!=typeof e&&it)return it.apply(this,arguments);if(!this.length)return this;var r=e.indexOf(" ");if(r>=0){var i=e.slice(r,e.length);e=e.slice(0,r)}var o="GET";a&&(E.isFunction(a)?(n=a,a=t):"object"==typeof a&&(a=E.param(a,E.ajaxSettings.traditional),o="POST"));var s=this;return E.ajax({url:e,type:o,dataType:"html",data:a,complete:function(e,t,a){a=e.responseText,e.isResolved()&&(e.done(function(e){a=e}),s.html(i?E("<div>").append(a.replace(et,"")).find(i):a)),n&&s.each(n,[a,t,e])}}),this},serialize:function(){return E.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?E.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||tt.test(this.nodeName)||Je.test(this.type))}).map(function(e,t){var a=E(this).val();return null==a?null:E.isArray(a)?E.map(a,function(e,a){return{name:t.name,value:e.replace(Ge,"\r\n")}}):{name:t.name,value:a.replace(Ge,"\r\n")}}).get()}}),E.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){E.fn[t]=function(e){return this.on(t,e)}}),E.each(["get","post"],function(e,a){E[a]=function(e,n,r,i){return E.isFunction(n)&&(i=i||r,r=n,n=t),E.ajax({type:a,url:e,data:n,success:r,dataType:i})}}),E.extend({getScript:function(e,a){return E.get(e,t,a,"script")},getJSON:function(e,t,a){return E.get(e,t,a,"json")},ajaxSetup:function(e,t){return t?d(e,E.ajaxSettings):(t=e,e=E.ajaxSettings),d(e,t),e},ajaxSettings:{url:Be,isLocal:Ke.test(Ue[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":ct},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":E.parseJSON,"text xml":E.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:f(ot),ajaxTransport:f(st),ajax:function(e,a){function n(e,a,n,o){if(2!==k){k=2,c&&clearTimeout(c),s=t,i=o||"",x.readyState=e>0?4:0;var h,p,f,C,T,$=a,S=n?u(m,x,n):t;if(e>=200&&e<300||304===e)if(m.ifModified&&((C=x.getResponseHeader("Last-Modified"))&&(E.lastModified[r]=C),(T=x.getResponseHeader("Etag"))&&(E.etag[r]=T)),304===e)$="notmodified",h=!0;else try{p=l(m,S),$="success",h=!0}catch(e){$="parsererror",f=e}else f=$,$&&!e||($="error",e<0&&(e=0));x.status=e,x.statusText=""+(a||$),h?y.resolveWith(g,[p,$,x]):y.rejectWith(g,[x,$,f]),x.statusCode(w),w=t,d&&v.trigger("ajax"+(h?"Success":"Error"),[x,m,h?p:f]),b.fireWith(g,[x,$]),d&&(v.trigger("ajaxComplete",[x,m]),--E.active||E.event.trigger("ajaxStop"))}}"object"==typeof e&&(a=e,e=t),a=a||{};var r,i,o,s,c,h,d,f,m=E.ajaxSetup({},a),g=m.context||m,v=g!==m&&(g.nodeType||g instanceof E)?E(g):E.event,y=E.Deferred(),b=E.Callbacks("once memory"),w=m.statusCode||{},C={},T={},k=0,x={readyState:0,setRequestHeader:function(e,t){if(!k){var a=e.toLowerCase();e=T[a]=T[a]||e,C[e]=t}return this},getAllResponseHeaders:function(){return 2===k?i:null},getResponseHeader:function(e){var a;if(2===k){if(!o)for(o={};a=Xe.exec(i);)o[a[1].toLowerCase()]=a[2];a=o[e.toLowerCase()]}return a===t?null:a},overrideMimeType:function(e){return k||(m.mimeType=e),this},abort:function(e){return e=e||"abort",s&&s.abort(e),n(0,e),this}};if(y.promise(x),x.success=x.done,x.error=x.fail,x.complete=b.add,x.statusCode=function(e){if(e){var t;if(k<2)for(t in e)w[t]=[w[t],e[t]];else t=e[x.status],x.then(t,t)}return this},m.url=((e||m.url)+"").replace(ze,"").replace(Qe,Ue[1]+"//"),m.dataTypes=E.trim(m.dataType||"*").toLowerCase().split(at),null==m.crossDomain&&(h=rt.exec(m.url.toLowerCase()),m.crossDomain=!(!h||h[1]==Ue[1]&&h[2]==Ue[2]&&(h[3]||("http:"===h[1]?80:443))==(Ue[3]||("http:"===Ue[1]?80:443)))),m.data&&m.processData&&"string"!=typeof m.data&&(m.data=E.param(m.data,m.traditional)),p(ot,m,a,x),2===k)return!1;if(d=m.global,m.type=m.type.toUpperCase(),m.hasContent=!Ye.test(m.type),d&&0===E.active++&&E.event.trigger("ajaxStart"),!m.hasContent&&(m.data&&(m.url+=(Ze.test(m.url)?"&":"?")+m.data,delete m.data),r=m.url,m.cache===!1)){var $=E.now(),S=m.url.replace(nt,"$1_="+$);m.url=S+(S===m.url?(Ze.test(m.url)?"&":"?")+"_="+$:"")}(m.data&&m.hasContent&&m.contentType!==!1||a.contentType)&&x.setRequestHeader("Content-Type",m.contentType),m.ifModified&&(r=r||m.url,E.lastModified[r]&&x.setRequestHeader("If-Modified-Since",E.lastModified[r]),E.etag[r]&&x.setRequestHeader("If-None-Match",E.etag[r])),x.setRequestHeader("Accept",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+("*"!==m.dataTypes[0]?", "+ct+"; q=0.01":""):m.accepts["*"]);for(f in m.headers)x.setRequestHeader(f,m.headers[f]);if(m.beforeSend&&(m.beforeSend.call(g,x,m)===!1||2===k))return x.abort(),!1;for(f in{success:1,error:1,complete:1})x[f](m[f]);if(s=p(st,m,a,x)){x.readyState=1,d&&v.trigger("ajaxSend",[x,m]),m.async&&m.timeout>0&&(c=setTimeout(function(){x.abort("timeout")},m.timeout));try{k=1,s.send(C,n)}catch(e){if(!(k<2))throw e;n(-1,e)}}else n(-1,"No Transport");return x},param:function(e,a){var n=[],r=function(e,t){t=E.isFunction(t)?t():t,n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(a===t&&(a=E.ajaxSettings.traditional),E.isArray(e)||e.jquery&&!E.isPlainObject(e))E.each(e,function(){r(this.name,this.value)});else for(var i in e)h(i,e[i],a,r);return n.join("&").replace(qe,"+")}}),E.extend({active:0,lastModified:{},etag:{}});var lt=E.now(),ut=/(\=)\?(&|$)|\?\?/i;E.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return E.expando+"_"+lt++}}),E.ajaxPrefilter("json jsonp",function(t,a,n){var r="application/x-www-form-urlencoded"===t.contentType&&"string"==typeof t.data;if("jsonp"===t.dataTypes[0]||t.jsonp!==!1&&(ut.test(t.url)||r&&ut.test(t.data))){var i,o=t.jsonpCallback=E.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s=e[o],c=t.url,l=t.data,u="$1"+o+"$2";return t.jsonp!==!1&&(c=c.replace(ut,u),t.url===c&&(r&&(l=l.replace(ut,u)),t.data===l&&(c+=(/\?/.test(c)?"&":"?")+t.jsonp+"="+o))),t.url=c,t.data=l,e[o]=function(e){i=[e]},n.always(function(){e[o]=s,i&&E.isFunction(s)&&e[o](i[0])}),t.converters["script json"]=function(){return i||E.error(o+" was not called"),i[0]},t.dataTypes[0]="json","script"}}),E.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){return E.globalEval(e),e}}}),E.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),E.ajaxTransport("script",function(e){if(e.crossDomain){var a,n=N.head||N.getElementsByTagName("head")[0]||N.documentElement;return{send:function(r,i){a=N.createElement("script"),a.async="async",e.scriptCharset&&(a.charset=e.scriptCharset),a.src=e.url,a.onload=a.onreadystatechange=function(e,r){(r||!a.readyState||/loaded|complete/.test(a.readyState))&&(a.onload=a.onreadystatechange=null,n&&a.parentNode&&n.removeChild(a),a=t,r||i(200,"success"))},n.insertBefore(a,n.firstChild)},abort:function(){a&&a.onload(0,1)}}}});var ht,dt=!!e.ActiveXObject&&function(){for(var e in ht)ht[e](0,1)},pt=0;E.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&c()||s()}:c,function(e){E.extend(E.support,{ajax:!!e,cors:!!e&&"withCredentials"in e})}(E.ajaxSettings.xhr()),E.support.ajax&&E.ajaxTransport(function(a){if(!a.crossDomain||E.support.cors){var n;return{send:function(r,i){var o,s,c=a.xhr();if(a.username?c.open(a.type,a.url,a.async,a.username,a.password):c.open(a.type,a.url,a.async),a.xhrFields)for(s in a.xhrFields)c[s]=a.xhrFields[s];a.mimeType&&c.overrideMimeType&&c.overrideMimeType(a.mimeType),!a.crossDomain&&!r["X-Requested-With"]&&(r["X-Requested-With"]="XMLHttpRequest");try{for(s in r)c.setRequestHeader(s,r[s])}catch(e){}c.send(a.hasContent&&a.data||null),n=function(e,r){var s,l,u,h,d;try{if(n&&(r||4===c.readyState))if(n=t,o&&(c.onreadystatechange=E.noop,dt&&delete ht[o]),r)4!==c.readyState&&c.abort();else{s=c.status,u=c.getAllResponseHeaders(),h={},d=c.responseXML,d&&d.documentElement&&(h.xml=d),h.text=c.responseText;try{l=c.statusText}catch(e){l=""}s||!a.isLocal||a.crossDomain?1223===s&&(s=204):s=h.text?200:404}}catch(e){r||i(-1,e)}h&&i(s,l,h,u)},a.async&&4!==c.readyState?(o=++pt,dt&&(ht||(ht={},E(e).unload(dt)),ht[o]=n),c.onreadystatechange=n):n()},abort:function(){n&&n(0,1)}}}});var ft,mt,gt,vt,yt={},bt=/^(?:toggle|show|hide)$/,wt=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,Ct=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];E.fn.extend({show:function(e,t,a){var i,o;if(e||0===e)return this.animate(r("show",3),e,t,a);for(var s=0,c=this.length;s<c;s++)i=this[s],i.style&&(o=i.style.display,!E._data(i,"olddisplay")&&"none"===o&&(o=i.style.display=""),""===o&&"none"===E.css(i,"display")&&E._data(i,"olddisplay",n(i.nodeName)));for(s=0;s<c;s++)i=this[s],i.style&&(o=i.style.display,""!==o&&"none"!==o||(i.style.display=E._data(i,"olddisplay")||""));return this},hide:function(e,t,a){if(e||0===e)return this.animate(r("hide",3),e,t,a);for(var n,i,o=0,s=this.length;o<s;o++)n=this[o],n.style&&(i=E.css(n,"display"),"none"!==i&&!E._data(n,"olddisplay")&&E._data(n,"olddisplay",i));for(o=0;o<s;o++)this[o].style&&(this[o].style.display="none");return this},_toggle:E.fn.toggle,toggle:function(e,t,a){var n="boolean"==typeof e;return E.isFunction(e)&&E.isFunction(t)?this._toggle.apply(this,arguments):null==e||n?this.each(function(){var t=n?e:E(this).is(":hidden");E(this)[t?"show":"hide"]()}):this.animate(r("toggle",3),e,t,a),this},fadeTo:function(e,t,a,n){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:t},e,a,n)},animate:function(e,t,a,r){function i(){o.queue===!1&&E._mark(this);var t,a,r,i,s,c,l,u,h,d=E.extend({},o),p=1===this.nodeType,f=p&&E(this).is(":hidden");d.animatedProperties={};for(r in e){if(t=E.camelCase(r),r!==t&&(e[t]=e[r],delete e[r]),a=e[t],E.isArray(a)?(d.animatedProperties[t]=a[1],a=e[t]=a[0]):d.animatedProperties[t]=d.specialEasing&&d.specialEasing[t]||d.easing||"swing","hide"===a&&f||"show"===a&&!f)return d.complete.call(this);p&&("height"===t||"width"===t)&&(d.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],"inline"===E.css(this,"display")&&"none"===E.css(this,"float")&&(E.support.inlineBlockNeedsLayout&&"inline"!==n(this.nodeName)?this.style.zoom=1:this.style.display="inline-block"))}null!=d.overflow&&(this.style.overflow="hidden");for(r in e)i=new E.fx(this,d,r),a=e[r],bt.test(a)?(h=E._data(this,"toggle"+r)||("toggle"===a?f?"show":"hide":0),h?(E._data(this,"toggle"+r,"show"===h?"hide":"show"),i[h]()):i[a]()):(s=wt.exec(a),c=i.cur(),s?(l=parseFloat(s[2]),u=s[3]||(E.cssNumber[r]?"":"px"),"px"!==u&&(E.style(this,r,(l||1)+u),c=(l||1)/i.cur()*c,E.style(this,r,c+u)),s[1]&&(l=("-="===s[1]?-1:1)*l+c),i.custom(c,l,u)):i.custom(c,a,""));return!0}var o=E.speed(t,a,r);return E.isEmptyObject(e)?this.each(o.complete,[!1]):(e=E.extend({},e),o.queue===!1?this.each(i):this.queue(o.queue,i))},stop:function(e,a,n){return"string"!=typeof e&&(n=a,a=e,e=t),a&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){function t(e,t,a){var r=t[a];E.removeData(e,a,!0),r.stop(n)}var a,r=!1,i=E.timers,o=E._data(this);if(n||E._unmark(!0,this),null==e)for(a in o)o[a]&&o[a].stop&&a.indexOf(".run")===a.length-4&&t(this,o,a);else o[a=e+".run"]&&o[a].stop&&t(this,o,a);for(a=i.length;a--;)i[a].elem===this&&(null==e||i[a].queue===e)&&(n?i[a](!0):i[a].saveState(),r=!0,i.splice(a,1));(!n||!r)&&E.dequeue(this,e)})}}),E.each({slideDown:r("show",1),slideUp:r("hide",1),slideToggle:r("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){E.fn[e]=function(e,a,n){return this.animate(t,e,a,n)}}),E.extend({speed:function(e,t,a){var n=e&&"object"==typeof e?E.extend({},e):{complete:a||!a&&t||E.isFunction(e)&&e,duration:e,easing:a&&t||t&&!E.isFunction(t)&&t};return n.duration=E.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in E.fx.speeds?E.fx.speeds[n.duration]:E.fx.speeds._default,null!=n.queue&&n.queue!==!0||(n.queue="fx"),n.old=n.complete,n.complete=function(e){E.isFunction(n.old)&&n.old.call(this),n.queue?E.dequeue(this,n.queue):e!==!1&&E._unmark(this)},n},easing:{linear:function(e,t,a,n){return a+n*e},swing:function(e,t,a,n){return(-Math.cos(e*Math.PI)/2+.5)*n+a}},timers:[],fx:function(e,t,a){this.options=t,this.elem=e,this.prop=a,t.orig=t.orig||{}}}),E.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(E.fx.step[this.prop]||E.fx.step._default)(this)},cur:function(){if(null!=this.elem[this.prop]&&(!this.elem.style||null==this.elem.style[this.prop]))return this.elem[this.prop];var e,t=E.css(this.elem,this.prop);return isNaN(e=parseFloat(t))?t&&"auto"!==t?t:0:e},custom:function(e,a,n){function r(e){return i.step(e)}var i=this,s=E.fx;this.startTime=vt||o(),this.end=a,this.now=this.start=e,this.pos=this.state=0,this.unit=n||this.unit||(E.cssNumber[this.prop]?"":"px"),r.queue=this.options.queue,r.elem=this.elem,r.saveState=function(){i.options.hide&&E._data(i.elem,"fxshow"+i.prop)===t&&E._data(i.elem,"fxshow"+i.prop,i.start)},r()&&E.timers.push(r)&&!gt&&(gt=setInterval(s.tick,s.interval))},show:function(){var e=E._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=e||E.style(this.elem,this.prop),this.options.show=!0,e!==t?this.custom(this.cur(),e):this.custom("width"===this.prop||"height"===this.prop?1:0,this.cur()),E(this.elem).show()},hide:function(){this.options.orig[this.prop]=E._data(this.elem,"fxshow"+this.prop)||E.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(e){var t,a,n,r=vt||o(),i=!0,s=this.elem,c=this.options;if(e||r>=c.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),c.animatedProperties[this.prop]=!0;for(t in c.animatedProperties)c.animatedProperties[t]!==!0&&(i=!1);if(i){if(null!=c.overflow&&!E.support.shrinkWrapBlocks&&E.each(["","X","Y"],function(e,t){s.style["overflow"+t]=c.overflow[e]}),c.hide&&E(s).hide(),c.hide||c.show)for(t in c.animatedProperties)E.style(s,t,c.orig[t]),E.removeData(s,"fxshow"+t,!0),E.removeData(s,"toggle"+t,!0);n=c.complete,n&&(c.complete=!1,n.call(s))}return!1}return c.duration==1/0?this.now=r:(a=r-this.startTime,this.state=a/c.duration,this.pos=E.easing[c.animatedProperties[this.prop]](this.state,a,0,1,c.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update(),!0}},E.extend(E.fx,{tick:function(){for(var e,t=E.timers,a=0;a<t.length;a++)e=t[a],!e()&&t[a]===e&&t.splice(a--,1);t.length||E.fx.stop()},interval:13,stop:function(){clearInterval(gt),gt=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(e){E.style(e.elem,"opacity",e.now)},_default:function(e){e.elem.style&&null!=e.elem.style[e.prop]?e.elem.style[e.prop]=e.now+e.unit:e.elem[e.prop]=e.now}}}),E.each(["width","height"],function(e,t){E.fx.step[t]=function(e){E.style(e.elem,t,Math.max(0,e.now)+e.unit)}}),E.expr&&E.expr.filters&&(E.expr.filters.animated=function(e){return E.grep(E.timers,function(t){return e===t.elem}).length});var Tt=/^t(?:able|d|h)$/i,kt=/^(?:body|html)$/i;"getBoundingClientRect"in N.documentElement?E.fn.offset=function(e){var t,n=this[0];if(e)return this.each(function(t){E.offset.setOffset(this,e,t)});if(!n||!n.ownerDocument)return null;if(n===n.ownerDocument.body)return E.offset.bodyOffset(n);try{t=n.getBoundingClientRect()}catch(e){}var r=n.ownerDocument,i=r.documentElement;if(!t||!E.contains(i,n))return t?{top:t.top,left:t.left}:{top:0,left:0};var o=r.body,s=a(r),c=i.clientTop||o.clientTop||0,l=i.clientLeft||o.clientLeft||0,u=s.pageYOffset||E.support.boxModel&&i.scrollTop||o.scrollTop,h=s.pageXOffset||E.support.boxModel&&i.scrollLeft||o.scrollLeft,d=t.top+u-c,p=t.left+h-l;return{top:d,left:p}}:E.fn.offset=function(e){var t=this[0];if(e)return this.each(function(t){E.offset.setOffset(this,e,t)});if(!t||!t.ownerDocument)return null;if(t===t.ownerDocument.body)return E.offset.bodyOffset(t);for(var a,n=t.offsetParent,r=t,i=t.ownerDocument,o=i.documentElement,s=i.body,c=i.defaultView,l=c?c.getComputedStyle(t,null):t.currentStyle,u=t.offsetTop,h=t.offsetLeft;(t=t.parentNode)&&t!==s&&t!==o&&(!E.support.fixedPosition||"fixed"!==l.position);)a=c?c.getComputedStyle(t,null):t.currentStyle,u-=t.scrollTop,h-=t.scrollLeft,t===n&&(u+=t.offsetTop,h+=t.offsetLeft,E.support.doesNotAddBorder&&(!E.support.doesAddBorderForTableAndCells||!Tt.test(t.nodeName))&&(u+=parseFloat(a.borderTopWidth)||0,h+=parseFloat(a.borderLeftWidth)||0),r=n,n=t.offsetParent),E.support.subtractsBorderForOverflowNotVisible&&"visible"!==a.overflow&&(u+=parseFloat(a.borderTopWidth)||0,h+=parseFloat(a.borderLeftWidth)||0),l=a;return"relative"!==l.position&&"static"!==l.position||(u+=s.offsetTop,h+=s.offsetLeft),E.support.fixedPosition&&"fixed"===l.position&&(u+=Math.max(o.scrollTop,s.scrollTop),h+=Math.max(o.scrollLeft,s.scrollLeft)),{top:u,left:h}},E.offset={bodyOffset:function(e){var t=e.offsetTop,a=e.offsetLeft;return E.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(E.css(e,"marginTop"))||0,a+=parseFloat(E.css(e,"marginLeft"))||0),{top:t,left:a}},setOffset:function(e,t,a){var n=E.css(e,"position");"static"===n&&(e.style.position="relative");var r,i,o=E(e),s=o.offset(),c=E.css(e,"top"),l=E.css(e,"left"),u=("absolute"===n||"fixed"===n)&&E.inArray("auto",[c,l])>-1,h={},d={};u?(d=o.position(),r=d.top,i=d.left):(r=parseFloat(c)||0,i=parseFloat(l)||0),E.isFunction(t)&&(t=t.call(e,a,s)),null!=t.top&&(h.top=t.top-s.top+r),null!=t.left&&(h.left=t.left-s.left+i),"using"in t?t.using.call(e,h):o.css(h)}},E.fn.extend({position:function(){if(!this[0])return null;var e=this[0],t=this.offsetParent(),a=this.offset(),n=kt.test(t[0].nodeName)?{top:0,left:0}:t.offset();return a.top-=parseFloat(E.css(e,"marginTop"))||0,a.left-=parseFloat(E.css(e,"marginLeft"))||0,n.top+=parseFloat(E.css(t[0],"borderTopWidth"))||0,n.left+=parseFloat(E.css(t[0],"borderLeftWidth"))||0,{top:a.top-n.top,left:a.left-n.left}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||N.body;e&&!kt.test(e.nodeName)&&"static"===E.css(e,"position");)e=e.offsetParent;return e})}}),E.each(["Left","Top"],function(e,n){var r="scroll"+n;E.fn[r]=function(n){var i,o;return n===t?(i=this[0])?(o=a(i),o?"pageXOffset"in o?o[e?"pageYOffset":"pageXOffset"]:E.support.boxModel&&o.document.documentElement[r]||o.document.body[r]:i[r]):null:this.each(function(){o=a(this),o?o.scrollTo(e?E(o).scrollLeft():n,e?n:E(o).scrollTop()):this[r]=n})}}),E.each(["Height","Width"],function(e,a){var n=a.toLowerCase();E.fn["inner"+a]=function(){var e=this[0];return e?e.style?parseFloat(E.css(e,n,"padding")):this[n]():null},E.fn["outer"+a]=function(e){var t=this[0];return t?t.style?parseFloat(E.css(t,n,e?"margin":"border")):this[n]():null},E.fn[n]=function(e){var r=this[0];if(!r)return null==e?null:this;if(E.isFunction(e))return this.each(function(t){var a=E(this);a[n](e.call(this,t,a[n]()))});if(E.isWindow(r)){var i=r.document.documentElement["client"+a],o=r.document.body;return"CSS1Compat"===r.document.compatMode&&i||o&&o["client"+a]||i}if(9===r.nodeType)return Math.max(r.documentElement["client"+a],r.body["scroll"+a],r.documentElement["scroll"+a],r.body["offset"+a],r.documentElement["offset"+a]);if(e===t){var s=E.css(r,n),c=parseFloat(s);return E.isNumeric(c)?c:s}return this.css(n,"string"==typeof e?e:e+"px")}}),e.jQuery=e.$=E,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return E})}(window);var $d=$("document"),$b=null,$h=null;$d.ready(function(){$b=$("body"),$h=$("html"),window.location.search.indexOf("type=inline")!=-1&&$h.addClass("inlineSupportWindow")}),window.onerror=function(e,t,a,n,r){for(var i=["NS_ERROR_FILE_CORRUPTED","NS_ERROR_FILE_NO_DEVICE_SPACE","Недостаточно памяти"],o=!0,s=0;s<skavlip.length;s++)if(e.indexOf(i[s])>-1){o=!1;break}o&&chat.api("logWidgetError",{message:e,file:t,line:a,col:n,trace:r.stack})},Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var a=t||0,n=this.length;a<n;a++)if(this[a]===e)return a;return-1});var supportPunycode=new function(){function e(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:s}function t(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function a(e,t,a){var n;for(e=a?Math.floor(e/c):e>>1,e+=Math.floor(e/t),n=0;e>(s-l)*u>>1;n+=s)e=Math.floor(e/(s-l));return Math.floor(n+(s-l+1)*e/(e+h))}function n(e,t){return e-=(e-97<26)<<5,e+((!t&&e-65<26)<<5)}this.utf16={decode:function(e){for(var t,a,n=[],r=0,i=e.length;r<i;){if(t=e.charCodeAt(r++),55296===(63488&t)){if(a=e.charCodeAt(r++),55296!==(64512&t)||56320!==(64512&a))throw new RangeError("UTF-16(decode): Illegal UTF-16 sequence");t=((1023&t)<<10)+(1023&a)+65536}n.push(t)}return n},encode:function(e){for(var t,a=[],n=0,r=e.length;n<r;){if(t=e[n++],55296===(63488&t))throw new RangeError("UTF-16(encode): Illegal UTF-16 value");t>65535&&(t-=65536,a.push(String.fromCharCode(t>>>10&1023|55296)),t=56320|1023&t),a.push(String.fromCharCode(t))}return a.join("")}};var r=128,i=72,o="-",s=36,c=700,l=1,u=26,h=38,d=2147483647;this.decode=function(t,n){var c,h,p,f,m,g,v,y,b,w,C,T,k,x=[],$=[],S=t.length;for(c=r,p=0,f=i,m=t.lastIndexOf(o),m<0&&(m=0),g=0;g<m;++g){if(n&&($[x.length]=t.charCodeAt(g)-65<26),t.charCodeAt(g)>=128)throw new RangeError("Illegal input >= 0x80");x.push(t.charCodeAt(g))}for(v=m>0?m+1:0;v<S;){for(y=p,b=1,w=s;;w+=s){if(v>=S)throw RangeError("punycode_bad_input(1)");if(C=e(t.charCodeAt(v++)),C>=s)throw RangeError("punycode_bad_input(2)");if(C>Math.floor((d-p)/b))throw RangeError("punycode_overflow(1)");if(p+=C*b,T=w<=f?l:w>=f+u?u:w-f,C<T)break;if(b>Math.floor(d/(s-T)))throw RangeError("punycode_overflow(2)");
b*=s-T}if(h=x.length+1,f=a(p-y,h,0===y),Math.floor(p/h)>d-c)throw RangeError("punycode_overflow(3)");c+=Math.floor(p/h),p%=h,n&&$.splice(p,0,t.charCodeAt(v-1)-65<26),x.splice(p,0,c),p++}if(n)for(p=0,k=x.length;p<k;p++)$[p]&&(x[p]=String.fromCharCode(x[p]).toUpperCase().charCodeAt(0));return this.utf16.encode(x)},this.encode=function(e,c){var h,p,f,m,g,v,y,b,w,C,T,k;c&&(k=this.utf16.decode(e)),e=this.utf16.decode(e.toLowerCase());var x=e.length;if(c)for(v=0;v<x;v++)k[v]=e[v]!=k[v];var $=[];for(h=r,p=0,g=i,v=0;v<x;++v)e[v]<128&&$.push(String.fromCharCode(k?n(e[v],k[v]):e[v]));for(f=m=$.length,m>0&&$.push(o);f<x;){for(y=d,v=0;v<x;++v)T=e[v],T>=h&&T<y&&(y=T);if(y-h>Math.floor((d-p)/(f+1)))throw RangeError("punycode_overflow (1)");for(p+=(y-h)*(f+1),h=y,v=0;v<x;++v){if(T=e[v],T<h&&++p>d)return Error("punycode_overflow(2)");if(T==h){for(b=p,w=s;C=w<=g?l:w>=g+u?u:w-g,!(b<C);w+=s)$.push(String.fromCharCode(t(C+(b-C)%(s-C),0))),b=Math.floor((b-C)/(s-C));$.push(String.fromCharCode(t(b,c&&k[v]?1:0))),g=a(p,f+1,f==m),p=0,++f}}++p,++h}return $.join("")},this.ToASCII=function(e){for(var t=e.split("."),a=[],n=0;n<t.length;++n){var r=t[n];a.push(r.match(/[^A-Za-z0-9-]/)?"xn--"+supportPunycode.encode(r):r)}return a.join(".")},this.ToUnicode=function(e){for(var t=e.split("."),a=[],n=0;n<t.length;++n){var r=t[n];a.push(r.match(/^xn--/)?supportPunycode.decode(r.slice(4)):r)}return a.join(".")}},newApi=!1;newApi&&alert("не забудь отключить тестовый режим");var chat={prepareIdForHtml:function(e){return e.toString().split(".").join("_")},foo:"bar",api:function(e,t,a,n){$.post(this.apiScript(),this.getPostParams(e,t),function(e){"object"==typeof e&&e&&e.eventsReturn&&e.eventsReturn.redirect&&setTimeout(function(){chat.eval("window.location.href = '"+e.eventsReturn.redirect+"';")},1e3),"function"==typeof a&&a(e)},n?n:"json")},apiScript:function(){return newApi?"/LAPI/me-talk/apiNew.php":"/LAPI/me-talk/api.php"},eval:function(e){RPC.post("eval",{str:e})},phoneMask:{maskInputLoaded:!1,maskInputOptions:null,_make:function(){var e=this;e.maskInputOptions&&$.each($("input[name=phone]:not(.with-mask)"),function(){$(this).addClass("with-mask").inputmasks(e.maskInputOptions);var t=chat.siteParams.params.leadGen.countryPhoneCode;t&&$(this).bind("focus",function(){var e=$(this),a=$(this).val();a&&a.length||t&&($(this).inputmask("setvalue",t),setTimeout(function(){e.inputmask("setvalue",t)},100))}).bind("blur",function(){var e=$(this).val();e==t&&$(this).inputmask("setvalue","")})})},load:function(){var e=this;(chat.isOpened()||"support"!==chat.type)&&$("input[name=phone]:not(.with-mask):visible").length&&(e._make(),this.maskInputLoaded||(e.maskInputLoaded=!0,$.cachedScript("/support/inputmask.js?4",{success:function(t){var a=$.masksSort(phoneCodes,["#"],/[0-9]|#/,"mask"),n={inputmask:{definitions:{"#":{validator:"[0-9]",cardinality:1}},showMaskOnHover:!1,autoUnmask:!0,clearMaskOnLostFocus:!0},match:/[0-9]/,replace:"#",listKey:"mask"};e.maskInputOptions=$.extend(!0,{},n,{list:a,onMaskChange:function(e){}}),e._make()}})))}},suspend:{enabled:!1,queue:{},on:function(){this.enabled||(this.enabled=!0)},off:function(){if(this.enabled){this.enabled=!1;for(var e in this.queue){try{this.queue[e](),delete this.queue[e]}catch(e){}if(this.enabled)break}}},check:function(e,t){return this.enabled?void(this.queue[t]=e):(e(),!0)}},loadDelayedSrc:function(){(chat.isOpened()||"support"!=chat.type)&&$.each($(".delayed-src"),function(){if(!$(this).hasParent(".hiddenTab:not(.current)")){if($(this).hasClass("avatar")&&!$(this).is(":visible"))return;$(this).removeClass("delayed-src").attr("src",$(this).attr("delayed-src"))}})},windowResizeFunctions:[],windowResize:function(){for(var e=0;e<this.windowResizeFunctions.length;e++)this.windowResizeFunctions[e]()},isOpened:function(){return $h.hasClass("supportOpened")},instanceID:!1,type:"support",server:"",staticDomain:"https://static.me-talk.ru",siteParams:null,now:function(){return(new Date).getTime()},liteModeDisabledKey:function(){return chat.siteParams?chat.siteParams.id+"::"+chat.siteParams.talkID+"::liteModeDisabled":"liteModeDisabled"},isLiteModeEnabled:function(){return!(storeWithExpiration.get(this.liteModeDisabledKey())||!chat.siteParams||!parseInt(chat.siteParams.params.liteMode))},disableLiteMode:function(){var e=this.isLiteModeEnabled();storeWithExpiration.set(this.liteModeDisabledKey(),1,864e5),e&&chat.activity.start()},appendStaticDomain:function(e){return e.split('"/uploads/tinymce').join('"'+chat.staticDomain+"/uploads/tinymce")},prepareHTML:function(e){if(e){e=this.appendStaticDomain(e);var t=$("<div></div>").html(e),a=document.createElement("a");$.each(t.find("img:not(.delayed-src)"),function(){var e=$(this);a.href=e.attr("src"),a.href.indexOf(window.location.host)>-1&&e.attr("src",chat.staticDomain+""+e.attr("src")),e.attr("delayed-src",e.attr("src")).addClass("delayed-src"),e.removeAttr("src")}),e=t.html()}return e},nodeAjax:{sendedList:{},callback:function(e,t){if(null!=this.callbacks[e])return this.callbacks[e](t),delete this.callbacks[e],!0},notifyAboutCallback:function(e,t){supportStorage.set("websocketAjaxResult",{callbackID:e,data:t}),supportStorage.remove("websocketAjaxResult")},callbacks:{},checkWasSended:function(e){var t=null!=this.sendedList[e];return this.clearSended(e),t},clearSended:function(e){delete this.sendedList[e]},wasSended:function(e){var t=this;null!=this.callbacks[e]&&(this.sendedList[e]=1),setTimeout(function(){t.clearSended(e)},1e4)},sended:function(e){this.wasSended(e),supportStorage.set("websocketAjaxSended",e,!0),supportStorage.remove("websocketAjaxSended",!0)},sendToSocket:function(e){var t=this;if(chat.listen.websocketAvailable()){if(chat.listen.ws&&1==chat.listen.ws.readyState)return"object"==typeof e.data&&(e.data=JSON.stringify(e.data)),chat.listen.ws.send(JSON.stringify({action:"ajax",data:e})),void this.sended(e.callbackID);if(!e.retry||e.retry<200)return e.retry||(e.retry=0),e.retry++,setTimeout(function(){t.sendToSocket(e)},10)}this.sended(e.callbackID),this.sendByHttp(e,function(a){t.callback(e.callbackID,a)||t.notifyAboutCallback(e.callbackID,a)})},sendByHttp:function(e,t){$.ajax({url:e.url,data:e.data,type:e.method,dataType:"html",headers:e.headers,success:function(e){t&&t(e)}})},sendIfMainListener:function(e){var t=!1;return chat.listen.isMainListener()&&(this.sendToSocket(e),t=!0),t},send:function(e,t){var a=this;if(null==e&&(e={}),e.method||(e.method="GET"),!store.disabled&&chat.listen.websocketAvailable()){e.callbackID=chat.generateCode(10),e.channel="main",a.callbacks[e.callbackID]=t,e.simpleQuery?a.sendByHttp(e,function(t){a.callback(e.callbackID,t)}):this.sendIfMainListener(e)||(supportStorage.set("websocketAjax",e,!0),supportStorage.remove("websocketAjax",!0),setTimeout(function(){a.checkWasSended(e.callbackID)||a.sendByHttp(e,function(t){a.callback(e.callbackID,t)})},2e3))}else this.sendByHttp(e,t)}},testUrl:function(){return""},copyObject:function(e){return JSON.parse(JSON.stringify(e))},clickOnClose:function(){$(".operatorsSelectBlock:visible").length?chat.operators.closeChangeDialog():(chat.actions.filters.set("closeWidget"),RPC.post("close",{}))},shortMonthDescrArray:["","янв","фев","мар","апр","май","июн","июл","авг","сен","окт","ноя","дек"],shortMonthDescr:function(e){var t="";return e=parseInt(e),null!=this.shortMonthDescrArray[e]&&(t=this.shortMonthDescrArray[e]),t},contactTypes:{phone:{id:"email",descr:"Мобильный телефон"},email:{id:"email",descr:"Email"},skype:{id:"skype",descr:"Skype"}},client:{data:{},updated:!1,keys:["phone","email","descr","skype","inLcab","haveNoAnswer","customData","category"],init:function(){var e=this,t=chat.tabs.getClientInfoCache();null!=t?e.data=t:$.each(e.keys,function(){e.data[this]=!1})},update:function(e){if(e){var t=this,a=!1;$.each(t.keys,function(){var n=this;null!=e[n]&&e[n]!=t.data[n]&&(t.data[n]=e[n],chat.actions.listeners.queue("clientField_"+n),a=!0)}),a&&(t.updated=!0,RPC.actions.getContacts(!0),supportStorage.set(chat.tabs.clientInfoKey(),t.data)),chat.tabs.insertClientFeedbackInfo()}},get:function(e){var t=!1,a=null;return null!=this.data[e]?a=this.data:null!=this.data.customData&&null!=this.data.customData[e]&&(a=this.data.customData),null==a||"string"==typeof a[e]&&!a[e].length||(t=a[e]),t}},mute:!1,chatMode:"online",mobile:!1,device:null,defaultAvatar:"/images/support/noavatar.png?3",log:function(e){"undefined"!=typeof console&&console.log(e)},emoji:{init:function(e){if(parseInt(chat.siteParams.params.siteChatOptions.emoji)){var t=$("#emoji-dropdown"),a=t.children("ul"),n=t.children(".tabs");t.bind("dropdown-show",function(){a.children("li.selected").length||a.children("li:first").click()}),$("#emoji-dropdown > .tabs > div > div > img").live("click",function(){$("#chatTextarea").append($(this).clone()).keyup()});for(var r=0;r<emojiList.length;r++)!function(e){var t=$("<li></li>").data("id","emoji_"+e.id).append("<span class='icon "+e.icon+"'></span>").bind("click",function(){var t=$("#"+$(this).data("id"));if(!t.data("init")){t.data("init",!0);for(var a=$("<div></div>"),n=0;n<e.list.length;n++){var r=$(emojione.unicodeToImage(e.list[n]));r.data("emoji",emojione.toShort(e.list[n])),r.appendTo(a)}$(t).html(a)}});a.append(t);var r=$("<div></div>").attr("id","emoji_"+e.id);n.append(r)}(emojiList[r])}else $(".emojiDropdownTrigger").remove()}},browser:{comet:function(e,t){RPC.post("browser",t)},send:{make:function(e,t){if(t={action:"browser",data:t},e.length){var a=encodeURIComponent(e.join("/")),n="/cometPublish?operators="+a+"&cid="+a,r=JSON.stringify(t);chat.nodeAjax.send({url:n,data:r,method:"POST"},function(){"changes"==t.data.action&&RPC.post("browser",{action:"sendChanges"})}),RPC.post("cometPublish",{url:n,data:r})}}},rpcActions:{sendInitialHTMLToOperator:function(e){chat.browser.send.make(e.channels,e)},send:function(e){e=e.data,chat.browser.send.make(e.channels,e)}}},init:function(e){this.type=e,RPC.socket=new easyXDM.Socket({onReady:function(){RPC.post("init",{translate:{"Отмена":"Отмена"}})},onMessage:RPC.get})},copyrightDisplayed:function(){return!(null==chat.siteParams||null==chat.siteParams.params.copyright||!chat.siteParams.params.copyright.img||!chat.siteParams.params.copyright.img.dark)&&chat.siteParams.params.copyright.show},getInnerCopyrightImage:function(){if(null!=chat.siteParams&&null!=chat.siteParams.params.copyright)return chat.siteParams.params.copyright.img.dark+"?r="+chat.siteParams.dtChange},getPostParams:function(e,t){return chat.siteParams&&(t.orgID=chat.siteParams.orgID,t.siteID=chat.siteParams.id,t.talkID=chat.siteParams.talkID),{method:e,lang:chat.siteParams?chat.siteParams.lang:"ru",p:JSON.stringify(t)}},getHeaders:function(e,t){if(null==t&&(t={}),t.action=e,null!=chat.siteParams.currentTitle&&chat.siteParams.currentTitle.length)var a=chat.siteParams.currentTitle.split("\n").join("");else var a=chat.siteParams.currentUrl;var n={"X-Metalk-Action":encodeURIComponent(JSON.stringify(t)),"X-Metalk-Talkid":chat.siteParams.talkID,"X-Metalk-Url":encodeURIComponent(chat.siteParams.currentUrl),"X-Metalk-Org":chat.siteParams.orgID,"X-Metalk-Site":chat.siteParams.id,"X-Metalk-Pageid":encodeURIComponent(chat.activity.pageID)};return a&&a.length&&(n["X-Metalk-Title"]=encodeURIComponent(a.substr(0,300))),chat.siteParams.referrer&&(n["X-Metalk-Referrer"]=chat.siteParams.referrer),null!=chat.siteParams.lcab_session&&chat.siteParams.lcab_session.length&&(n["X-Metalk-Ls"]=chat.siteParams.lcab_session),n},fixFeedbackFormHeight:function(){var e=$("div.supportTabs > .current");e.children(".tabInner").length&&(e=e.children(".tabInner"));var t=e.find(".feedbackContainer:visible"),a="classic"==chat.siteParams.style?2:0;if(t.length&&e.length){chat.phoneMask.load();var n=e.outerHeight(),r=t.outerHeight(!0)+t.position().top+parseInt(t.children(":visible").last().css("margin-bottom")),i=n-r-a,o=e.find("textarea:visible"),s=o.length;if(i>0){if(o.length){var c=(parseInt(o.height())+i)/s;c<40&&(c=40),o.css("height",c)}}else if(i<0){if(o.length&&o.height()>40){var c=o.height();return c+=i,c/=s,c<40&&(c=40),o.height(c),chat.fixFeedbackFormHeight()}chat.initMinSize({width:!1,height:parseInt($b.height())+i*-1,heightWithoutPadding:!0,store:!1})}}if(e.length&&e[0].scrollHeight>e.outerHeight()){var l=$b.height()+e[0].scrollHeight-e.outerHeight()+a;chat.initMinSize({width:!1,height:l,heightWithoutPadding:!0,store:!1})}chat.loadDelayedSrc(),chat.captcha.fix()},captcha:{isReady:!1,ready:function(){this.isReady=!0,this.render()},selectsImg:[],selectImgDisplayed:function(){for(var e=0;e<this.selectsImg.length;e++)if("visible"==this.selectsImg[e].css("visibility"))return!0;return!1},render:function(){if(this.isReady){var e=$(".g-recaptcha:not(.rendered)");e.length&&($.each(e,function(){$(this).addClass("rendered");var e=$(this).data("form-class-name"),t=grecaptcha.render(this,{sitekey:"6Lc1ICAUAAAAAD81Urqtpo5L0rXIKLbkx6GZ3jHo"});$(this).data("captchaID",t),$(this).find("[name=g-recaptcha-response]").addClass(e)}),chat.windowResize(),setTimeout(function(){chat.windowResize()},300),this.fix())}},fix:function(){var e=this,t=$(".g-recaptcha:visible");$.each(t,function(){var e=$(this),t=e.children("div").width(),a=e.parent().width()+2,n=a/t;t>a&&e.css({transform:"scale("+n+")","-webkit-transform":"scale("+n+")","transform-origin":"0 0"})}),chat.form.resize(),setTimeout(function(){e.selectsImg=[],$.each($("iframe"),function(){var t=$(this).attr("src");t&&t.indexOf("bframe")!=-1&&e.selectsImg.push($(this).parent().parent())})},2e3)},append:function(e,t){var a=$(e);a.children(".g-recaptcha").length||(a.append($('<div class="g-recaptcha"></div>').data("form-class-name",t)),this.render())},reset:function(e){null==e&&(e=":visible"),$.each($(".g-recaptcha"),function(){if(!e||$(this).is(e)){var t=$(this).data("captchaID");null!=t&&null!=window.grecaptcha&&grecaptcha.reset(t)}})}},onlineChatDisplayed:function(){return!$(".onlineSupport").hasClass("none")},setSupportTitle:function(e){var t=$(".offlineSupport"),a=$(".onlineSupport"),n="none";"offline"==e?(t.removeClass(n),a.addClass(n)):(t.addClass(n),a.removeClass(n));var r={online:$("a.a_chat").children("span.descr").text(),offline:chat.siteParams.params.leadGen.tabTitle},i={desktop:1,tablet:1,mobile:1};for(device in i){var o=chat.siteParams.params.trigger[device];if(null!=o&&"classic"==o.triggerType){r.online=o.onlineText,r.offline=o.offlineText;break}}var s=r[e];$(".supportTitle").children("div").html(s),chat.operators.avatarUpdated()},isOfflineFormUsed:function(){return"pmForm"==chat.siteParams.params.leadGen.mode||"html"==chat.siteParams.params.leadGen.mode},showOfflineSupport:function(){var e=this;$d.ready(function(){chat.chatMode="offline",$h.addClass("offline").removeClass("online");var t=$(".supportTabs");if(t.children("li.current").hasClass("hideWhenOffline")&&chat.tabs.open(t.children("li:visible").first()),e.toggleDownloadChatButton(),chat.isOfflineFormUsed()){chat.operators.closeChangeDialog(),chat.setSupportTitle("offline");var a=$("a.a_chat").children("span.descr"),n=a.html(),r=chat.siteParams.params.leadGen.tabTitle;r&&r.length||(r="Задать вопрос"),n!=r&&(a.data("online-title",n),a.html(r)),chat.initMinSize(),$(".meTalkPM.text").placeholder();var i=$("textarea:visible[name=text]");if(i.length){var o=i.val();null==o||o.length||i.val($(".onlineChat[name=text]").val())}}else if("simulation"==chat.siteParams.params.leadGen.mode){chat.setSupportTitle("online");var s=chat.operators.getCurrent();if(!s||!chat.operators.get(s)||!chat.operators.canViewOperator(s)){var c=chat.siteParams.defaultOperator;if(c&&chat.operators.get(c))s=c;else{var l=[],u=[],h=chat.operators.get();for(var s in h)l.push(s),chat.operators.canViewOperator(s)&&u.push(s);if(u.length&&(l=u),!l.length)return;l=chat.shuffle(l),s=l[0]}}chat.operators.select({operator:s,force:!0})}else e.hideSupportTrigger(),RPC.post("hideNewMessage",{});chat.windowResize()})},hideSupportTrigger:function(){var e=$("a.a_chat").parent();e.hasClass("none")||(e.addClass("none"),e.hasClass("current")&&$(".supportTabs li:visible:first a").click()),chat.closeSupport(),RPC.post("hideSupportTrigger",{})},showSupportTrigger:function(){$("a.a_chat").parent(".none").removeClass("none").children().click(),RPC.post("showSupportTrigger",{})},toggleDownloadChatButton:function(){var e=$(".download-chat");"online"==chat.chatMode&&chat.messages.history.getIdList().length&&chat.siteParams.params.siteChatOptions.exportByClientAllowed?(chat.copyrightDisplayed()&&$(".descr",e).remove(),e.addClass("show"),$h.addClass("downloadButtonDisplayed")):($h.removeClass("downloadButtonDisplayed"),e.removeClass("show"))},showOnlineSupport:function(){var e=this;$d.ready(function(){$h.addClass("online").removeClass("offline"),chat.setSupportTitle("online"),$(".onlineSupport").removeClass("none"),$(".offlineSupport").addClass("none");var t=chat.siteParams.params.leadGen.mode,a=$("a.a_chat").children("span.descr"),n=a.data("online-title");n&&a.html(n),"simulation"==t&&(chat.operatorAway.away||(chat.onlineSimulation.resetStoreKey(),chat.onlineSimulation.stop())),chat.chatMode="online",e.showSupportTrigger(),e.toggleDownloadChatButton(),chat.initMinSize(),chat.windowResize()})},openSupport:function(e){RPC.post("open",e)},closeSupport:function(){RPC.post("close",{})},notifications:{displayed:!1,show:function(e){if(this.displayed)return this.close(function(){chat.notifications.show(e)});var t=$(".chat"),a=$(".chatInner"),n=(a.outerHeight(),t.scrollTop());this.displayed=!0,$(".newNotification .inner").html(e.html);var r=a.children(".newNotification");r.find("textarea,input,select").removeAttr("class").show(),t.scrollTop(n+r.outerHeight());var i=setInterval(function(){chat.messages.updatePaddings()},10);$(".onlineSupport > .newNotification").slideDown(200,function(){clearInterval(i)});var o=$(".newNotification .close");o.unbind("click"),null!=e.onClose&&o.bind("click",e.onClose),chat.windowResize(),chat.messages.updatePaddings()},close:function(e){this.displayed=!1;var t=setInterval(function(){chat.messages.updatePaddings()},10),a=$(".newNotification");a.slideUp(200,function(){clearInterval(t),"absolute"==$(this).css("position")&&(a.children(".inner").empty(),null!=e&&e(),chat.messages.updatePaddings())})}},onlineSimulation:{storeKey:function(){return chat.siteParams.id+"::"+chat.siteParams.talkID+"::startOnlineSimulation"},resetStoreKey:function(){storeWithExpiration.remove(this.storeKey())},started:!1,start:function(){if(!this.started&&"simulation"==chat.siteParams.params.leadGen.mode&&null!=chat.siteParams.params.leadGen.simulation.typingTime){var e=this.storeKey();null==storeWithExpiration.get(e)&&(storeWithExpiration.set(e,1,36e5),this.started=!0,chat.onlineSimulation.askForContacts())}},stop:function(){var e=chat.onlineSimulation;e.onSendMessage=function(){},e.started=!1},onSendMessage:function(){},isOnline:function(){return chat.operators.isOnline(chat.operators.getCurrent())},getCheckContacts:function(){return parseInt(this.isOnline()?chat.siteParams.params.leadGen.simulation.checkContacts:chat.siteParams.params.leadGen.offlineSimulation.checkContacts)},askForContacts:function(){var e=chat.onlineSimulation;e.simulateMessage("askContacts",function(t){1==t.code&&setTimeout(function(){e.onSendMessage=function(t){var a=t.text.indexOf("@")!=-1||t.text.replace(/[^0-9]/g,"").length>=5;!e.getCheckContacts()||t.contacts||a?(a&&RPC.actions.changeContacts({contacts:t.text}),e.started&&(e.simulateMessage("afterContacts"),e.stop()),e.onSendMessage=function(e){chat.operatorAway.getActivity()||RPC.actions.changeContacts({contacts:e.text})}):chat.messages.operatorTyping(chat.operators.getCurrent(),!1)}},300)})},simulateMessage:function(e,t){var a=this;setTimeout(function(){var n=chat.operators.getCurrent();chat.messages.operatorTyping(n,!1),setTimeout(function(){chat.api("askForSimulateMessage",{type:e,operator:chat.operators.getCurrent(),online:a.isOnline()?1:0},function(e){1==e.alreadyHaveContacts&&a.stop(),chat.listen.start({cid:"main"}),null!=t&&t(e)})},1e3*chat.siteParams.params.leadGen.simulation.typingTime)},1e3*chat.siteParams.params.leadGen.simulation.waitForTyping)}},operatorAway:{timeout:null,activityKey:function(){return"operator::activity::"+chat.siteParams.id},getActivity:function(){var e=this.activityKey(),t=storeWithExpiration.get(e);return t=null!=t},setActivity:function(){var e=this.activityKey();storeWithExpiration.set(e,1,9e5),this.stop()},away:!1,start:function(e){var t=this,a=parseInt(chat.siteParams.params.leadGen.simulation.delay);a>0&&(clearTimeout(this.timeout),this.away||this.getActivity()||(e||(a*=1e3),this.timeout=setTimeout(function(){t.away=!0,chat.siteParams.params.leadGen.mode="simulation",chat.operators.refresh(""),chat.fixFeedbackFormHeight(),chat.onlineSimulation.start()},a)))},stop:function(){this.away=!1,clearTimeout(this.timeout),chat.showOnlineSupport()}},triggerBadge:{getIDList:function(){var e=supportStorage.get("badge::"+chat.siteParams.id);null==e&&(e={});for(var t in e){var a=parseInt(t.substr(2));null==chat.messages.history.get(a)&&delete e[t]}return e},setIDList:function(e){var t=this.getIDList();JSON.stringify(t)!=JSON.stringify(e)&&(supportStorage.set("badge::"+chat.siteParams.id,e),this.updated())},getCount:function(){var e=this.getIDList(),t=0;for(var a in e)t++;return t},decr:function(e){var t=this.getIDList();t["id"+e]&&delete t["id"+e],this.setIDList(t),this.updated()},incr:function(e){var t=this.getIDList();t["id"+e]=1,this.setIDList(t)},empty:function(){var e=this.getIDList();clearInterval(this.emptyInterval),this.setIDList({});var t=0;for(var a in e){var n=parseInt(a.substr(2));n>t&&(t=n)}t&&chat.messages.sendMessageStatus(t,"readed")},emptyInterval:null,updated:function(){var e=this,t=e.getCount();t>0&&($b.bind("mousemove touchstart",e.mousemove),clearInterval(e.emptyInterval),e.emptyInterval=setInterval(function(){0==e.getCount()&&e.mousemove()},3e3)),RPC.post("badgeUpdated",{value:t})},mousemove:function(){chat.triggerBadge.empty(),$b.unbind("mousemove touchstart",chat.triggerBadge.mousemove)}},actions:{showTriggerAfterFirstAutoAction:function(){RPC.post("firstAutoActionDone",{}),this.showTriggerAfterFirstAutoAction=function(){}},actionsQueue:[],available:function(){return!0},init:function(){RPC.post("hideTrigger",{reason:"waitForFirstAutoAction"}),this.available()&&(this.listeners.init(),this.filters.init(),chat.siteParams.params.actionBlocks&&this.initQueue.make(),this.listeners.get("zero").length||chat.actions.showTriggerAfterFirstAutoAction())},initQueue:{filtersToArray:function(e){var t=[];if(e)for(var a in e)for(var n in e[a])t.push({name:a,operation:n,value:chat.actions.filters.initialPrepareValues(chat.actions.filters.getType(a),e[a][n])});return t},make:function(){var e=chat.actions,t={scrollToElement:[],clickOnElement:[],elementOnPage:[]},a=chat.siteParams.params.actionBlocks;for(i=0;i<a.length;i++)for(var n=a[i],r=this.filtersToArray(n.filters),o=n.subFilters,s=0;s<o.length;s++){var c={};if(n.filters)for(var l in n.filters)c[l]=!0;var u=o[s];u.filterGroupsThatMustNotMatch=[];var h=this.filtersToArray(u.filters);if(!h.length)for(var d=0;d<o.length;d++)if(o[d].filters){for(var l in o[d].filters)c[l]=!0;var p=this.filtersToArray(o[d].filters);p.length&&u.filterGroupsThatMustNotMatch.push(p)}for(var f in u.actionTypes){var m=u.actionTypes[f];m.filterGroupsThatMustNotMatch=u.filterGroupsThatMustNotMatch,m.filters=r.concat(h);var g;for(g=0;g<m.filters.length;g++){var v=m.filters[g],y=v.name;c[y]=!0,null!=t[y]&&(t[y]=t[y].concat(v.value))}for(var b in c)e.listeners.add(b,m);for(m.repeat&&"afterTime"===m.repeat[0]&&e.listeners.add("timeOnPage",m),e.listeners.add("zero",m),g=0;g<m.actions.length;g++)m.actions[g].type=f}}RPC.post("initAutoActionElementSelectors",{selectors:t})}},run:{now:0,start:function(e){this.now=parseInt(chat.now()/1e3),this.prepareRunTimeForActionsList(e.actions);for(var t=[],a=0;a<e.actions.length;a++)this.canRun.check(e.actions[a],e)&&t.push(e.actions[a]);if(t.length){var n;null!=e.repeat?(this.setRunTime(e.actions,this.now),t=chat.shuffle(t),n=[t[0]]):n=t,this.make(n,e)}},make:function(e,t){for(var a=this,n=(a.now,0),r=[],i=!1,o=[],s=0;s<e.length;s++)!function(s){var c=chat.generateCode(10),l=e[s];i=l.type;var u=null;if(null!=a.types[l.type]&&(u=a.types[l.type](l,t,s)),u){u.queue||(u.queue=[u]);for(var h=0;h<u.queue.length;h++)!function(e){var t=u.queue[e];t.actionID=l.id,t.runID=c;var a=t.regAutoAction;if(a.type=l.type,a.actionID=l.id,a.timeout=t.timeout,o.push(a),delete t.regAutoAction,t.action){r.push(t);var i=t.timeout;i+=1*e,i<=0&&(i=.001),t.timeout+=t.simulateTyping,setTimeout(function(){chat.listen.writeCometToCacheMain([t])},1e3*i),n=t.timeout}}(h)}}(s);o.length>0&&("sendTextMessageToClient"==i&&(chat.actions.filters.incr("autoMessageToClientCount"),chat.actions.filters.incr("autoMessageToClientCountAtVisit")),o.length>0&&chat.onReady(function(){chat.nodeAjax.send({url:"/regAutoAction",method:"POST",data:JSON.stringify({talkID:chat.siteParams.talkID,orgID:chat.siteParams.orgID,siteID:chat.siteParams.id,actions:o})},function(e){})},"liteMode"))},types:{showTabMouseMove:function(){clearTimeout(chat.autoCloseTimeout),$b.unbind("mousemove touchstart",chat.actions.run.types.showTabMouseMove)},showTriggerMenu:function(e){return RPC.post("openTriggerMenu",{autoAction:!0}),{regAutoAction:{}}},destroyWidgetDone:!1,destroyWidget:function(){if(!this.destroyWidgetDone)return this.destroyWidgetDone=!0,RPC.post("destroyWidget",{}),{regAutoAction:{}}},showTab:function(e){var t=this,a=chat.isOpened(),n=!1;if("object"==typeof e.tabID){var r=e.tabID[0];e.tabID[1]&&e.tabID[1].showReviewsForm&&(n=parseInt(e.tabID[1].showReviewsForm))}else var r=e.tabID;var i=chat.tabs.getTabParams(r);if(i){if(!chat.isOpened()&&e.sound&&e.sound.length&&chat.playSound(e.sound),chat.listen.actions.showTab({tabID:r}),n?chat.rate.showForm():chat.rate.hideForm(),!a){var o=parseInt(e.autoClose);clearTimeout(chat.autoCloseTimeout),o&&(chat.autoCloseTimeout=setTimeout(function(){chat.closeSupport(),t.showTabMouseMove()},1e3*o),$b.bind("mousemove touchstart",t.showTabMouseMove))}return{regAutoAction:{}}}},setTarget:function(e){var t=chat.targetClient.send([e.reason]);if(t)return{regAutoAction:{}}},sendWebhook:function(e){return chat.nodeAjax.send({url:"/writeMetalkQueue",method:"GET",headers:chat.getHeaders("sendAutoActionWebhook",{webhook:e.webhook})}),{regAutoAction:{}}},runJavascript:function(e){return chat.eval(e.script),{regAutoAction:{}}},hideTrigger:function(e){RPC.post("hideTrigger",{reason:"autoAction"})},showTrigger:function(e){RPC.post("showTrigger",{reason:"autoAction"})},toggleTabVisible:function(e,t){for(var a=0;a<e.tabID.length;a++)chat.tabs.setTabVisible(e.tabID[a],t)},setTabInvisible:function(e){this.toggleTabVisible(e,0)},setTabVisible:function(e){this.toggleTabVisible(e,1)},toggleOperatorsGroup:function(e,t){for(var a=0;a<e.groupID.length;a++){var n=e.groupID[a];if(n){var r=chat.operators.getGroup(n);if(r){var i=t?0:1;i!=r.hidden&&(r.hidden=i,chat.operators.refreshWithLastData())}}}},showOperatorsGroup:function(e,t){this.toggleOperatorsGroup(e,1)},hideOperatorsGroup:function(e,t){this.toggleOperatorsGroup(e,0)},toggleOperator:function(e,t){for(var a=0;a<e.operator.length;a++){var n=e.operator[a];if(n){var n=chat.operators.get(n);if(n){var r=t?0:1;null!=n.hiddenOnThisPage&&r==n.hiddenOnThisPage||(n.hiddenOnThisPage=r,chat.operators.refreshWithLastData())}}}},showOperator:function(e,t){this.toggleOperator(e,1)},hideOperator:function(e,t){this.toggleOperator(e,0)},getTextForSendTextMessageToClient:function(e){for(var t=[],a=0;a<e.text.length;a++){var n=e.text[a].type,r=e.text[a].text;"html"===n&&(e.text[a].notInBubble&&(r="%block%"+r),r="%html%"+r);var i=this.getVariablesForText(r);for(var o in i)if(!i[o]&&r.indexOf("["+o+"]")>-1)return!1;for(o in i)r=r.split("["+o+"]").join(i[o]);var s=a>0?e.text[a].delay:0,c=0;c=a>0?s:e.typing?3:0,t.push({text:r,type:n,typing:c,delay:0==a?0:s})}return t},getVariablesForText:function(e){var t=chat.actions.filters,a=chat.siteParams.currentUrlParsed,n=a.port;n.length&&(n=":"+n);var r={siteAddress:a.protocol+"//"+a.host+n,title:chat.siteParams.currentTitle,searchKeyword:t.get("searchKeyword"),city:t.get("city_lang"),ip:t.get("ip"),name:chat.client.get("descr"),utm_content:chat.actions.filters.get("utm_content"),utm_term:chat.actions.filters.get("utm_term")};return r},sendTextMessageToClient:function(e,t,a){var n=this.getTextForSendTextMessageToClient(e);if(n){var r=0;if("online"==chat.chatMode||"simulation"==chat.siteParams.params.leadGen.mode){var i={queue:[]},o=!1;if(null!=e.priorityOperators)for(var s=0;s<e.priorityOperators.length;s++){var c=e.priorityOperators[s];if(chat.operators.isOnlineAndVisible(c)){o=c;break}}o||(o=chat.operators.current),o||(o=chat.shuffle(chat.operators.getOnlineList())[0]),$.each($(".autoMessage_"+e.id),function(){var e=$(this).data("id");if(e){var t=chat.messages.history.get(e);t&&t.answered||chat.messages.history.remove(e)}});for(var l=0;l<n.length;l++){var u=n[l],h=u.typing,d=u.delay;u=u.text;var p=chat.messages.maxID+parseFloat("0."+(new Date).getTime().toString().substr(5));chat.messages.maxID<p&&(chat.messages.maxID=p);var f="autoMessage";if(chat.messages.history.removeByText(u,f),chat.actions.filters.set("timeFromLastAutoMessageToClient"),chat.sendEvent("Automessage shown","Посетитель получил автоприветствие"),o){var m={operator:chat.operators.getOperatorDisplayParams(o).name};for(key in m)u=u.split("["+key+"]").join(m[key]);var g=!1,v=e.notify;if(v&&v.length){var y=chat.actions.filters.get("device");g="desktop"==y&&v.indexOf("silentDesktop")>-1||"desktop"!=y&&v.indexOf("silentMobile")>-1}g&&(h=0);var b=new Date;if(b.setHours(b.getHours()-chat.messages.timeOffset()),"any"!==e.senderType){var w={login:o,dontSetTalkWithOperator:!0,dontDisableBalancer:"onlyOperator"!==t.senderType,group:"onlyGroup"===t.senderType?e.sender:null};RPC.actions.setOperator(w)}1!=l||r||(r+=d);i.queue.push({timeout:r,action:"message",dt:b.toMysqlFormat(),text:u,from:o,id:p,silent:g,messageType:f,fromCache:g,other:{stackWithPrevious:l>0?1:0,autoMessageID:e.id,changeOperator:!1},instanceID:chat.instanceID,simulateTyping:e.typing?h:0,delayMinus:h,regAutoAction:{operator:o,text:u}}),r+=h}}return i}if("pmForm"==chat.siteParams.params.leadGen.mode){chat.actions.filters.set("timeFromLastAutoMessageToClient");for(var u=[],s=0;s<n.length;s++)u.push(n[s].text);return chat.tabs.drawPmUserHTML(chat.prepareHTML(u.join("<br />"))),chat.tabs.openByType("chat"),chat.openSupport(),{regAutoAction:{}}}}}},prepareRunTimeForActionsList:function(e){for(var t=null,a=0;a<e.length;a++){var n=this.getRunTime(e[a]);n>t&&(t=n)}for(var a=0;a<e.length;a++)e[a].runTime=t},clearRunAtThisPage:function(){var e=chat.actions.listeners.listeners;for(var t in e)for(var a=0;a<e[t].length;a++)for(var n=e[t][a],r=0;r<n.actions.length;r++)n.actions[r].runAtThisPage=null},setRunTime:function(e,t){for(var a=0;a<e.length;a++)e[a].runAtThisPage=!0,e[a].runTime=t,supportStorage.set("art::"+e[a].id,t),this.setRunAtThisVisit(e[a].id)},getRunTime:function(e){var t=supportStorage.get("art::"+e.id);return null!=t&&(t=parseInt(t)),t},setRunAtThisVisit:function(e){var t=supportStorage.get("visitID");t||(t=chat.initVisitID()),supportStorage.set("r_a_v::"+e,t)},canRun:{isRunAtThisVisit:function(e){var t=supportStorage.get("visitID");return t||(t=chat.initVisitID()),supportStorage.get("r_a_v::"+e)==t},check:function(e,t){var a=e.runTime,n=chat.actions.run.now,r=!0;if(a&&null!=t.repeat)if("afterTime"==t.repeat[0]){var i=chat.actions.filters.secondsToInt(t.repeat[1].repeatSeconds);n-a<i&&(r=!1)}else"newPage"!=t.repeat[0]&&"newVisit"!=t.repeat[0]||1!=e.runAtThisPage?"newPage"!=t.repeat[0]||e.runAtThisPage?"newVisit"==t.repeat[0]?this.isRunAtThisVisit(e.id)&&(r=!1):r=!1:r=!0:r=!1;if(r&&null!=this[e.type]&&(r=this[e.type](e)),null!=e.senderType){if(null==e.priorityOperators){e.priorityOperators=[];var o=e.senderType;if("onlyOperator"==o||"priorityOperator"==o)e.priorityOperators.push(e.sender);else if("onlyGroup"==o||"priorityGroup"==o){
for(var s=chat.operators.getOperatorsOfGroup(e.sender),c=0;c<s.length;c++)e.priorityOperators.push(s[c].username);e.priorityOperators=chat.shuffle(e.priorityOperators)}"onlyOperator"!=o&&"onlyGroup"!=o||(e.operatorsNeedOnline=e.priorityOperators)}e.operatorsNeedOnline&&(chat.actions.filters.check("operatorOnline","=",e.operatorsNeedOnline)||(r=!1))}return r},sendTextMessageToClient:function(e){return 0!=chat.actions.run.types.getTextForSendTextMessageToClient(e)}}},listeners:{listeners:{},_queue:[],started:!1,lock:{dontRunTime:!1,key:function(){return"actions::lock::"+chat.siteParams.id},interval:!1,make:function(){supportStorage.set(this.key(),JSON.stringify({id:chat.instanceID,time:chat.now()}),!0)},keep:function(){var e=this;clearInterval(this.interval),this.interval=setInterval(function(){e.make()},1e3)},set:function(e){var t=this;if(t.dontRunTime){var a=t.dontRunTime-chat.now();if(a>0)return setTimeout(function(){t.set(e)},a)}var n=chat.now(),r=supportStorage.get(this.key());r&&(r=JSON.parse(r)),r&&n-r.time>2e3&&(r=!1),r?r.id!=chat.instanceID?setTimeout(function(){t.set(e)},50):(t.keep(),e()):(t.make(),setTimeout(function(){t.set(e)},50))},unset:function(e){var t=this;this.set(function(){clearInterval(t.interval),t.dontRunTime=chat.now()+300,supportStorage.remove(t.key(),!0),e()})}},init:function(){},start:function(){return!this.started&&(this.started=!0,!0)},stop:function(){this.started=!1,this._queue.length&&this.make()},enabled:!0,enable:function(){if(store.disabled)return!1;var e=this;if(!chat.operators.isInited())return setTimeout(function(){e.enable()},200);this.enabled=!0;for(var t in this.listeners)this.queue(t)},disable:function(){this.enabled=!1},queue:function(e){this.enabled&&this.listeners[e]&&this._queue.indexOf(e)==-1&&(this._queue.push(e),this.make())},get:function(e){return this.listeners[e]?this.listeners[e]:[]},checkFilters:function(e){for(var t=!0,a=0;a<e.length;a++){var n=chat.actions.filters.check(e[a].name,e[a].operation,e[a].value);if(!n){t=!1;break}}return t},make:function(){var e=this;e._queue.length&&e.start()&&e.lock.set(function(){for(;filterName=e._queue.shift();)for(var t=e.get(filterName),a=0;a<t.length;a++){var n=t[a],r=e.checkFilters(n.filters);if(r){if(n.filterGroupsThatMustNotMatch&&n.filterGroupsThatMustNotMatch.length){r=!0;for(var i=0;i<n.filterGroupsThatMustNotMatch.length&&(r=!e.checkFilters(n.filterGroupsThatMustNotMatch[i]),r);i++);}r&&chat.actions.run.start(n)}}chat.actions.showTriggerAfterFirstAutoAction(),e.lock.unset(function(){e.stop()})})},add:function(e,t){null==this.listeners[e]&&(this.listeners[e]=[]),this.listeners[e].indexOf(t)==-1&&this.listeners[e].push(t)}},filters:{localFilters:{date:!0,timeOnPage:!0,mouseLeavePage:!0,scrollPercentage:!0,scrollPX:!0,scrollToElement:!0,device:!0,url:!0,currentPageTitle:!0,device:!0,searchKeyword:!0,referer:!0,dayOfWeek:!0,timeRange:!0,timeUTC:!0,colOperatorsOnline:!0,operatorOnline:!0,newMessageFromClient:!0,widgetState:!0},timeFilters:{timeFromLastAutoMessageToClient:!0,timeOnPage:!0,timeFromLastMessage:!0,visitStartTime:!0,timeFromLastMessageFromClient:!0,timeFromLastMessageFromOperator:!0,closeWidget:!0},timeRangeFilters:{timeRange:!0,timeUTC:!0},notEmptyFilters:{newMessageFromClient:!0,ip:!0,city:!0,country:!0,region:!0,colOperatorsOnline:!0,windowWidth:!0,windowHeight:!0,widgetState:!0},values:{},secondsToInt:function(e){return parseInt(e.seconds)*parseInt(e.multiply)},getType:function(e){var t=chat.siteParams.filterTypes[e];return null==t&&(t="text"),t},timeToInt:function(e,t,a){return 3600*parseInt(e)+60*parseInt(t)+parseInt(a)},check:function(e,t,a){if(["url","previousUrl"].indexOf(e)>-1&&["regexpMatch","regexpNotMatch"].indexOf(t)===-1)for(var n=0;n<a.length;n++)a[n]=encodeURI(decodeURI(a[n]));if("zero"==e)return!0;var r=this.getType(e),i="";null==r&&(r="text");var o="int"==r||"seconds"==r||"date"==r,s="text"==r;o&&(i=0),this.isNotEmptyFilter(e)&&(i=null);var c=this.get(e,i),l=!1;if("object"==typeof c&&null!=c)var u=c;else var u=[c];if(o){for(var n in u)u[n]=parseInt(u[n]);for(var n in a)"date"==r&&"string"==typeof a[n]?a[n]=this.prepareDate(a[n]):a[n]=parseInt(a[n])}else if(s){for(var n in u)"string"==typeof u[n]&&(u[n]=u[n].toLowerCase());for(var n in a)"string"==typeof a[n]&&(a[n]=a[n].toLowerCase())}for(var h=0,d=0;d<u.length;d++){var p=u[d],f=null==p?"":p.toString();if(null==p&&this.isNotEmptyFilter(e))break;if("="==t)if("timeRange"==r)for(var n in a){var m=this.timeToInt(p[3],p[4],p[5]),g=this.timeToInt(a[n][0][0],a[n][0][1],a[n][0][2]),v=this.timeToInt(a[n][1][0],a[n][1][1],a[n][1][2]);if(v>g)m>=g&&m<=v&&h++;else if(g>v){var y=this.timeToInt(23,59,59),b=0;(m>=g&&m<=y||m>=b&&m<=v)&&h++}}else"searchKeyword"==e?chat.searchKeyword.check(p)&&h++:a.indexOf(p)!=-1&&h++;else if("!="==t)if("searchKeyword"==e){if(chat.searchKeyword.check(p))return!1;h++}else{if(a.indexOf(f)!=-1)return!1;h++}else{if("empty"==t||"not empty"==t){var w=null!=p&&0!=p&&p.toString().length;return"not empty"==t&&w||"empty"==t&&!w}for(var n in a)if("like"==t||"not like"==t){for(var C=0,T=a[n].split(" "),k=0;k<T.length;k++)f.indexOf(T[k])!=-1&&C++;if(C=C===T.length,"like"==t)C&&h++;else{if(C)return!1;h++}}else if("regexpMatch"==t||"regexpNotMatch"==t)try{var x=new RegExp(a[n]),$=null!=f.match(x);if("regexpMatch"==t){if(!$)return!1;h++}else{if($)return!1;h++}}catch(e){return window.console&&console.log("Regexp exception",x,e),!1}else if(">"==t)p>a[n]&&h++;else if("<"==t)p<a[n]&&h++;else if("beginWith"==t)0==f.indexOf(a[n])&&h++;else if("notBeginWith"==t){if(0==f.indexOf(a[n]))return!1;h++}else if("endWith"==t){var S=f.lastIndexOf(a[n]);S!=-1&&f.lastIndexOf(a[n])==f.length-a[n].length&&h++}else if("notEndWith"==t){var S=f.lastIndexOf(a[n]);if(S!=-1&&f.lastIndexOf(a[n])==f.length-a[n].length)return!1;h++}}}return l=h>0},incr:function(e,t){null==t&&(t=1);var a=parseInt(this.get(e,0));return a||(a=0),a+=t,this.set(e,a),a},decr:function(e,t){return null==t&&(t=-1),this.incr(e,t)},isLocalFilter:function(e){return null!=this.localFilters[e]},isTimeFilter:function(e){return null!=this.timeFilters[e]},isNotEmptyFilter:function(e){return null!=this.notEmptyFilters[e]},isChanged:function(e,t){return"object"!=typeof e&&"object"!=typeof t||(e=JSON.stringify(e),t=JSON.stringify(t)),e!==t},set:function(e,t){var a=this;if(!this.getFiltersFromStorageDone){var n=this.getFiltersFromStorage();if(null==n)return void setTimeout(function(){a.set(e,t)},100)}if(this.isTimeFilter(e)&&(t=this.now()),this.isChanged(this.values[e],t)){if(this.values[e]=t,!this.isLocalFilter(e)){var r=$.extend({},this.values);for(var i in r)this.isLocalFilter(i)&&delete r[i];supportStorage.set("fv::"+chat.siteParams.id,JSON.stringify(r))}chat.actions.listeners.queue(e)}},now:function(){return parseInt(chat.now()/1e3)},prepareDate:function(e){if("string"==typeof e){var t=e.split(".");t=[[parseInt(t[2]),parseInt(t[1]),parseInt(t[0])]]}else var t=this.getTimeRangeValueFromDateObject(e);return t[0][1]<10&&(t[0][1]="0"+t[0][1]),t[0][2]<10&&(t[0][2]="0"+t[0][2]),parseInt(t[0][0]+""+t[0][1]+t[0][2])},nowDate:function(){return this.prepareDate(new Date)},get:function(e,t){if(this.getFiltersFromStorageDone||this.getFiltersFromStorage(),0==e.indexOf("clientField_")){e=e.split("clientField_")[1];var a=chat.client.get(e);return a}var a=this.values[e];if(null!=a)var n=a;else var n=t;if(this.isTimeFilter(e)){var r=this.now();n=r-parseInt(n)}return n},getTimeRangeValueFromDateObject:function(e){return[[e.getFullYear(),e.getMonth()+1,e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()]]},getUTCTimeRangeValueFromDateObject:function(e){return[[e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds()]]},initDate:function(){this.set("date",this.nowDate())},initDayOfWeek:function(){var e=new Date,t=e.getDay();0==t&&(t=7);var a=[t.toString()];t<6?a.push("12345"):a.push("67"),this.set("dayOfWeek",a),this.set("timeRange",this.getTimeRangeValueFromDateObject(e)),this.set("timeUTC",this.getUTCTimeRangeValueFromDateObject(e))},timeEventsInterval:null,getFiltersFromStorageDone:!1,getFiltersFromStorage:function(){if(!chat.siteParams)return null;var e=supportStorage.get("fv::"+chat.siteParams.id);e=e?JSON.parse(e):{};for(var t in e)this.isLocalFilter(t)?delete e[t]:chat.actions.listeners.queue(t);return this.values||(this.values={}),this.values=$.extend({},this.values,e),this.getFiltersFromStorageDone=!0,e},init:function(){var e=this;this.getFiltersFromStorage(),e.initDayOfWeek();var t=function(){e.initDayOfWeek(),e.initDate();for(var t in e.timeFilters)chat.actions.listeners.queue(t);chat.actions.listeners.queue("zero")};t(),clearInterval(this.timeEventsInterval),this.timeEventsInterval=setInterval(function(){chat.suspend.check(t,"autoActionsTimeFilters")},1e3)},initialPrepareValues:function(e,t){for(var a in t)if("seconds"==e)"object"==typeof t[a]&&(t[a]=chat.actions.filters.secondsToInt(t[a]));else if("timeRange"==e)for(var n in t[a])if("string"==typeof t[a][n]){var r=t[a][n].split(":");t[a][n]=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2])]}return t}}},messages:{maxID:0,chatTextareaValue:function(e){var t=$("#chatTextarea");if(null==e){var e=$("<div></div>").html(t.html());return $.each($(".emojione",e),function(){var e=$(this);e.after(e.attr("alt")),e.remove()}),e.html(e.html().split("<div").join("\n<div").split("<br>").join("\n").split("<br/>").join("\n").split("<br />").join("\n")),e.text()}t.html(e).keyup().trigger("textchange")},cometTypePublishTimeout:null,count:0,receiveCount:0,sendCount:0,getLastDiv:function(){return $(".chatInner").children(".message,.chatInfoBlock").filter(":last")},dateFromString:function(e){if("string"==typeof e){e=e.split(" "),e[0]=e[0].split("-"),e[1]=e[1].split(":");var t=new Date(e[0][0],e[0][1]-1,e[0][2],e[1][0],e[1][1],e[1][2]);return t}return e},timeOffsetCache:null,timeOffset:function(){if(null!=this.timeOffsetCache)return this.timeOffsetCache;var e=new Date,t=-e.getTimezoneOffset()/60-3;return this.timeOffsetCache=t,t},sendMessageStatus:function(e,t){var a=chat.messages.history.get(e);a&&!a.type&&chat.onReady(function(){chat.nodeAjax.send({url:"/setMeTalkMessageStatus",method:"POST",data:JSON.stringify({status:t,id:e}),headers:{"X-Metalk-Org":chat.siteParams.orgID,"X-Metalk-Site":chat.siteParams.id,"X-Metalk-Talkid":chat.siteParams.talkID}},function(e){})},"liteMode")},newRealMessageInChat:function(e){chat.actions.filters.set("lastMessageSender",e),chat.actions.filters.set("timeFromLastMessage"),chat.actions.filters.set("timeFromLastMessageFrom"+("operator"==e?"Operator":"Client")),chat.actions.filters.incr("operator"==e?"operatorMessagesCountAtVisit":"clientMessagesCountAtVisit"),chat.actions.filters.incr("messagesCountAtVisit")},receive:function(e){"autoMessage"===e.type&&chat.isOpened()||chat.tabs.openByType("chat");var t=this.timeOffset();if("object"==typeof e.dt)var a=e.dt;else{var a=this.dateFromString(e.dt);a.setHours(a.getHours()+t)}e.type||this.count++;var n=!0;null!=e.type&&"autoMessage"==e.type||this.receiveCount++,"supportAPI"==e.type&&chat.actions.filters.set("timeFromLastAutoMessageToClient"),null!=e.sound&&(n=e.sound),"tab"===e.type&&e.other&&e.other.tab&&e.other.tab.id&&(e.fromCache||chat.sendEvent("Tab sended by operator","Оператор отправил вкладку","Tab sended by operator "+e.other.tab.id)),"simulated"==e.type?chat.onlineSimulation.started=!0:chat.onlineSimulation.stop(),e.type||e.justAddToHistory||(chat.operators.balancer.disable(),chat.operatorAway.setActivity(),this.newRealMessageInChat("operator")),this.removeOperatorTyping(null,0),chat.operators.closeChangeDialog();var r="forward"!=e.type;e.type||e.justAddToHistory||e.other&&null!=e.other.changeOperator&&!e.other.changeOperator||chat.operators.setTalkWithOperator(e.operator,r),chat.operators.getCurrent()==e.operator||e.justAddToHistory||chat.operators.select({operator:e.operator,force:!0,remember:!0});var i={from:e.operator,text:e.text,dt:a,id:e.id,type:e.type,other:e.other};this.history.add(i),e.deliveryReport&&this.sendMessageStatus(e.id,"delivered"),i.receiveNow=!0,this.show(i),e.id>0&&"autoMessage"!=e.type&&chat.lastReceiveMessageID.set(e.id);var o=chat.operators.getOperatorDisplayParams(e.operator);if(e.avatar=o.avatar,e.operatorName=o.name,RPC.post("receiveMessage",e),!e.silent&&!e.justAddToHistory){chat.triggerBadge.incr(e.id),n&&chat.playSound(chat.siteParams.params.newMessageNotification.sound);var s=chat.siteParams.params.newMessageNotification.action,c=this.formatText(e.text,"operator",e.type,e.other);if("html"==c.type&&(chat.siteParams.mobile?c.text="Новое сообщение от консультанта":s="open"),"open"==s)chat.openSupport({focus:"autoMessage"!=e.type,autoClose:!0}),RPC.post("startPulsate",{});else{var l={},u=$("<div></div>").html(emojione.toImage(c.text));$.each($(u).find(".emojione"),function(){var e=$(this);l[e.attr("alt")]=e.clone().wrap("<div>").parent().html()}),RPC.post("showNewMessage",{message:$("<div></div>").html(c.text).text(),textType:c.type,name:o.name,avatar:o.avatar,emoji:l})}}},getContactsBeforeChat:{ask:function(e,t){if(chat.sendEvent("Ask user contacts before chat","Отображена форма контактов перед диалогом"),$(".askForContactsType_contacts").html(chat.siteParams.params.online.collectContactsBeforeStartMessage),$(".askForContactsType").hide(),$(".askForContactsType_"+t).show().addClass("lastVisible"),"questionCategory"==t)$(".askForContactsForm > .contacts:not(.none)").hide();else{var a=!1;for(var n in chat.siteParams.params.online.collectContacts){a=!0;break}a||$(".askForContactsForm.contacts").remove(),$(".askForContactsForm > .contacts:not(.none)").show()}chat.tabs.loadClientFeedbackInfo(),$(".askForContactsForm[name=type]").val(t),$(".askForContactsForm[name=text]").val(e),$(".onlineSupportChatArea,.me-talk-copyright-chat").hide(),$(".askForContacts").show(),chat.fixFeedbackFormHeight(),chat.phoneMask.load()},send:function(e){var t=this;$(e).attr("disabled","disabled");var a=$.form.get("askForContactsForm",!1);a.requireContacts="contacts"==a.type?1:0,a.formBeforeChatStart=1;var n=$(".askForContactsForm[name=questionCategory]:visible");return n.children().length>1&&!a.questionCategory?($(e).removeAttr("disabled"),void chat.alert.show({code:0,descr:"Выберите категорию"})):void chat.api("setClientContacts",a,function(n){1==n.code?(chat.sendEvent("User gave contacts before chat","Заполнена форма контактов перед диалогом"),chat.client.update(n.info),chat.operators.getBalancedOperator({},function(e){if($(".askForContacts").hide(),$(".onlineSupportChatArea,.me-talk-copyright-chat").show(),e.specificGroup&&!e.operatorInSpecificGroup&&chat.isOfflineFormUsed()){$(".meTalkPM[name=text]").val(chat.messages.chatTextareaValue());for(var t in a)$(".meTalkPM[name="+t+"]").val(a[t]);chat.operators.hideAll()}else e.specificGroup&&e.operatorInSpecificGroup&&e.groupId&&e.operator&&chat.operators.select({operator:e.operator,group:e.groupId});"online"!==chat.chatMode&&"simulation"!==chat.siteParams.params.leadGen.mode||(storeWithExpiration.set("cbc2_"+chat.siteParams.id,1,6e4),chat.messages.send());var n=$("#chatTextarea").data("resize");null!=n&&n()})):($(e).removeAttr("disabled"),n.retry=function(){t.send(e)},chat.alert.show(n))})}},contactsNotificationCallback:function(){var e=this,t={contact:$.form.get("contactsNotification",!1)};t.descr=t.contact.descr,t.important=0,t.formAfterChatStart=1,$(".contactsNotification[name=eulaAgreement]").length&&!t.contact.eulaAgreement?chat.alert.show({code:801,descr:"Требуется согласие на обработку персональных данных",retry:function(){e.contactsNotificationCallback()}}):(chat.api("changeClientContacts",t,function(e){1==e.code&&(e.updatedKeys&&e.updatedKeys.length&&chat.sendEvent("User gave contacts during chat","Заполнена форма контактов после начала диалога"),chat.client.update(e.info))}),chat.siteParams.refuseEnterName=1,RPC.post("refuseEnterName",{}),chat.notifications.close())},send:function(e,t,a){var n=this;if(!chat.siteParams)return setTimeout(function(){n.send(e)},1e3);n.removeOperatorTyping(null,0),n.clearTyping(),chat.listen.start({cid:"main"});var r=!1;if(null==e){var e=chat.messages.chatTextareaValue();r=!0}if(e=$.trim(e),e.length&&e!=$("#chatTextarea").attr("placeholder")){if(!storeWithExpiration.get("cbc2_"+chat.siteParams.id)&&chat.actions.filters.check("timeFromLastMessage",">",[3600])){var i=chat.siteParams.params.leadGen.questionCategories;if("beforeStart"==chat.siteParams.params.online.collectContactsMode)return this.getContactsBeforeChat.ask(e,"contacts");if(i.ask&&i.list.length&&!chat.operatorAway.getActivity())return this.getContactsBeforeChat.ask(e,"questionCategory")}r&&chat.messages.chatTextareaValue("");var o=chat.operators.getCurrent(),s=new Date;if(e=emojione.shortnameToUnicode(e),!t)var c={from:"client",text:e,dt:s},l=n.show(c);chat.operators.balancer.isEnabled(function(r){var i=-1;"online"==chat.chatMode||chat.onlineSimulation.started?i=chat.siteParams.params.leadGen.simulation.delay:"offline"==chat.chatMode&&"simulation"==chat.siteParams.params.leadGen.mode&&(i=8),chat.disableLiteMode();var s=[];for(var u in chat.siteParams.operators)chat.operators.canViewOperator(u)||s.push(u);chat.disallowEcho=!0;var h=chat.operators.getVisibleGroups(),d=!(r&&!chat.siteParams.params.operators.allowChange)&&chat.operators.getCurrentGroup();h&&h.length&&d&&h.indexOf(d)===-1&&(d=!1),chat.api("sendMessageToOperator",{text:e,operator:o,hiddenOperators:s,messages:n.count,url:chat.siteParams.currentUrl,title:chat.siteParams.currentTitle,operatorActivity:chat.operatorAway.getActivity()?1:0,chatMode:chat.chatMode,forceOfflineModeDelay:i,systemMessage:!1,simulationStarted:chat.onlineSimulation.started?1:0,needBalance:r?1:0,selectedGroup:d,messageType:!!t&&t,visibleGroups:h,sendEcho:!!chat.siteParams.talkIDFromSetup},function(r){if(!t){if(!chat.siteParams.mobile&&chat.siteParams.params.siteChatOptions.disallowSiteInIframe){var i=new Date;i.setTime(i.getTime()+36e5);var s=i.toGMTString();chat.cookie.set("openSupportAtNewPage",1,s)}if(1==r.code){var u=(chat.actions.filters.get("messagesCountAtVisit",0),chat.actions.filters.get("clientMessagesCountAtVisit",0)),h=chat.actions.filters.get("operatorMessagesCountAtVisit",0),d=chat.actions.filters.get("autoMessageToClientCountAtVisit",0),p=0==u;if(a||RPC.post("clientSendMessage",{text:e,operator:o,firstMessage:p}),p){var f="Client initiate chat",m="Посетитель инициировал диалог";h?(f="Client answer on operator request",m="Оператор инициировал диалог и посетитель ответил на него"):d&&(f="Client answer on automessage",m="Посетитель ответил на автоприветствие"),chat.sendEvent(f)}if(r.operator&&chat.operators.setTalkWithOperator(r.operator),n.newRealMessageInChat("client"),r.balancedOperator?(chat.operators.balancer.disable(),chat.operators.select({operator:r.balancedOperator,group:r.balancedOperatorGroup})):r.operator&&chat.operators.select({operator:r.operator}),chat.lastReceiveMessageID.set(r.id),r.contacts=parseInt(r.contacts),chat.onlineSimulation.onSendMessage({text:e,contacts:r.contacts}),!n.receiveCount&&r.phoneSupport&&chat.siteParams.params.phoneSupport.waitMessage.length&&(n.receiveCount++,n.show({from:chat.operators.getCurrent(),dt:i,text:chat.siteParams.params.phoneSupport.waitMessage})),c.id=r.id,parseInt(c.id)>chat.messages.maxID&&(chat.messages.maxID=parseInt(c.id)),$("#text_"+chat.prepareIdForHtml(l)).attr("id","text_"+chat.prepareIdForHtml(c.id)),n.history.add(c),supportStorage.set("sendMessage",chat.now()),"afterStart"==chat.siteParams.params.online.collectContactsMode){var g=[];for(key in chat.siteParams.params.online.collectContacts)chat.client.get(key)||g.push(key);if(g.length&&!r.enterName&&null==chat.siteParams.refuseEnterName&&!chat.notifications.displayed){var v=$("#contactsNotification").detach();v.find("input").bind("keyup",function(e){13==e.keyCode&&n.contactsNotificationCallback()}),v.find("button").bind("click",function(){n.contactsNotificationCallback()});for(var y in chat.siteParams.params.online.collectContacts)v.find(".row."+y).removeClass("none");chat.sendEvent("Ask user contacts during chat","Запрос контактов во время диалога"),chat.notifications.show({html:v,onClose:function(){chat.siteParams.refuseEnterName=1,RPC.post("refuseEnterName",{})}})}}"offline"==chat.chatMode?setTimeout(function(){chat.onlineSimulation.start()},8e3):chat.operatorAway.start(),setTimeout(function(){chat.actions.filters.set("newMessageFromClient",e),setTimeout(function(){chat.actions.filters.get("newMessageFromClient")==e&&chat.actions.filters.set("newMessageFromClient",null)},2e3)},1e3)}else 599==r.code&&chat.listen.actions.setBan({ban:1})}chat.disallowEcho=!1})})}this.count++,this.sendCount++},history:{clear:function(){for(var e=this.getIdList(),t=0;t<e.length;t++)this.remove(e[t]);chat.messages.showHistory()},idListKey:function(){return chat.siteParams.id+"::"+chat.siteParams.talkID+"::history"},messageKey:function(e){return chat.siteParams.id+"::"+chat.siteParams.talkID+"::message::"+e},getIdList:function(e){null==e&&(e={});var t=storeWithExpiration.get(this.idListKey());if(null==t?t=[]:"number"==typeof t&&(t=[t]),null!=e.last){var a=0;t=t.reverse();var n=[];for(key in t){if(a==e.last)break;n.push(t[key]),a++}t=n.reverse()}return t},edit:function(e,t){var a=this.get(e);a&&(a.text=t,supportStorage.set(this.messageKey(e),a))},removeFromMemory:function(e){"string"==typeof e&&(e=parseInt(e));var t=this.getIdList(),a=t.indexOf(e);a!=-1&&(t.splice(a,1),supportStorage.remove(this.messageKey(e)),this.saveIdList(t),supportStorage.set("removeMessage",e))},remove:function(e){this.removeFromMemory(parseInt(e)),this.removeFromMemory(parseFloat(e)),this.removeFromHTML(e)},removeFromHTML:function(e){var t=$("#text_"+chat.prepareIdForHtml(e)),a=$(t).parent();a.children(".text").length<2?a.remove():(t.prev(".clear").remove(),t.remove()),chat.messages.scrollBottom()},showOneMoreMessage:function(){var e=$(".message > .text",".chatInner").length;e?e++:e=1,chat.messages.showHistory({last:e,append:!0})},isRemoveByTextEnabled:function(){var e=chat.siteParams.params.siteChatOptions.removeSimilarMessages;return e||null==e},removeByText:function(e,t){var a=0;if(this.isRemoveByTextEnabled()){var n=this.idListKey(),r=storeWithExpiration.get(n);null==r&&(r=[]);for(i in r){var o=this.get(r[i]);o&&o.text==e&&o.type==t&&!o.answered&&(chat.messages.history.remove(r[i]),a++)}}return a},removeAutoMessagesWithoutAnswer:function(e){if(this.isRemoveByTextEnabled())for(var t=this.getIdList(),a=0;a<t.length;a++)if(t[a+1]){var n=t[a],r=this.get(n);r&&("autoMessage"!=r.type||r.answered||e==r.other.autoMessageID||(r.pageID==chat.activity.pageID?this.removeFromMemory(r.id):this.remove(r.id)))}},add:function(e){var t=!1;if(null!=e.id&&null==this.get(e.id)){"autoMessage"==e.type&&this.removeAutoMessagesWithoutAnswer(e.other.autoMessageID),"string"==typeof e.id&&(e.id=parseInt(e.id));var a=this.getIdList();if(e.pageID=chat.activity.pageID,"client"==e.from&&!e.type)for(var n=!1,r=a.length-1;r>=0;r--){var i=a[r],o=this.get(i);if(!(o&&["autoMessage","supportAPI"].indexOf(o.type)>-1&&(!n||o.other&&o.other.autoMessageID==n)))break;if(o.answered=1,supportStorage.set(this.messageKey(i),o),!o.other||!o.other.autoMessageID)break;n=o.other.autoMessageID}"autoMessage"==e.type&&this.removeByText(e.text,e.type)&&(t=!0),a.push(e.id),a.sort(),this.saveIdList(a),supportStorage.set(this.messageKey(e.id),e)}t&&this.showOneMoreMessage()},saveIdList:function(e){e=e.sort(function(e,t){return e>t?1:-1});var t=this.idListKey(),a=parseInt(chat.siteParams.params.siteChatOptions.forgetHistory);storeWithExpiration.set(t,e,1e3*a)},get:function(e){return supportStorage.get(this.messageKey(e))}},showHistory:function(e){e||(e={});var t=$(".chatInner"),a=$(".chat"),n=t.height(),r=a.scrollTop(),i=this.history.getIdList(e),o=[".newNotification",".me-talk-copyright"];e.last&&o.push(".userHTML"),e.append||t.children(":not("+o.join(",")+")").remove();for(key in i)this.show(this.history.get(i[key]));var s=t.height();a.scrollTop(r+(s-n))},requestSnippet:function(e,t){chat.onReady(function(){chat.nodeAjax.send({url:"/requestSnippet",method:"POST",data:JSON.stringify({url:e,id:t}),headers:{"X-Metalk-Org":chat.siteParams.orgID,"X-Metalk-Site":chat.siteParams.id,"X-Metalk-Talkid":chat.siteParams.talkID}},function(e){})},"liteMode")},linkify:function(e){var t,a,n=this;a=/((https?|ftp):\/\/(\S+)(\b)[\/\=\?а-яА-Я\+\-\)\(]*)/gim,t=e.replace(a,'<a href="$1" class="linkified" onClick="return chat.messages.clickOnLink(this);" target="_blank">$1</a>');var r=$("<div></div>").html(t);return $.each($("a.linkified",r),function(){var e=$(this),t=e.attr("href");t.toLowerCase().indexOf("//")==-1&&(t=t.indexOf("@")!=-1?"mailto:"+t:"http://"+t),t=$.trim(t),e.attr("href",t);var a=chat.generateCode(10);e.addClass("snippet_"+a+" waitingForSnippet"),n.requestSnippet(t,a)}),t=r.html()},clickOnLink:function(e){var t=$(e).attr("href");return chat.api("clientClickOnLink",{link:t},null,"html"),!chat.siteParams.linkHandler||(RPC.post("clickOnLink",{href:t}),!1)},show:function(e){if(!(null==e||e.id&&$("#text_"+chat.prepareIdForHtml(e.id)).length)){chat.toggleDownloadChatButton();var t=this,a=$(".chatInner"),n=!1;if(e.id?parseInt(e.id)>chat.messages.maxID&&(chat.messages.maxID=parseInt(e.id)):e.id=chat.generateCode(10),null!=e.text&&e.text){null==e.other&&(e.other={}),e.other.receiveNow=e.receiveNow;var r=this.formatText(e.text,e.from,e.type,e.other),i=r.text;if(r.empty)return void $b.append("<div class='none'>"+i+"</div>");n=r.block;var i="<div class='text' id='text_"+chat.prepareIdForHtml(e.id)+"'>"+i+"</div>"}else var i="";if(i=emojione.unicodeToImage(i),"client"==e.from)var o="client",s="Вы";else{var c=chat.operators.get(e.from);if(c)var s=c.fio;else var s="Оператор";var o="operator"}if(n)n=$("<div />").addClass("chatInfoBlock").css({position:"relative",paddingBottom:"15px",paddingTop:"15px"}).html(i).appendTo(a),n.data("id",e.id),e.other&&e.other.authMessageID&&n.addClass("autoMessage_"+e.other.autoMessageID);else{var l=$("<div />");l.attr("from",e.from),l.data("id",e.id),l.attr("type",e.type?e.type:""),l.addClass("message from_"+o);var u=$("<div />").addClass("username "+o).html(s),h=!1;if(null!=e.dt&&0!=e.dt)d=this.formatDT(e.dt),h=this.getDateFromDT(e.dt),d=$("<div class='date c'>"+d+"</div>");else var d="";l.data("date",h);var p=!(!e.other||!parseInt(e.other.stackWithPrevious)),f=this.getLastDiv();f.attr("from")==e.from&&f.data("date")==h&&("autoMessage"!=e.type&&"autoMessage"!=f.attr("type")||p)?("classic"!=chat.siteParams.style&&(d=""),f.append("<div class='clear'></div>").append(d).append(i)):(l.append(u).append(d).append(i).appendTo(a),l.find(".text").addClass("first")),$(".afterMessageFiller").remove(),$("<div class='afterMessageFiller none'>&nbsp;</div>").appendTo(a),this.count>=3&&"online"==chat.chatMode&&this.showRateNotification(),e.other&&e.other.autoMessageID&&l.addClass("autoMessage_"+e.other.autoMessageID)}return a.find(".message, .chatInfoBlock").first().addClass("first"),a.find(".message.last:not(:last)").removeClass("last"),a.find(".message:last").addClass("last"),this.updatePaddings(),setTimeout(function(){t.scrollBottom(e.receiveNow)},100),e.id}},showRateNotification:function(e){if(null==chat.siteParams.refuseSendRate&&$("div[id^='tab'][data-type=reviews]:not(.hiddenTab)").length){var t=$("<div />"),a=$("<p></p>").text("Оцените нашу работу"),n=function(e){chat.notifications.close(),RPC.actions.openReviewsTab(),chat.rate.refuseSendRate(),$(".rateOperator[name=rate]").val(e)};if("2"==chat.siteParams.params.rate.values)$("<i class='icon-thumbs-up greenText'></i>").bind("click",function(){n("good")}).appendTo(a),$("<i class='icon-thumbs-down redText icon-rotate-180'></i>").bind("click",function(){n("bad")}).appendTo(a);else if("5"==chat.siteParams.params.rate.values)for(var r=1;r<=5;r++){var i=$("<i class='star star-"+r+" icon-star-o' data-value='"+r+"'></i>").bind("mouseover",function(){for(var e=parseInt($(this).data("value")),t=1;t<=e;t++)$(".star-"+t).addClass("icon-star star-hover").removeClass("icon-star-o")}).bind("mouseout",function(){$(".star").removeClass("icon-star star-hover").addClass("icon-star-o")}).bind("click",function(){n($(this).data("value")+"/5")});i.appendTo(a)}t.append(a),chat.notifications.displayed&&!e||chat.notifications.show({html:t,onClose:function(){chat.rate.refuseSendRate()}})}},updatePaddings:function(){if("support"==chat.type){var e=$(".chat"),t=$(".chatInner"),a=parseInt(e.height());"classic"==chat.siteParams.style&&(a-=parseInt(e.css("padding-top"))+parseInt(e.css("padding-bottom")));var n=t.css("padding-top");n||(n=0),n=parseInt(n);var r=n,i=parseInt(t.outerHeight());a>=i?n+=a-i:n-=i-a,n<0&&(n=0);var o=t.scrollTop(),s=n-r;t.css("padding-top",n).scrollTop(o-s),e.perfectScrollbar("update"),chat.loadDelayedSrc()}},getDateObjectFromDt:function(e){if("string"==typeof e){var t=e.substr(0,4),a=e.substr(5,2)-1,n=e.substr(8,2),r=parseInt(e.substr(11,2))+3+chat.messages.timeOffset(),i=e.substr(14,2),o=e.substr(17,2);e=new Date(t,a,n,r,i,o)}return"object"==typeof e&&null==e.getHours&&(e=new Date),e},getDateFromDT:function(e){e=this.getDateObjectFromDt(e);var t=e.getFullYear(),a=e.getMonth(),n=e.getDate();return a<10&&(a="0"+a),n<10&&(n="0"+n),t+"-"+a+"-"+n},formatDT:function(e,t){e=this.getDateObjectFromDt(e);var a=new Date,n=e.getHours(),r=e.getMinutes(),i=e.getMonth()+1,o=e.getDate(),s=e.getFullYear();if(n<10&&(n="0"+n),r<10&&(r="0"+r),i<10&&(i="0"+i),o<10&&(o="0"+o),a.toDateString()==e.toDateString())var e=n+":"+r;else if(t)var e=o+"."+i+"."+s+" "+n+":"+r;else var e=n+":"+r+"<div class='date_sub fs9'>"+o+" "+chat.shortMonthDescr(i)+"</div>";return e},isDateEqual:function(e,t){return e.getFullYear()===t.getFullYear()&&e.getUTCDate()===t.getUTCDate()&&e.getUTCMonth()===t.getUTCMonth()},isToday:function(e){return this.isDateEqual(e,new Date)},isYesterday:function(e){var t=new Date;return t.setTime(t.getTime()-864e5),this.isDateEqual(e,t)},formatDate:function(e,t){e=this.getDateObjectFromDt(e);var a=e.getMonth()+1,n=e.getDate(),r=e.getFullYear();if(a<10&&(a="0"+a),n<10&&(n="0"+n),t){if(this.isToday(e))return"Сегодня";if(this.isYesterday(e))return"Вчера"}return n+"."+a+"."+r},formatText:function(e,t,a,n){if("tab"==a&&n){"string"==typeof n&&(n=JSON.parse(n));var r=0;if(null!=n.tab){if(n.tab.id)for(var i=!1,o=0;o<chat.siteParams.tabs.length;o++)if(chat.siteParams.tabs[o].id==n.tab.id){i=!0;break}i||(e="",r=1);var s=n.tab.button?n.tab.button:"Просмотреть";e="%html%%block%<div class='infoMessageInChat'><div class='title mb10'>"+n.tab.title+"</div><button onClick='chat.tabs.showTab("+JSON.stringify(n.tab)+")' class='b'>"+s+"</button></div>",n.receiveNow&&"show"==n.tab.showType&&chat.tabs.showTab(n.tab)}}"string"!=typeof e&&(e=e.toString()),t||(t="client");var c="text",l=0;if("client"!=t&&0==e.indexOf("%html%")&&(c="html"),"text"==c){e=$("<div/>").text(e).html(),e=e.split("\n").join("\n<br />");var u=e.substr(-6,-1);"<br />"==u&&(e=e.substr(0,-6)),e=this.linkify(e)}else{e=e.substr(6),0==e.indexOf("%block%")&&(e=e.substr(7),l=1),e=chat.appendStaticDomain(e);try{var h=$("<div />").html(e)}catch(e){var h=$("<div></div>")}h.find("a[href],form").attr("target","_blank");var d=h.find("img");d.css({"max-width":"100%",height:"auto"}).attr("onload","chat.messages.updatePaddings();"),e=h.html(),e=chat.prepareHTML(e),h.text().length||d.length||(l=1,r=1)}return{text:e,block:l,type:c,empty:r}},scrollBottom:function(e){chat.messages.updatePaddings();var t=$(".chat");if(t.length){var a=t.height(),n=t[0].scrollHeight-a;if(e&&a){var r=$(".chatInner").children(".message,.chatInfoBlock").last().children(".text").last();if(r.length){var i=r.position().top+r.parent().position().top;n=i;var o=$(".me-talk-copyright-chat");o.is(":visible")&&(n-=o.height()+5)}}t.stop().animate({scrollTop:n},400)}},clearTyping:function(){clearTimeout(this.cometTypePublishTimeout),this.cometTypePublishTimeout=null},operatorTypingTimeout:{},operatorTyping:function(e,t,a){a||(a=5e3),null==t&&(t=!1),t&&chat.operatorAway.setActivity();var n=chat.siteParams.params.siteChatOptions.hideOperatorTyping;
if(n&&(n=parseInt(n)),!n){var r=chat.operators.getOperatorDisplayParams(e);r&&RPC.post("operatorTyping",{operator:r,typing:1,text:"Печатает сообщение"});var i=this,o=this.getLastDiv(),s=$(".operatorTyping.typing_"+e);if(!s.length){if(s=$(".operatorTyping.temp").clone().removeClass("temp").addClass("typing_"+e),o.attr("from")==e)o.append(s);else{this.show({from:e});var o=this.getLastDiv();o.append(s)}s.show(),this.scrollBottom()}clearTimeout(this.operatorTypingTimeout[e]),this.operatorTypingTimeout[e]=setTimeout(function(){i.removeOperatorTyping(e)},a)}},removeOperatorTyping:function(e,t){if(clearTimeout(this.operatorTypingTimeout[e]),null==t&&(t=200),null!=e)var a=$(".typing_"+e);else var a=$(".operatorTyping:not(.temp)");if(RPC.post("operatorTyping",{typing:0}),a.length){a.hide();var n=a.parent().children(".text");0==n.length?a.parent().remove():(a.remove(),n.filter(":first").addClass("first")),chat.messages.updatePaddings()}}},pm:{show:function(e){},lcab:{send:function(e){var t=this;$(e).attr("disabled","disabled");var a=$.form.get("lcabPM",!1);chat.disableLiteMode(),chat.api("sendLcabPM",a,function(n){n.retry=function(){t.send(e)},chat.alert.show(n),1==n.code&&($(e).removeAttr("disabled"),$("textarea.lcabPM").attr("value",""),chat.pm.show(a.text))})}},metalk:{send:function(e){var t=this,a=$("#metalkPmSend"),n=$.form.get("meTalkPM",!1);return n.currentPage={url:chat.siteParams.currentUrl,title:chat.siteParams.currentTitle},$(".allowSms:visible").length&&!n.allowSms?void chat.alert.show({code:1,descr:"Пожалуйста, подтвердите возможность отправки сообщений для Вас"}):(a.attr("disabled","disabled"),chat.disableLiteMode(),void chat.api("sendLcabMetalk",n,function(r){r.retry=function(){t.send(e)},chat.alert.show(r),a.removeAttr("disabled"),1==r.code&&(chat.lastReceiveMessageID.set(r.id),chat.captcha.reset(),chat.messages.newRealMessageInChat("client"),chat.sendEvent("Offline message sent","Посетитель отправил сообщение в Offline-форму"),chat.client.update(r.info),$("textarea.meTalkPM").attr("value",""),e||RPC.post("clientSendMessage",{text:n.text,operator:!1}),chat.messages.history.add({id:r.id,from:"client",text:n.text,dt:new Date}),chat.messages.history.showOneMoreMessage(),chat.pm.show(n.text))}))}}},listen:{ws:null,started:{},getListenNowKey:function(e){return null!=chat.siteParams?"listennow::"+chat.siteParams.id+"::"+chat.siteParams.talkID+"::"+e:"listennow::"+chat.instanceID},isListeningNow:function(e){return!this.isCrossTabDisabled()&&storeWithExpiration.get(this.getListenNowKey(e))},isMainListener:function(){return this.isListeningNow("main")==chat.instanceID},isCrossTabDisabled:function(){return store.disabled||chat.siteParams.mobile},setListenNow:function(e,t,a,n){if(!chat.isLiteModeEnabled()){var r=this;if(this.isCrossTabDisabled())return!a||a(!0);null==t&&(t=4e3);var i=r.isListeningNow(e);if(!i||n&&i==chat.instanceID)return storeWithExpiration.set(r.getListenNowKey(e),chat.instanceID,t,!0),!!a&&setTimeout(function(){a(r.isListeningNow(e)==chat.instanceID)},30)}return!!a&&a(!1)},stop:function(e,t){if(this.started[e]=!1,!t){if(this.isCrossTabDisabled())return!1;var a=this.isListeningNow(e);a==chat.instanceID&&storeWithExpiration.remove(this.getListenNowKey(e),!0)}},getCometCacheKey:function(e){return null!=chat.siteParams?"cometcache::"+chat.siteParams.id+"::"+e:"cometcache::"+e},writeCometToCacheMain:function(e){var t=chat.siteParams.channelDate;null==t&&(t=1),t=parseInt(t),t+=1;var a=chat.siteParams.channelEtag;null==a&&(a=0),a++,this.writeCometToCache("main",t,a,e),this.listenMainCacheIntervalCallback()},writeCometToCache:function(e,t,a,n){if(store.disabled)return!1;var r=this.getCometCacheKey(e),i=storeWithExpiration.get(r);null==i&&(i=[]),i.push({date:t,etag:a,data:n,instanceID:chat.instanceID}),storeWithExpiration.set(r,i,6e4,!0)},getCometFromCache:function(e,t,a){if(store.disabled)return!1;t||(t=0),a||(a=0);var n=[],r=!1,i=!1;t=parseInt(t);var o=storeWithExpiration.get(this.getCometCacheKey(e));for(var s in o){var c=parseInt(o[s].date);if(null==t||c>t){r=o[s].etag,i=o[s].date;for(var l in o[s].data){if("string"==typeof o[s].data[l])try{o[s].data[l]=JSON.parse(o[s].data[l])}catch(e){}o[s].data[l]&&null!=o[s].data[l].action&&(o[s].data[l].fromCache=null==o[s].instanceID||o[s].instanceID!=chat.instanceID,n.push(o[s].data[l]))}}}return!!n.length&&{data:n,etag:r,date:i}},currentChannelDate:{},currentChannelEtag:{},callback:function(e,t,a,n,r,i){var o=chat.listen;if(null!=t)if(r||o.writeCometToCache(e,t,a,n),"main"==e){chat.siteParams.channelEtag=a,chat.siteParams.channelDate=t;var s=chat.siteParams.id+"::date",c=chat.siteParams.id+"::etag";(!r||supportStorage.get(s)<t||supportStorage.get(s)==t&&supportStorage.get(c)<a)&&(supportStorage.set(s,t),supportStorage.set(c,a),RPC.post("channelUpdate",{etag:a,date:t}))}else o.currentChannelDate[e]=t,o.currentChannelEtag[e]=a,r||(supportStorage.set(e+"::date",t),supportStorage.set(e+"::etag",a));for(var l=0;l<n.length;l++){var u={};if("string"==typeof n[l]&&n[l].length)var u=JSON.parse(n[l]);else if("object"==typeof n[l])var u=n[l];null!=u.action&&("function"!=i?o.receiveMessage(u):i(u))}},listentMainCacheInterval:null,listenMainCacheIntervalCallback:function(){},websocketAvailable:function(){return!chat.siteParams.mobile&&null!=window.WebSocket&&!storeWithExpiration.get("disallowWebsocket")},start:function(e){$this=this;chat.generateCode(10);if(!chat.siteParams)return setTimeout(function(){$this.start(e)},5);var t=this.websocketAvailable(),a=e.cid,n=e.once;e.callback;if(null==a&&(a="main"),"main"==a&&null==this.listenMainCacheInterval&&(this.listenMainCacheIntervalCallback=function(){var t=$this.getCometFromCache(a,chat.siteParams.channelDate,chat.siteParams.channelEtag);t&&$this.callback(a,t.date,t.etag,t.data,!0,e.callback)},this.listenMainCacheIntervalCallback(),this.listenMainCacheInterval=setInterval(this.listenMainCacheIntervalCallback,500)),"support"===chat.type&&(null==this.started[a]||!this.started[a])){if(this.started[a]=!0,null==n&&(n=!1),n||"main"!=a||RPC.post("listenStart",{}),"main"==a){if(t)var r="/WS_cometUserListen?cid="+encodeURIComponent(a)+"&org="+encodeURIComponent(chat.siteParams.orgID)+"&site="+encodeURIComponent(chat.siteParams.id)+"&talkid="+encodeURIComponent(chat.siteParams.talkID)+"&siteID="+encodeURIComponent(chat.siteParams.id);else var r="/cometUserListen?id=KJ8sa0",i={"X-Metalk-Org":chat.siteParams.orgID,"X-Metalk-Site":chat.siteParams.id,"X-Metalk-Talkid":chat.siteParams.talkID,"X-Who-Knows":a};var o=chat.siteParams.channelDate,s=chat.siteParams.channelEtag}else{if(t)var r="/WS_cometListen?cid="+encodeURIComponent(a);else var r="/cometListen?id=sau822j",i={"X-Who-Knows":a};if(null!=$this.currentChannelDate[a])var o=$this.currentChannelDate[a];else var o=supportStorage.get(a+"::date");if(null!=$this.currentChannelEtag[a])var s=$this.currentChannelEtag[a];else var s=supportStorage.get(a+"::etag")}o||(o=0),r+="&time="+encodeURIComponent(o),s||(s=0),r+="&tag="+encodeURIComponent(s);var c=t?4e3:3e4;$this.setListenNow(a,c,function(n){function l(){try{chat.listen.ws.close()}catch(e){}chat.listen.start({cid:"main"})}if(n)if(t){c=3e3;var u=setInterval(function(){chat.listen.setListenNow(a,c,null,!0)},c-1500),h="https:"==window.location.protocol?"wss":"ws";if("8088"==window.location.port)var d=":8088";else var d="";chat.listen.ws=new WebSocket(h+"://"+window.location.hostname+d+r),RPC.post("websocketStarted",{url:r}),chat.listen.ws.onmessage=function(t){if(storeWithExpiration.set("ws_works2",1,12e4,!0),"pong"===t.data)$this.pongTime=(new Date).getTime();else{var n=$.parseJSON(t.data),r=n.text;null==r[0]&&(r=[r]),$this.callback(a,n.time,n.tag,r,!1,e.callback)}},chat.listen.ws.onclose=function(){var t=parseInt(chat.rand(1e4,3e4));clearInterval(u),storeWithExpiration.get("ws_works2")||storeWithExpiration.set("disallowWebsocket",1,12e4),setTimeout(function(){$this.stop(a),$this.start(e)},t)},chat.listen.ws.onerror=function(e){chat.listen.ws.close(),clearInterval(u)},clearInterval($this.websocketPing),$this.websocketPing=setInterval(function(){chat.listen.ws&&1===chat.listen.ws.readyState?(chat.listen.pongTime=null,chat.listen.ws.send('{"action":"ping"}'),clearTimeout(chat.listen.waitingForPong),chat.listen.waitingForPong=setTimeout(function(){chat.listen.pongTime||(chat.log("no pong"),l())},5e3)):$this.websocketAvailable()&&chat.listen.ws&&1!==chat.listen.ws.readyState&&l(),1!==chat.listen.ws.readyState&&chat.listen.ws.close()},3e4)}else{var p={url:r,method:"GET",timeout:c,headers:i,dataType:"html"};RPC.post("longPollingStart",p),p.success=function(t,n,r){if($this.stop(a),null!=t&&t.length){t=t.split("\n");var i=[];for(var o in t)if(0==t[o].indexOf("[")){t[o]=$.parseJSON(t[o]);for(var s in t[o])i.push(t[o][s])}else i.push(t[o]);etag=r.getResponseHeader("Etag"),date=r.getResponseHeader("Last-Modified"),$this.callback(a,date,etag,i,!1,e.callback),e.once=!1}$this.stop(a),$this.start(e)},p.error=function(t,n,r){var i=parseInt(chat.rand(1e4,3e4));$this.setListenNow(a,i-500,null,!0),setTimeout(function(){$this.stop(a),$this.start(e)},i)},$.ajax(p)}else if(!$this.isMainListener()){$this.stop(a,!0);var f=500;if("main"!=a){var m=$this.getCometFromCache(a,o,s);m&&$this.callback(a,m.date,m.etag,m.data,!0,e.callback)}setTimeout(function(){$this.start(e)},f)}})}},receiveMessage:function(e){null!=e.action&&(null!=this.actions[e.action]?"support"!=chat.type&&"snippet"!=e.action||this.actions[e.action](e):chat.log(JSON.stringify(e)))},actions:{ajaxResponse:function(e){chat.nodeAjax.callback(e.callbackID,e.data)||chat.nodeAjax.notifyAboutCallback(e.callbackID,e.data)},setActionFilterValue:function(e){RPC.actions.setActionFilterValue(e)},geoip:function(e){if(e.geoip)for(var t=["city","country","region"],a=0;a<t.length;a++){var n=t[a];if(e.geoip[n]){var r=[];for(var i in e.geoip[n])r.push(e.geoip[n][i]);chat.actions.filters.set(n,r),r.length&&(null!=e.geoip[n][chat.siteParams.lang]?chat.actions.filters.set(n+"_lang",e.geoip[n][chat.siteParams.lang]):chat.actions.filters.set(n+"_lang",e.geoip[n].en))}}e.ip&&chat.actions.filters.set("ip",e.ip),e.cc&&chat.actions.filters.set("cc",e.cc)},showTab:function(e){chat.openSupport({focus:!1}),chat.tabs.showTab({id:e.tabID})},snippet:function(e){var t=$("a.snippet_"+e.id+".waitingForSnippet").removeClass("waitingForSnippet");if(t.length){var a="";if("image"==e.type){var n=$("<img />");n.attr("onload","reviews"==chat.type?"chat.rate.calculateSize();":"chat.messages.scrollBottom();"),n.attr("src",e.snipurl),a=$("<a></a>"),a.attr("target","_blank"),a.attr("href",t.attr("href")),a.html(n),a.attr("onclick","return chat.messages.clickOnLink(this);"),t.hide()}a.length&&t.after($("<div class='snippet "+e.type+"'></div>").html(a)),"support"==chat.type&&chat.messages.scrollBottom()}},disableWidget:function(){RPC.post("disableWidget",{}),window.location="about:blank"},browser:function(e){chat.browser.comet(e.data.action,e.data)},message:function(e){var t=function(){chat.messages.receive({dt:e.dt,text:e.text,operator:e.from,id:e.id,type:e.messageType,silent:e.silent,sound:!e.fromCache,deliveryReport:!e.fromCache,other:e.other,fromCache:!!e.fromCache,justAddToHistory:e.justAddToHistory})};null!=e.simulateTyping&&e.simulateTyping?(this.typing({operator:e.from,real:!1}),setTimeout(function(){t()},1e3*parseInt(e.simulateTyping))):t()},redrawHistoryTimeout:null,outgoingMessage:function(e){chat.disallowEcho||(e.from="client",chat.messages.history.add(e),chat.messages.show(e),clearTimeout(this.redrawHistoryTimeout),this.redrawHistoryTimeout=setTimeout(function(){var e=30;chat.messages.showHistory({last:e})},500))},addToHistory:function(e){e.justAddToHistory=!0,this.message(e)},updateInfoByOperator:function(e){e.userdata&&chat.client.update(e.userdata)},deleteMessage:function(e){e.id&&(chat.messages.history.remove(e.id),RPC.post("hideNewMessage",{}),chat.triggerBadge.decr(e.id))},selectOperator:function(e){chat.operators.balancer.disable(),chat.operators.setTalkWithOperator(e.operator),chat.operators.select({operator:e.operator,force:!0,remember:!0})},typing:function(e){null==e.real&&(e.real=!0),chat.messages.operatorTyping(e.operator,e.real)},trySimulateMessageForAskContacts:function(){setTimeout(function(){if(!chat.operatorAway.getActivity()){var e=!0;"online"==chat.chatMode?chat.operatorAway.start(e):chat.onlineSimulation.start()}},3e3)},requestRate:function(e){chat.siteParams.refuseSendRate=null,chat.messages.showRateNotification(!0),chat.openSupport()},removeAutoMessage:function(e){},operatorsOnlineUpdatedTimeout:null,operatorsOnlineUpdated:function(e){clearTimeout(this.operatorsOnlineUpdatedTimeout),this.operatorsOnlineUpdatedTimeout=setTimeout(function(){chat.operators.refresh(e.data)},2e3)},changeOperator:function(e){e.enableBalancer&&chat.operators.balancer.enable(),e.operator&&(chat.operators.setTalkWithOperator(e.operator),chat.operators.select({operator:e.operator,group:e.group}))},editMessage:function(e){var t=chat.messages.formatText(e.text,"operator");$("#text_"+chat.prepareIdForHtml(e.id)).html(t.text),chat.messages.history.edit(e.id,e.text)},setOperatorActivity:function(e){chat.operatorAway.setActivity()},setBan:function(e){RPC.post("setBan",{ban:e.ban?1:0})}}},getVisitsKey:function(){return"visits::"+chat.siteParams.id},getVisits:function(){var e=supportStorage.get(this.getVisitsKey());return e=e?parseInt(e):0},initVisitID:function(){var e=chat.generateCode(10);return supportStorage.set("visitID",e),e},incrVisits:function(){chat.actions.filters.set("visitStartTime"),chat.actions.filters.set("autoMessageToClientCountAtVisit",0),chat.actions.filters.set("messagesCountAtVisit",0),chat.actions.filters.set("pagesAtVisit",0),chat.actions.filters.set("clientMessagesCountAtVisit",0),chat.actions.filters.set("operatorMessagesCountAtVisit",0),this.initVisitID(),supportStorage.set(this.getVisitsKey(),chat.getVisits()+1)},getVisitedPagesCount:function(){var e=supportStorage.get("pages_"+chat.siteParams.id);return null==e?0:parseInt(e)},incrVisitedPagesCount:function(){supportStorage.set("pages_"+chat.siteParams.id,this.getVisitedPagesCount()+1)},lastReceiveMessageID:{key:function(){return chat.siteParams.id+"::"+chat.siteParams.talkID+"::last::messid"},get:function(){var e=supportStorage.get(this.key());return e||(e=chat.siteParams.talkIDFromSetup?1:0),parseInt(e)},set:function(e){supportStorage.set(this.key(),e)}},activity:{pageID:!1,setCurrentUrlFilter:function(e){var t,a;e=e?[e]:[chat.siteParams.currentUrl];var n=document.createElement("a");n.href=e[0];var r=n.host.split(":")[0];if(e.push(chat.siteParams.currentUrl.split(r).join(supportPunycode.ToUnicode(r))),!n.search)for(t=e.length,a=0;a<t;a++){var i=!1;i="/"===e[a].substr(-1,1)?e[a].substr(0,e[a].length-1):e[a]+"/",e.indexOf(i)===-1&&e.push(i)}var o=[n.pathname];for("/"===o[0].substr(-1,1)&&o.push(o[0].substr(0,o[0].length-1)),t=o.length,a=0;a<t;a++)0===o[a].indexOf("/")&&o.push(o[a].substr(1));for(t=o.length,a=0;a<t;a++)"/"!==o[a].substr(-1,1)&&o.push(o[a]+"/");for(a=0;a<o.length;a++)n.search&&(o[a]+=n.search),e.indexOf(o[a])===-1&&e.push(o[a]);for(a=0;a<e.length;a++)try{var s=decodeURI(e[a]);e.indexOf(s)===-1&&e.push(s)}catch(e){}for(a=0;a<e.length;a++)try{var c=encodeURI(decodeURI(e[a]));e[a]=c}catch(e){}chat.actions.filters.set("url",e),chat.actions.filters.set("lastLoadURL",e)},start:function(e,t){var a=!this.pageID;this.pageID=chat.generateCode(20),chat.incrVisitedPagesCount(),chat.actions.listeners.disable(),chat.actions.run.clearRunAtThisPage(),chat.actions.filters.set("timeOnPage"),null==chat.actions.filters.get("testGroup")&&chat.actions.filters.set("testGroup",chat.rand(0,1).toFixed(0)),null==chat.actions.filters.get("isTargetClient")&&chat.actions.filters.set("isTargetClient","0");var n="desktop";if(chat.device.tablet()?n="tablet":chat.device.mobile()&&(n="mobile"),chat.actions.filters.set("device",n),chat.actions.filters.set("newMessageFromClient",null),chat.actions.filters.set("mouseLeavePage",null),chat.actions.filters.set("scrollPX",null),chat.actions.filters.set("scrollToElement",null),chat.actions.filters.set("clickOnElement",null),chat.actions.filters.set("scrollPercentage",null),chat.actions.filters.get("widgetState")||chat.actions.filters.set("widgetState","closed"),a&&chat.actions.filters.set("colOperatorsOnline",null),chat.actions.filters.set("searchKeyword",chat.searchKeyword.get()),chat.actions.filters.set("previousUrl",chat.actions.filters.get("lastLoadURL")),chat.siteParams.currentUrlParsed&&chat.siteParams.currentUrlParsed.queryStringParams){var r=chat.siteParams.currentUrlParsed.queryStringParams,i=["utm_source","utm_medium","utm_campaign","utm_term","utm_content","utm_referrer"];r.gclid&&(r.utm_source="google",r.utm_medium="cpc"),r.fbclid&&(r.utm_source="facebook"),(r.yclid||r.ymclid)&&(r.utm_source="yandex",r.utm_medium="cpc");for(var o=0;o<i.length;o++){var s=i[o];r[s]&&chat.actions.filters.set(s,r[s])}}this.setCurrentUrlFilter(),chat.actions.filters.set("referer",chat.siteParams.referrer),chat.actions.filters.set("currentPageTitle",chat.siteParams.currentTitle),chat.actions.filters.set("pageVisited",chat.getVisitedPagesCount()),chat.actions.filters.set("visits",chat.getVisits()),chat.actions.filters.incr("pagesAtVisit"),chat.actions.listeners.enable();var c=!chat.actions.filters.get("city",!1)&&!chat.actions.filters.get("country",!1)&&!chat.actions.filters.get("region",!1)||!chat.actions.filters.get("cc",!1),l=chat.siteParams.windowSize,u=chat.getHeaders("startActivity",{lastMessageID:chat.lastReceiveMessageID.get(),geoip:c?1:0,device:n,wW:l.width,wH:l.height,ga:chat.siteParams.ga,ya:chat.siteParams.yaParams,now:(new Date).toMysqlFormat()});if(chat.isLiteModeEnabled())null!=e&&e();else{var h="/writeMetalkQueue";chat.nodeAjax.send({url:h,method:"GET",headers:u},function(t){RPC.actions.updateActivityAction(),null!=e&&e()})}},close:function(){},update:function(){}},operators:{online:[],current:!1,currentGroup:!1,changeDialog:!1,firstTime:!0,isInited:function(){return!this.firstTime},getCurrent:function(){return this.current},getCurrentGroup:function(){return this.currentGroup},getOnlineList:function(){return this.online},get:function(e){if(null!=e)var t=chat.siteParams.operators[e];else var t=chat.siteParams.operators;return null==t&&(t=!1),t},getBalancedOperator:function(e,t){chat.onReady(function(){chat.api("getBalancedOperator",e,t)})},getOperatorsOfGroup:function(e){var t=this.get(),a=[];for(var n in t)t[n].groupID&&t[n].groupID.indexOf(e)>-1&&a.push(t[n]);return a},getGroup:function(e){return chat.siteParams.operatorsGroups[e]},getVisibleGroups:function(){var e=[];for(var t in chat.siteParams.operatorsGroups)if(t){var a=this.getGroup(t);a&&!a.hidden&&e.push(a.id)}return e},canViewOperator:function(e,t){if(null!=this.getTalkWithOperator(e))return!0;var a=this.get(e);if(!t&&a.tempHidden)return!1;var n=a.groupID;if(n)for(var r=0;r<n.length;r++){var i=this.getGroup(n[r]);if(i&&i.hidden)return!1}return!a.hiddenOnThisPage},isOnlineAndVisible:function(e){return this.isOnline(e)&&this.canViewOperator(e)},getTalkWithOperator:function(e){return storeWithExpiration.get("canTalkWith::"+e)},setTalkWithOperator:function(e,t){null==t&&(t=!0),"online"==chat.chatMode&&(t&&this.setRememberOperator(e),storeWithExpiration.set("canTalkWith::"+e,1,1e3*parseInt(chat.siteParams.params.siteChatOptions.canViewInvisibleOperatorTTL)),this.lastRefreshData[e]=1,this.refreshWithLastData())},lastRefreshData:{},isOnline:function(e){var t=this.get(e);return!!t&&t.online},setOffline:function(e){chat.siteParams.operators[e]&&(chat.siteParams.operators[e].online=!1)},setOnline:function(e){chat.siteParams.operators[e]&&(chat.siteParams.operators[e].online=!0)},setTempHidden:function(e,t){chat.siteParams.operators[e]&&(chat.siteParams.operators[e].tempHidden=t)},hideAll:function(){var e=[];for(var t in chat.siteParams.operators)e.push(t);e.length&&chat.actions.run.types.hideOperator({operator:e})},getOperatorDisplayParams:function(e){var t=chat.operators.get(e);t||(t={}),t.avatar||(t.avatar=chat.defaultAvatar);var a=chat.staticDomain+t.avatar;return{username:e,avatar:a,name:t.fio}},offlineModeIfOperatorNotExists:!1,refreshWithLastDataTimeout:null,refreshWithLastData:function(){var e=this;this.firstTime?(clearTimeout(this.refreshWithLastDataTimeout),this.refreshWithLastDataTimeout=setTimeout(function(){e.refreshWithLastData()},100)):this.refresh(this.lastRefreshData)},refresh:function(e){this.firstTime=!1;this.current;if(this.online=[],"string"==typeof e&&(e=e.split("\n"),e=null!=e[2]?JSON.parse(e[2]):null),chat.operatorAway.away||null==e)chat.showOfflineSupport(),RPC.post("listenOperatorsStatus",{online:this.online});else{var t=this.get();for(username in t)this.setOffline(username);this.lastRefreshData=JSON.parse(JSON.stringify(e));for(username in e){var a=parseInt(e[username]);this.offlineModeIfOperatorNotExists&&this.offlineModeIfOperatorNotExists.indexOf(username)==-1&&(e[username]=0),1!=a||this.canViewOperator(username,!0)||(e[username]=a=-1),a==-1?this.setTempHidden(username,1):this.setTempHidden(username,0),this.canViewOperator(username)||(e[username]=!1)}var n=!1;for(username in e)if(e[username]){n=!0;break}n?chat.showOnlineSupport():chat.showOfflineSupport();for(username in e){var r=this.get(username);if(r){var a=parseInt(e[username]);1==a?(this.setOnline(username),chat.operators.canViewOperator(username)&&this.online.push(username)):a==-1?(this.setOnline(username),chat.operators.canViewOperator(username)&&this.online.push(username)):0==a&&(this.setOffline(username),this.current==username&&"online"==chat.chatMode&&this.setCurrent(!1,!1))}}chat.actions.filters.set("colOperatorsOnline",this.online.length);var i=JSON.parse(JSON.stringify(this.online));i.push(""),chat.actions.filters.set("operatorOnline",i);var o=this.getRememberOperator();this.current!=o.operator&&this.isOnline(o.operator)&&this.select({operator:o.operator,group:o.group}),RPC.post("listenOperatorsStatus",{online:this.online}),$(".operatorsGroup").addClass("none");for(username in t){var s=$(".operators").find(".operator_"+username.replace(/\W/g,"_"));this.isOnline(username)?(s.show(),s.parent().parent(".operatorsGroup").removeClass("none")):s.hide()}if(this.detectLastGroup(),!this.current||!this.get(this.current)||!this.isOnline(this.current)){if(!this.online.length)return chat.showOfflineSupport();var c=chat.siteParams.defaultOperator;if(!this.current&&chat.siteParams.params.operators.allowChange&&$(".operatorsGroup:not(.none)").length>1&&chat.operators.change(),c&&this.get(c)&&this.isOnline(c))this.select({operator:c,force:!1,remember:!1}),this.closeChangeDialog();else{var l=Math.floor(Math.random()*this.online.length);this.select({operator:this.online[l],force:!1,remember:!1})}}var u=$(".changeOperator");this.online.length>1&&chat.siteParams.params.operators.allowChange?u.removeClass("none"):u.addClass("none")}},init:function(){var e=this;chat.siteParams.operatorsGroups[!1]={id:!1,descr:"Другие консультанты",hidden:0};var t=0;for(groupID in chat.siteParams.operatorsGroups){t++;var a=chat.operators.getGroup(groupID);a.operators=[];var n=e.get();for(username in n){var r=e.get(username);(a.id&&r.groupID&&r.groupID.indexOf(a.id)!=-1||!a.id&&!r.groupID)&&a.operators.push(r)}}t&&(chat.siteParams.operatorsGroups[!1].descr="Online");var i=$(".operators");i.append("<table style='height:100%; width:100%;' cellpadding='0' cellspacing='0'><tr><td style='height:1px;'><div class='mb15 operatorsGroupSelectTitle'></div></td></tr><tr><td class='relative'><div class='operatorsInner' style='overflow:auto; position:absolute; top:0; left:0; right:0;'></div></td></tr></table>");var o=i.find(".operatorsInner"),s=i.find(".operatorsGroupSelectTitle");t>1?s.text("Выберите отдел, к которому Вы хотите обратиться:"):s.text("Выберите оператора, к которому Вы хотите обратиться:"),chat.windowResizeFunctions.push(function(){o.height(o.parent().height())});for(groupID in chat.siteParams.operatorsGroups)!function(){var a=chat.operators.getGroup(groupID);if(a.operators.length){var n=$("<div></div>").attr("class","operatorsGroup ha").attr("data-id",a.id);if(t>2){$("<div></div>").attr("class","groupTitle operator").css({margin:0,padding:"1em .5em"}).html("<span style='margin-right: .3em;' class='icon icon-caret-right'></span> ").append($("<span></span>").text(a.descr)).bind("click",function(){var e=$(this).parent().find(".operatorsOfGroup").find(".operator");e=chat.shuffle(e);for(var t=0;t<e.length;t++){var a=$(e[t]);if(a.attr("operator")===chat.operators.getCurrent())return void a.click()}for(var t=0;t<e.length;t++){var a=$(e[t]);if("none"!==a.css("display")){a.click();break}}}).appendTo(n)}else n.addClass("opened");var r=$("<div></div>").attr("class","operatorsOfGroup").appendTo(n);for(i in a.operators){var i=a.operators[i].username,s=$("<div />").attr("operator",i).attr("class","operator_"+i.replace(/\W/g,"_")).bind("click",function(){if(chat.operators.changeDialog){chat.operators.currentGroup=a.id;var e=chat.siteParams.params.operators.balance.type;chat.operators.select({operator:$(this).attr("operator"),group:a.id}),"smart"!=e||a.id?"all"==e&&a.id&&chat.operators.balancer.isEnabled(function(e){e&&$(".operatorNameString","#currentOperatorDiv").html(a.descr)}):chat.operators.balancer.disable()}}).addClass("operator");if(e.get(i).avatar)var c=e.get(i).avatar;else var c=chat.defaultAvatar;var l=($("<img />").addClass("avatar delayed-src").attr("delayed-src",chat.staticDomain+c).appendTo(s),$("<div />").html("<div class='operatorNameString'>"+e.get(i).fio+"</div>").addClass("operatorNameDisplay").appendTo(s),$("<div />").addClass("operatorStatus").html("<span class='operatorStatusDescr'>Online</span><span class='changeOperator none'>, </span>").appendTo(s));$("<a />").html("сменить оператора").addClass("ajax").attr("onclick","chat.operators.change()").appendTo(l.find(".changeOperator"));s.appendTo(r)}n.appendTo(o)}}()},closeChangeDialog:function(){this.changeDialog=!1,$b.removeClass("changeOperatorOpened");var e=$(".operatorDiv");if(e.not(":visible")&&($(".operators").hide(),e.show(),0==$(".askForContacts:visible").length)){$(".onlineSupportChatArea,.me-talk-copyright-chat").show();var t=$("#chatTextarea").data("resize");null!=t&&t()}},balancer:{disabled:!1,params:function(){return chat.siteParams.params.operators.balance},cookie:function(){return"s_b_d"},disable:function(){if("smart"==this.params().type||"all"==this.params().type){var e=new Date;this.disabled=!0,e.setTime(e.getTime()+36e5);var t=e.toGMTString();chat.cookie.set(this.cookie(),1,t),chat.operators.select({operator:chat.operators.current})}},enable:function(){this.disabled=!1;var e=new Date;e.setTime(e.getTime()-36e5);var t=e.toGMTString();chat.cookie.set(this.cookie(),null,t)},isEnabled:function(e){var t=!(chat.siteParams.free||"smart"!=this.params().type&&"all"!=this.params().type||this.disabled);t?chat.cookie.get(this.cookie(),function(t){e(!t)}):e(!1)}},setCurrentOperator:function(e){this.current=e},setCurrent:function(e,t){if(this.setCurrentOperator(e),!t){var a=this.getCurrentGroup();t=this.getOperatorGroup(e,a)}this.currentGroup=t},getOperatorGroup:function(e,t){var a=chat.siteParams.operators[e];if(a){var n=a.groupID;if(n)return t&&n.indexOf(t)>-1?t:n[0]}return!1},select:function(e){var t=this;null==e&&(e={});var a={operator:"",force:!1,remember:!0,group:!1};if($.extend(a,e),a.operator){var t=this;if(t.isOnline(a.operator)||a.force){if(t.current&&t.operatorWasChanged(t.current,a.operator),!a.group){var n=this.getCurrentGroup();a.group=this.getOperatorGroup(a.operator,n)}if(a.group&&chat.operators.getGroup(a.group))var r=chat.operators.getGroup(a.group).descr;else var r="Online";a.remember?t.setCurrent(a.operator,a.group):t.setCurrentOperator(a.operator),t.balancer.isEnabled(function(e){$(".operatorDiv").empty();var n="operator_"+a.operator.replace(/\W/g,"_"),i=$("."+n).first().clone().attr("id","currentOperatorDiv").removeClass(n);if(e){i.find(".operatorNameString").html(t.balancer.params().smart.descr);var o=t.balancer.params().smart.avatar;o||(o=chat.defaultAvatar),o=chat.staticDomain+o;var s=i.find(".avatar");s.attr("src")?s.attr("src",o):s.attr("delayed-src",o),i.removeAttr("operator")}else i.find(".operatorStatusDescr").html(r);i.appendTo(".operatorDiv").unbind("click").show(),t.isOnline(a.operator)&&chat.showOnlineSupport(),a.remember&&(t.setRememberOperator(a.operator,a.group),t.closeChangeDialog());var c=$(".onlineChatTextarea").find(".upload");parseInt(t.get(a.operator).canReceiveLinks)>0?c.myShow():c.myHide(),chat.operators.avatarUpdated()})}}},avatarUpdated:function(){var e=!1;if(chat.onlineChatDisplayed()){var t=$("#currentOperatorDiv").find(".avatar"),e=t.attr("src");if(e||(e=t.attr("delayed-src")),e){var a=document.createElement("a");a.href=e,e=a.href}}RPC.post("setCurrentOperatorAvatar",{avatar:e}),chat.loadDelayedSrc()},getRememberOperator:function(){return{operator:chat.siteParams.operator,group:chat.siteParams.group}},setRememberOperator:function(e,t){if(!t){var a=this.getCurrentGroup();t=this.getOperatorGroup(e,a)}chat.siteParams.operator=e,chat.siteParams.group=t,RPC.post("selectOperator",{operator:e,group:t})},detectLastGroup:function(){},change:function(){var e=this;chat.notifications.close(),$b.addClass("changeOperatorOpened"),$(".operatorDiv, .onlineSupportChatArea, .askForContacts, .me-talk-copyright-chat").hide(),$(".operators").css({display:"block"}),e.detectLastGroup(),this.changeDialog=!0,chat.windowResize()},operatorWasChanged:function(e,t){}},drawCollectContactsForms:function(){var e=chat.siteParams.params.clientDataKeys;$.each($(".contacts_place:not(.ready)"),function(){var t=$(this),a=t.addClass("ready"),n=$("<form onSubmit='return false;'></form>").bind("click",function(){$(this).addClass("clickedOnce")});a.before(n);var r=t.data("collectContacts"),i=t.data("class"),o=i,s=t.data("button"),c=t.data("button-click"),l=t.data("type");if(r&&i){i+=" collectContactField","form"==l&&(i+=" disallowAutoFill");for(var u in r){var h=r[u],d=e[u];if(d&&"0"!=h){var p=$("<div class='inputContainer contacts'></div>");d.icon&&["text","select"].indexOf(d.type)>-1&&p.append('<span class="icon '+d.icon+'"></span>');var f=d.placeholder?d.placeholder:d.descr;if("textarea"==d.type)var m=$("<textarea name='"+u+"' class='customTextarea "+i+"'></textarea>").attr("placeholder",f);else if("select"==d.type){var m=$("<select class='"+i+"' name='"+u+"'></select>"),g=$("<option value=''></option>").text(f);g.appendTo(m);for(var v in d.values){var g=$("<option></option>").text(d.values[v].value).attr("value",d.values[v].value);parseInt(d.values[v].selected)&&g.attr("selected","selected"),g.appendTo(m)}m.bind("change",function(){var e=$(this);""==e.val()?e.addClass("notFilled"):e.removeClass("notFilled")}).change()}else if("date"==d.type){var m=$("<div class='"+d.type+"Field'></div>");m.append($("<div class='fieldTitle'></div>").html(f));for(var y=$("<span class='input-group'></span>"),b="<select class='"+i+"' name='"+u+"_day'><option value='00'>День</option>",v=1;v<=31;v++){var w=v;w<10&&(w="0"+v),b+="<option value='"+w+"'>"+w+"</option>"}b+="</select>",b=$(b),y.append(b);var C="<select class='"+i+"' name='"+u+"_month'><option value='00'>Месяц</option>",T=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"];for(var v in T){var w=parseInt(v)+1;w<10&&(w="0"+w),C+="<option value='"+w+"'>"+T[v]+"</option>"}C+="</select>",C=$(C),y.append(C);for(var k="<select class='"+i+"' name='"+u+"_year'><option value='0000'>Год</option>",x=(new Date).getUTCFullYear()+1,v=x;v>=x-100;v--)k+="<option value='"+v+"'>"+v+"</option>";k+="</select>",k=$(k),y.append(k);var S=$("<input type='hidden' name='"+u+"' class='"+i+"' />");m.append(S),function(e,t,a,n,r){$(e).find("select").bind("change click",function(){r.val(t.val()+"."+a.val()+"."+n.val())}).change()}(y,b,C,k,S),y.appendTo(m)}else if("file"==d.type){var m=$("<div class='"+d.type+"Field'></div>");m.append($("<div class='fieldTitle'></div>").html(f)),m.append($("<label><input type='file' class='"+i+"' name='"+u+"_fileInput' /></label>")),
m.append("<input type='hidden' class='"+i+"' name='"+u+"' />"),function(e,t){$.form.makeUpload($(t).find("input[type=file]"),{name:e+"_fileInput",autoLoad:!0,form:o,onComplete:function(a){t.parent().parent().find("iframe")[0];$.post("/LAPI/misc/fileShare.php?action=getLastUpload",{},function(t){if(t.length){t=JSON.parse(t);var a=[];if(t.multiple)for(var n=0;n<t.multiple.length;n++){var r=t.multiple[n];a.push(r.filename+" ("+$.form.fsize(r.size)+") - "+r.fullURL)}a.length?$.form.set(o,e,a.join("\n")):chat.alert.show({code:0,descr:"Файл не передан"})}},"html")},progress:!1,upload:"https://static.me-talk.ru/LAPI/misc/fileShare.php?action=upload&org="+chat.siteParams.orgID})}(u,m)}else if("checkbox"==d.type||"radio"==d.type){var m=$("<div class='"+d.type+"Field'></div>");m.append($("<div class='fieldTitle'></div>").html(f));for(var v in d.values){var P=$("<label class='fieldValue'></label>"),I=$("<input name='"+d.name+"' class='"+i+"' type='"+d.type+"' />");I.attr("value",d.values[v].value),parseInt(d.values[v].selected)&&I.attr("checked","checked"),P.append(I),P.append(" "+d.values[v].value),P.appendTo(m)}}else var D="phone"===u?"tel":"text",m=$("<input class='text "+i+"' name='"+u+"' type='"+D+"' />").attr("placeholder",f);if(p.append(m),2==h&&p.addClass("must-be-filled"),p.addClass("type-"+d.type),n.append(p),"textarea"==d.type&&1==parseInt(d.upload)){var O="Загрузить файл",M='<span class="uploadIcon pointer icon-paperclip" onClick="chat.showUploadFile(\''+o+"','"+u+'\');" title="'+O+'"></span>';m.after(M)}}}if($(this).data("drawCaptcha")&&2==parseInt(r.captcha)&&chat.captcha.append(n,i),s&&(n.append(chat.eulaString(s,o)),n.append("<div class='alert-form'><div class='none'><div class='alert-text'></div></div></div>"),n.append("<div><button class='b'>"+s+"</button></div>"),c)){var A=n.find("button");"string"==typeof c?A.attr("onClick",c):A.bind("click",c)}}}),chat.phoneMask.load()},eulaString:function(e,t){if(parseInt(chat.siteParams.params.siteChatOptions.rknShow)&&("ru"==chat.siteParams.lang||chat.actions.filters.check("country","=",["Russia"]))){var a="<a class='nobr linkEula'  onClick='chat.tabs.eula();'>";return $.form.str_replace(["[button]","[a]","[/a]"],[e,a,"</a>"],"<div class='fs11' style='line-height:1.2em;'><label><input style='width:auto;' type='checkbox' class='"+t+"' name='eulaAgreement' value='1' /><input type='hidden' class='"+t+"' name='needEulaAgreement' value='1' />Я соглашаюсь с [a]правилами пользования сервисом[/a] и даю согласие на хранение и обработку моих персональных данных.</label></div>")}},tabs:{eula:function(){"support"==chat.type?chat.tabs.showTab({id:"eula"}):RPC.post("showTab",{id:"eula"})},ajaxTabDrawed:{},ajaxTab:function(e,t,a){if(this.ajaxTabDrawed[e])chat.tabs.showTab({id:e});else{this.ajaxTabDrawed[e]=!0;var n={id:e,title:t,type:"html",content:{html:"",link:a},visible:1};chat.siteParams.tabs.push(n),this.drawTab(n),chat.initMinSize(),chat.tabs.showTab({id:e})}},scrollable:{init:!1,timeout:null,check:function(){var e=this;clearTimeout(this.timeout),this.timeout=setTimeout(function(){var t=$("ul.supportTabs"),a=$(".supportMenu");if(t.length){var n=0,r=0;$.each(t.children(":visible"),function(){r+=$(this).outerWidth()}),a.is(".scrollable")&&(n+=2*$(".scrollTabsBtnLeft").outerWidth());var i=r>t.outerWidth()+n;i?(a.addClass("scrollable"),this.init||(this.init=!0,$(".scrollTabsBtnLeft").unbind("click touchend").bind("click touchend",function(){e.update(-1)}),$(".scrollTabsBtnRight").unbind("click touchend").bind("click touchend",function(){e.update(1)}),e.update(0))):a.removeClass("scrollable")}},100)},update:function(e){var t=$("ul.supportTabs"),a=$(".scrollTabsBtnLeft"),n=$(".scrollTabsBtnRight"),r="disabled";t.length&&t.animate({scrollLeft:t.scrollLeft()+$(".supportMenu").width()/2*e},200,function(){var e=t.scrollLeft();0==e?a.addClass(r):a.removeClass(r),e>=t[0].scrollWidth-t.width()-2?n.addClass(r):n.removeClass(r)})}},inited:!1,list:{},openByType:function(e){null!=this.list[e]&&this.open(this.list[e][0])},currentType:!1,getTabParams:function(e){for(var t=null,a=0;a<chat.siteParams.tabs.length;a++)chat.siteParams.tabs[a].id==e&&(t=chat.siteParams.tabs[a]);return t},showTab:function(e){if(e&&e.id){var t=this.getTabParams(e.id);if(t){var a=$("li.tab_"+e.id),n=$(a.data("div")),r=n.children(".tabInner");if("payment"==t.type){var i=JSON.parse(JSON.stringify(t));if(e.paymentSum&&(i.content.sumFixed=parseFloat(e.paymentSum.toString().split(" ").join("")),i.content.sumType="fixed"),r.html($("#paymentTab .tabInner").html()),chat.payment.draw(n,i),e.paymentComment){var o=$("<input />").attr("type","hidden").attr("name","paymentComment").attr("class","form_"+e.id);$(".paymentComment").myShow().html(e.paymentComment).append(o)}else $(".paymentComment").myHide()}else"html"==t.type&&t.content.link&&!t.content.loaded&&(r.html('<div class="c" style="position: absolute; top: 50%; bottom: 0px; left: 0px; right: 0px; margin-top: -.5em;"><span class="icon-spin icon-circle-o-notch" style="font-size:30px;"></span></div>'),$.post(t.content.link,function(e){r.html(e)},"html"),t.content.loaded=!0);if("payment"==t.type||"form"==t.type)for(var s in e)$(".form_"+e.id+"[name='"+s+"']:not([readonly])").length&&$.form.set("form_"+e.id,s,e[s]);this.open("tab_"+e.id)}}},hideCurrentInvisibleTab:function(){var e=$("li.invisibleTab.current");e.length&&this.setTabVisible(e.data("id"),0)},setTabVisible:function(e,t){var a=$("ul.supportTabs li.tab_"+e);if(a.length){var n=a.hasClass("none")==t;if(n&&(t?a.removeClass("none"):a.addClass("none"),chat.initMinSize(),!t&&a.is(".current"))){var r=$("ul.supportTabs li:not(.none)").first();r.length&&this.open(r)}}},open:function(e){if("object"==typeof e)var t=e;else var t=$("ul.supportTabs li."+e.split(" ").join("."));if(t.length){this.setTabVisible(t.data("id"),1);var a=t.data("type");this.currentType=a,"reviews"==a&&chat.rate.drawTab(),t.parent("ul").children(".current").removeClass("current"),t.addClass("current"),$("div.supportTabs div.current").removeClass("current");var n=t.data("div").addClass("current");chat.windowResize(),chat.fixFeedbackFormHeight(),n.find("input[placeholder],textarea[placeholder]").placeholder(),chat.resizeFeedbackTables(),chat.messages.updatePaddings(),$("input:visible,textarea:visible").blur(),"chat"==a&&$(".onlineSupportChatArea .chat").scrollTop(1e6)}chat.loadDelayedSrc(),chat.phoneMask.load(),chat.captcha.fix()},loadClientFeedbackInfo:function(e){var t=this;chat.client.updated?null!=e&&e(chat.client):chat.api("getClientFeedbackInfo",{},function(a){1!=a.code&&(a={}),t.loadClientFeedbackInfoCallback(a),null!=e&&e(chat.client)});var a=chat.siteParams.params.leadGen.questionCategories;if(a.ask&&a.list.length){for(var n=$("select[name=questionCategory]").html('<option disabled selected value="">Укажите категорию вопроса</option>'),r=(chat.operators.getCurrentGroup(),null),i=0;i<a.list.length;i++){var o=a.list[i];if(!r||r.indexOf(o)>-1){var s=$("<option />").html(o).attr("value",o);s.appendTo(n)}}n.children().length>1&&$("div.questionCategory").show()}},loadClientFeedbackInfoCallback:function(e){chat.client.update(e),null!=e.haveNoAnswer&&0==parseInt(e.haveNoAnswer)&&chat.onlineSimulation.resetStoreKey()},clientInfoKey:function(e){return chat.siteParams.id+"::"+chat.siteParams.talkID+"::clientInfo"},getClientInfoCache:function(){return supportStorage.get(this.clientInfoKey())},insertClientFeedbackInfo:function(){var e=chat.client.get("descr");e||(e=""),$.each($(".collectContactField:not(.disallowAutoFill)"),function(){var e=$(this),t=e.attr("type"),a=e.attr("name"),n=chat.client.get(a);if(n)if("checkbox"==t||"radio"==t){"undefined"==typeof n.indexOf&&(n=n.toString());var r=n.indexOf(e.attr("value"))>=0;r?e.attr("checked",!0):"checkbox"==t&&e.removeAttr("checked")}else e.val(n).change()}),$(".offlinePmLoading").hide();var t=".offlinePmMetalk";"html"==chat.siteParams.params.leadGen.mode&&$(t).html(chat.prepareHTML(chat.siteParams.params.leadGen.yourOfflineHTML)),$(t).removeClass("none"),chat.loadDelayedSrc(),chat.fixFeedbackFormHeight()},drawPmUserHTML:function(e){if(e.length&&"html"!=chat.siteParams.params.leadGen.mode){e=$("<div></div>").html(e).html(),e=e.split("%html%").join("");var t="message pmFormUserHTML",a=e.indexOf("%block%")>-1;a?e=e.split("%block%").join(""):t+=" from_operator";var n=$(".pmFormUserHTML").removeClass("none").html(e);"classic"!=chat.siteParams.style&&(n.attr("class",t).children("div").addClass("text first"),$(".askForContactsInfo").addClass("message from_operator")),chat.fixFeedbackFormHeight()}},drawTab:function(e){var t=$("ul.supportTabs");e.visible=parseInt(e.visible);var a=t.children(":not(.invisibleTab)").length;if(e.visible)var n="tab"+a;else var n="tab_"+e.id;var r=e.type,i=e.id;null==this.list[r]&&(this.list[r]=[]),this.list[r].push(n);var o=null;if("chat"==r){o=chat.siteParams.params.leadGen.pmForm.text;var s=chat.siteParams.params.leadGen.pmForm.questionTextareaPlaceholder;$(".meTalkPM[name=text]").attr("placeholder",s);var c=chat.siteParams.params.leadGen.pmForm.upload;c||null==c||$(".meTalkPM.uploadIcon").remove()}else null!=e&&null!=e.content&&(o=e.content.html);if(null==o&&(o=""),o=chat.prepareHTML(o),null!=o&&o.length){for(var l in chat.siteParams.userDataParams)o=o.split("["+chat.siteParams.userDataParams[l].name+"]").join(chat.siteParams.userDataParams[l].value);o=$("<div />").append(o),o.find("a[href][target!=_blank]").attr("target","_parent"),e.content.html=o.html()}if("chat"==r){var u=$("#chatTab").attr("id",n);o.length||(o="<p>Оставьте свой вопрос в этой форме и мы обязательно ответим!</p>"),this.drawPmUserHTML(o),2==parseInt(chat.siteParams.params.leadGen.collectContacts.captcha)&&chat.captcha.append($("#leadgenCaptcha").myShow(),"meTalkPM")}else if("reviews"==r){var u=$("#reviewsTab").attr("id",n),h=!1;for(var d in chat.siteParams.params.rate.collectContacts){h=!0;break}if(h||$(".rateOperator.contacts").hide(),chat.siteParams.params.rate.askName?$(".rateOperator.name").show():$(".rateOperator.name").hide(),2==parseInt(chat.siteParams.params.rate.collectContacts.captcha)&&chat.captcha.append($("#reviewsCaptcha").myShow(),"rateOperator"),chat.form.drawUserHTML(u,e),5==chat.siteParams.params.rate.values){var p={5:"Ставлю оценку «Отлично»",4:"Ставлю оценку «Хорошо»",3:"Ставлю оценку «Нормально»",2:"Ставлю оценку «Плохо»",1:"Ставлю оценку «Очень плохо»"},f=$(".rateOperator[name=rate]").empty();for(var m in p)f.prepend('<option value="'+m+'/5">'+p[m]+"</option>");f.val(f.children(":first").attr("value"))}}else if("html"==r){var u=$("#htmlTab").clone().attr("id",n).appendTo("div.supportTabs");u.find(".tabInner").html(o)}else if("form"==r){var u=$("#formTab").clone().attr("id",n).appendTo("div.supportTabs");chat.form.draw(u,e)}else if("payment"==r){var u=$("#paymentTab").clone().attr("id",n).appendTo("div.supportTabs");chat.payment.draw(u,e)}var g=$("<div />").addClass("tabTitleInner");"chat"!=r?u.find(".tabTitle").html(g.html(e.title)):(g.html(chat.siteParams.params.leadGen.tabTitle),$(".tabTitleForOffline").html(g)),0==a&&e.visible&&(n+=" current",u.addClass("current"),this.currentType=r),e.visible||(n+=" none",u.addClass("hiddenTab")),1==parseInt(e.hideWhenOffline)&&(n+=" hideWhenOffline"),u.addClass("tab_"+e.id+" tab_"+r);var v=$("<li></li>").data("type",r).data("id",i).addClass(n);$("<a></a>").attr("class","a_"+r).html("<span class='descr'>"+e.title+"</span>").appendTo(v);if("chat"==r){$(".download-chat").attr("title","Отправить историю чата на Email").bind("mouseover",function(){var e=$(this),t=e.data("color");if(!t){var a=$("<span class='likeLink none'></span>").appendTo("body");t=a.css("color"),a.remove(),e.data("color",t)}e.attr("style","color:"+t)}).bind("mouseout",function(){$(this).removeAttr("style")}).bind("click",function(){var e=chat.client.get("email");e||(e="");var t=$("<button class='b'></button>").text("Отправить").bind("click",function(){var e=$(this);e.attr("disabled","disabled"),chat.api("exportChatForClient",{email:$(".download-chat[name=email]").val()},function(t){e.removeAttr("disabled"),1==t.code?(chat.alert.show(t),chat.client.get("email")||chat.client.update({email:t.email})):$(".download-chat-error").fadeIn().html(t.descr)})}),a=$("<div></div>").append($("<input type='text' name='email' class='text download-chat' />").css("width","100%").val(e).attr("placeholder","Укажите Ваш Email")).append("<div class='mt5 redText download-chat-error none'></div>").append(t);t.wrap("<div class='mt10 right'></div>"),chat.alert.show({hideOnClick:!1,title:"Выгрузить историю общения",descr:a})})}v.addClass("tab_"+i),v.data("div",u),v.appendTo(t),e.visible||v.addClass("invisibleTab")},draw:function(){if(!this.inited){this.inited=!0,$("#leadGenEula").html(chat.eulaString("Отправить","meTalkPM")),$.each($(".contacts_place"),function(){var e=$(this);e.data("class");e.data("collectContacts",chat.siteParams.params[e.data("params")].collectContacts)}),chat.siteParams.tabs.push({id:"eula",title:"Правила сервиса",type:"html",content:{html:"",link:"/support/eula.php?oid="+chat.siteParams.id+"&org="+chat.siteParams.orgID},visible:0});for(var e in chat.siteParams.tabs)this.drawTab(chat.siteParams.tabs[e]);var t=5;if(chat.messages.showHistory({last:t}),chat.messages.history.getIdList().length>t){var a='<a class="ajax" onClick="chat.messages.showHistory();">Загрузить</a> всю историю общения',n=$("<div class='userHTML c' />").html(a);$(".chatInner > .newNotification").after(n)}chat.drawCollectContactsForms()}}},rate:{refuseSendRate:function(){chat.siteParams.refuseSendRate=1,RPC.post("refuseSendRate",{})},count:0,list:[],page:0,limit:0,isTabDraw:!1,drawTab:function(){this.isTabDraw||($("#reviewsEula").html(chat.eulaString("Отправить отзыв","rateOperator")),parseInt(chat.siteParams.params.rate.loadInTab)?(this.isTabDraw=!0,$d.ready(function(){chat.siteParams.reviewsParams={paginationType:"expand",limit:10,pagination:1,autoWidth:0,description:0,displayNames:1,displayCity:0},chat.rate.load(0);var e=8;"classic"!=chat.siteParams.style&&(e=11),$("#reviewsContainerWrapper").css({overflow:"hidden"}).perfectScrollbar({includePadding:!0,suppressScrollX:!0,marginTop:e,minScrollbarLength:20})})):(this.hideCancelButton(),this.showForm(!0)))},cancelButtonHidden:!1,hideCancelButton:function(){this.cancelButtonHidden=!0,$("#hideReviewForm").hide()},showForm:function(e){var t=$("#reviewsList"),a=$("#reviewsForm");e?(t.hide(),a.show()):t.fadeOut(300,function(){var e=setInterval(function(){chat.fixFeedbackFormHeight()},50);a.fadeIn(300,function(){$d.ready(function(){chat.fixFeedbackFormHeight(),clearInterval(e)})})})},hideForm:function(){$("#reviewsForm").fadeOut(300,function(){$("#reviewsList").fadeIn(300,function(){})})},send:function(e){var t=this;e=$(e);var a=$.form.get("rateOperator",!1);return $(".allowSms:visible").length&&!a.allowSms?void chat.alert.show({code:1,descr:"Пожалуйста, подтвердите возможность отправки сообщений для Вас"}):(e.attr("disabled","disabled"),a.chatMode=chat.chatMode,a.operator=chat.operators.getCurrent(),chat.disableLiteMode(),void chat.api("sendRate",a,function(n){if(1!=n.code)e.removeAttr("disabled"),n.retry=function(){t.send(e)},chat.alert.show(n);else{if(chat.captcha.reset(),chat.client.update(n.info),"bad"==n.rate)var r=chat.siteParams.params.rate.afterRateMessage.bad;else var r=chat.siteParams.params.rate.afterRateMessage.good;chat.alert.show({code:1,descr:r}),RPC.post("rateSended",a),e.removeAttr("disabled"),$(".rateOperator[name=comment]").val(""),t.cancelButtonHidden||chat.rate.hideForm(),chat.sendEvent("Rate sent","Посетитель отправил отзыв")}}))},openReviewsTab:function(){RPC.actions.openReviewsTab(),RPC.post("openReviewsTab",{form:!0})},load:function(e){var t=this,a=JSON.parse(JSON.stringify(chat.siteParams.reviewsParams));a.page=e,t.page=e,t.fetchReviews(a,function(e){if(t.count=e.count,t.list=e.data,1==parseInt(a.description)&&0==t.page){if(t.count){var n=t.count,r=chat.getSclon(t.count,"отзыв","отзыва","отзывов");if(a.withReviewsDescription)var i=a.withReviewsDescription;else{var i="<p><span>Наши посетители оставили уже</span> <span class='reviewsCount'>{num}</span> {word}.</p>";i+="<p><span>Присоединяйтесь к ним</span>,  <a class='ajax' onClick='chat.rate.openReviewsTab(); return false;' href='#'>оставьте свой отзыв или пожелание</a>!</p>"}i=i.split("{num}").join(n).split("{word}").join(r)}else if(a.withoutReviewsDescription)var i=a.withoutReviewsDescription;else{var i=$("<div><p>Пока что наши посетители не оставили ни одного отзыва.</p></div>"),o=$("<p>Вы можете <a class='ajax' onClick='chat.rate.openReviewsTab(); return false;' href='#'>стать первым</a>!</p>");i.append(o)}$("#reviewsContainer").html("<div class='mb15'></div>").html(i)}0!=t.page||t.count||(chat.rate.hideCancelButton(),chat.rate.showForm()),t.draw()})},fetchReviews:function(e,t){var a=parseInt(e.page);(!a||isNaN(a)||a<0)&&(a=0);var n=parseInt(e.limit);(!n||isNaN(n)||n<0||n>50)&&(n=10);var r=this,i={"X-Metalk-Org":chat.siteParams.orgID};1==parseInt(e.allSites)||e.allSites===!0?i["X-Metalk-Siteid"]="all":i["X-Metalk-Siteid"]=chat.siteParams.id,i["X-Metalk-From"]=a*n,i["X-Metalk-To"]=i["X-Metalk-From"]+n-1,$.ajax({url:"/metalkLoadRates",headers:i,method:"GET",dataType:"html",success:function(e){r.count=0,r.list=[];var a=0,n=[];e=e.split("\n");for(key in e)0==key?(a=parseInt(e[key].substr(1)),isNaN(a)&&(a=0)):0==e[key].indexOf("{")&&n.push(JSON.parse(e[key]));t({count:a,data:n})}})},cutText:function(e,t){return e.length>t&&(e="<div>"+e.substring(0,t)+"... <a onClick='$(this).parentsUntil(\".review\").parent().css({height:\"auto\"}); $(this).parent().hide(); $(this).parent().next().show(); chat.rate.changeReviewsHeight();'>Читать далее</a></div><div class='none'>"+e+"</div>"),e},draw:function(){$("#reviewsLoading").remove(),"classic"==chat.siteParams.reviewsParams.paginationType&&$(".review").remove();var e=this,t="",a=chat.messages.timeOffset(),n=chat.siteParams.reviewsParams.maxLength,r=1==parseInt(chat.siteParams.reviewsParams.displayNames),i=1==parseInt(chat.siteParams.reviewsParams.displayCity);for(key in e.list){var o=e.list[key].rate,s=!1;if("good"==o)var c="greenAjax";else if("bad"==o)var c="redAjax";else if(s=o.split("/").join(" <span>из</span> "),o=o.split("/"),2==o.length)if(o=o[0]/o[1],o>.5)var c="greenAjax";else var c="redAjax";var l=e.list[key].comment.split("\n").join("").split("<br />").join("\n");l=$("<div />").text(l).html();var u=e.list[key].adminComment;if(null==u&&(u=""),u=$("<div />").text(u.split("\n").join("").split("<br />").join("\n")).html(),n>0&&(l=e.cutText(l,n),u=e.cutText(u,n)),l=chat.messages.linkify(l).split("\n").join("<br />"),u=chat.messages.linkify(u).split("\n").join("<br />"),l=emojione.unicodeToImage(l),r&&null!=e.list[key].descr&&e.list[key].descr)var h=e.list[key].descr.split(", 8000")[0].split("@")[0]+" ";else var h=!1;var d=chat.messages.dateFromString(e.list[key].dt);d.setHours(d.getHours()+a),d=chat.messages.formatDate(d,!0),t+="<div class='review ajax "+c+"'><div class='inner'>",t+="<div class='reviewAuthor'><div>";var p="date";if(h?t+="<span class='name'>"+h+"</span>":(p+=" withoutName",d=d),t+="<span class='"+p+"'>"+d+"</span></div>",i){var f=!1;null!=e.list[key].city&&e.list[key].city?f="<span>г.</span> "+e.list[key].city:null!=e.list[key].country&&e.list[key].country&&(f=e.list[key].country),f&&(t+="<div><span class='city'>"+f+"</span></div>")}t+="</div>",t+="<div class='text'>"+l,s&&(t+="<div class='mt10'><span>Оценка</span>: "+s+"</div>"),null!=u&&u.length&&(t+="<div class='mt15 adminAnswer'><div class='bold mb5 adminAnswerTitle'>"+chat.siteParams.params.rate.adminCommentTitle+"</div><div class='adminAnswerText'>"+u+"</div></div>"),t+="</div></div></div>"}if(t+="<div class='clear delimiter'></div>",1==chat.siteParams.reviewsParams.pagination){t+="<div class='c rateButtons mt15'>","classic"==chat.siteParams.reviewsParams.paginationType&&e.page&&(t+="<button onClick='$(this).parent().fadeOut(); chat.rate.load("+(e.page-1)+")'><span class=''>← Назад</span></button> ");var m=$("#reviewsInChatExpand");e.count>e.limit*(e.page+1)?"expand"==chat.siteParams.reviewsParams.paginationType?m.length?m.unbind("click").bind("click",function(){$(this).fadeIn(),chat.rate.load(e.page+1)}):t+="<button id='reviewsExpand' onClick='$(this).parent().fadeOut(); chat.rate.load("+(e.page+1)+")'>Загрузить ещё</button>":t+=" <button onClick='$(this).parent().fadeOut(); chat.rate.load("+(e.page+1)+")'><span>Вперёд →</span></button>":m.remove(),t+="</div>"}$("#reviewsContainer > .delimiter").remove(),$("#reviewsContainer").append(t);var g=$("#reviewsContainerWrapper").scrollTop();g&&$("#reviewsContainerWrapper").animate({scrollTop:$("#reviewsContainerWrapper").scrollTop()+$("#reviewsContainerWrapper").height()}),$(".review.last").removeClass("last"),$(".review:last").addClass("last"),e.calculateSize(),$(".review").animate({opacity:1},200)},calculateSize:function(){if($(".review").css({width:"auto",height:"auto"}),1==chat.siteParams.reviewsParams.autoWidth){var e=[],t=$(".review:first").position();if(null!=t){var a=t.top,n=$("#reviewsContainer").width(),r=17,i=210+r,o=Math.floor(n/i),s=n-i*o;i+=Math.floor(s/o),i-=r;var c=0,l=0;$.each($(".review"),function(){var t=$(this).position().top;t!=a&&(l!=o?$(this).width(i*(o-l)):($.each(e,function(){$(this).height(c)}),a=$(this).position().top,e=[],c=0,l=0)),e.push($(this));var n=parseInt($(this).width()),s=Math.ceil(n/i);o<s&&(s=o),s+l>o&&(s=o-l),n=s*i+r*(s-1),l+=s,$(this).css("width",n);var u=$(this).height();c<u&&(c=u)})}}else $(".review").css({float:"none",marginLeft:0,marginRight:0});this.changeReviewsHeight()},changeReviewsHeight:function(){RPC.post("changeReviewsHeight",{height:$("#reviewsContainer").height()+5})}},resizeFeedbackTables:function(){$d.ready(function(){$.each($(".feedbackTable:visible"),function(){var e=$(this),t=!1,a=e.find(".fieldDescr");for(var n in a)if($(a[n]).text().length>20){t=!0;break}t||e.parent().width()<265?e.addClass("narrow").removeClass("wide"):e.removeClass("narrow").addClass("wide")}),chat.form.resize();var e=$("#chatTextarea");$(".autoresizeDiv").width(e.width());var t=e.data("resize");null!=t&&t()})},minHeight:250,initMinSizeAllowed:!1,getTestDopWidth:function(){if("classic"==chat.siteParams.style)var e=65;else if("flat"==chat.siteParams.style)var e=70;else var e=50;return e},heightWithoutPadding:!1,initMinSize:function(e){if(this.initMinSizeAllowed){var t=this;e||(e={}),null==e.store&&(e.store=!0),$d.ready(function(){if(e.height?e.store&&(t.minHeight=e.height):e.height=t.minHeight,e.heightWithoutPadding?e.store&&(t.heightWithoutPadding=e.heightWithoutPadding):e.heightWithoutPadding=t.heightWithoutPadding,!e.width){e.width=0,$.each($("ul.supportTabs li:not(.none) a"),function(){e.width+=$(this).width()+17});var a=$("<span class='nobr'></span>").html("Введите Ваш вопрос и нажмите Enter").appendTo("body"),n=t.getTestDopWidth(),r=a.width()+n;a.remove(),e.width<r&&(e.width=r),$(".subscribe_date").length&&(e.width+=30),e.width+=14}var i=parseInt(chat.siteParams.minWidth);e.width>i&&(e.width=i),e.type=chat.type,RPC.post("initMinSize",e)})}},loading:{loadStyle:function(e,t){if(1==chat.siteParams.useLess)$("head").append('<link rel="stylesheet/less" type="text/css" href="/engine/less/Templates/supportTemplateSample.less?18" /><script type="text/javascript">less = {env: "development"};</script><script type="text/javascript" src="/engine/javascript/less-1.3.3.min.js?44"></script>'),t();else{var a=document.createElement("link");a.type="text/css",a.rel="stylesheet";var n=0,r=document.styleSheets.length,i=setInterval(function(){document.styleSheets.length>r&&(n++,3==n&&(clearInterval(i),t(),t=function(){}))},500);a.readyState?a.onreadystatechange=function(){"loaded"!=a.readyState&&"complete"!=a.readyState||(a.onreadystatechange=null,clearInterval(i),t(),t=function(){})}:a.onload=function(){clearInterval(i),t(),t=function(){}},a.href=e,document.getElementsByTagName("head")[0].appendChild(a),setInterval(function(){chat.captcha.selectImgDisplayed()?RPC.post("hideResize",{}):RPC.post("showResize",{})},1e3)}},loadScript:function(e,t){var a=document.createElement("script");a.type="text/javascript",a.readyState?a.onreadystatechange=function(){"loaded"!=a.readyState&&"complete"!=a.readyState||(a.onreadystatechange=null,t())}:a.onload=function(){t()},a.src=e,document.getElementsByTagName("head")[0].appendChild(a)},started:!1,getDirByID:function(e){var t="",a=e.length;a>2&&(a=2);for(var n=0;n<a;n++)t+=e.substr(n,1)+"/";return t+=e+"/"},updateVisits:function(){var e="last::online::"+chat.siteParams.id+"::"+chat.siteParams.talkID,t=function(){storeWithExpiration.set(e,1,12e4,!0)};setInterval(function(){chat.suspend.check(t,"rememberOnlineIntervalFunction")},1e3);var a=storeWithExpiration.get(e),n=!1;return a||(chat.incrVisits(),storeWithExpiration.remove("cbc2_"+chat.siteParams.id),n=!0),t(),n},start:function(e){var t=this;if(this.started)return!1;this.started=!0,chat.siteParams=e,window[e.apiMethod]=function(){for(var t=[],a=0;a<arguments.length;a++)t.push(JSON.stringify(arguments[a]));var n=e.apiMethod+"("+t.join(",")+");";chat.eval(n)};var a=function(){t.initLocalStorage(function(){t.startContinue(e)})};"support"==e.type?(supportStorage.init(a),chat.emoji.init()):supportStorage.init(a)},initLocalStorage:function(e,t){var a=this,n=chat.siteParams.id+"::currentTalkID",r=supportStorage.get(n),i="talkIdList::"+chat.siteParams.orgID,o=supportStorage.get(i);if(o=o?JSON.parse(o):[],o.indexOf(chat.siteParams.talkID)==-1&&(o.push(chat.siteParams.talkID),supportStorage.set(i,JSON.stringify(o))),chat.siteParams.talkID!=r){if(!t&&!r){var s=RPC.callbacks.add(function(t){if(1==t.code)for(var n in t.values)supportStorage.set(n,t.values[n]);a.initLocalStorage(e,!0)});return void RPC.post("localStorage_getAll",{callbackID:s,keySubstr:chat.siteParams.id})}supportStorage.clearBySite(chat.siteParams.orgID,chat.siteParams.id),supportStorage.set(n,chat.siteParams.talkID)}e()},startContinue:function(e){var t=this,a=this.getDirByID(e.design);chat.loading.loadStyle(chat.staticDomain+"/API/DOCS/onlineChatAssets/styles/"+a+e.design+".css?r="+(e.dtChange+1),function(){if(chat.client.init(),null==e.dopStyle&&(e.dopStyle=""),e.dopStyle+="html.support body #reviewsContainer div.ajax.greenAjax{ background:"+e.params.rate.display.good.background+"; color:"+e.params.rate.display.good.color+"; } html.support body #reviewsContainer div.ajax.redAjax{ background:"+e.params.rate.display.bad.background+"; color:"+e.params.rate.display.bad.color+"; }",$b.append("<style id='additionalStyles'>"+e.dopStyle+"</style>"),null!=supportStorage.get(chat.siteParams.id+"::etag")&&null!=supportStorage.get(chat.siteParams.id+"::date")&&(chat.siteParams.channelEtag=supportStorage.get(chat.siteParams.id+"::etag"),chat.siteParams.channelDate=supportStorage.get(chat.siteParams.id+"::date")),chat.siteParams.params.leadGen.questionCategories.ask=parseInt(chat.siteParams.params.leadGen.questionCategories.ask),chat.siteParams.params.rate.askName=parseInt(chat.siteParams.params.rate.askName),$h.addClass(e.style),chat.siteParams.mobile&&$h.addClass("mobile"),"support"!==e.type&&"reviews"!==e.type||chat.listen.start({cid:"main"}),"support"==e.type){RPC.actions.updateActivityAction(),chat.tabs.draw();var a=chat.operators.getRememberOperator();null!=a.operator&&a.operator&&chat.operators.select({operator:a.operator,group:a.group}),chat.operators.init();var n=t.updateVisits();setInterval(chat.activity.update,13e3),chat.actions.init(),chat.activity.start(null,n),chat.targetClient.checkIfTarget(),supportStorage.setListener(function(e){if(e.newValue){if(supportStorage.checkStoreByThisTab(e.key,e.newValue))return;if("websocketAjaxSended"==e.key)chat.nodeAjax.wasSended(JSON.parse(e.newValue));else if("websocketAjaxResult"==e.key){var t=JSON.parse(e.newValue);chat.nodeAjax.callback(t.callbackID,t.data)}else if("websocketAjax"==e.key){var a=JSON.parse(e.newValue);a&&chat.nodeAjax.sendIfMainListener(a)}}"sendMessage"==e.key?chat.messages.history.showOneMoreMessage():"removeMessage"==e.key?chat.messages.history.removeFromHTML(e.newValue):e.key=="fv::"+chat.siteParams.id&&chat.actions.filters.getFiltersFromStorage()}),setInterval(function(){RPC.actions.updateActivityAction()},5e4)}if(chat.loading.live(),"reviews"==e.type)setTimeout(function(){chat.rate.load(0)},100);else if("support"==e.type){var r=function(e){for(var t in chat.listen.started)chat.listen.stop(t)};$(window).bind("beforeunload unload",r),$d.ready(function(){window.location.search.indexOf("type=inline")!=-1&&RPC.actions.open(),window.location.search.indexOf("payment-success")!=-1&&(chat.alert.show({descr:"Ваш платёж успешно принят"}),chat.openSupport()),window.location.search.indexOf("payment-fail")!=-1&&(chat.alert.show({descr:"Процедура оплаты завершилась неудачно"}),chat.openSupport());var e=$(".me-talk-copyright"),t=e.innerHeight();if(chat.copyrightDisplayed()){var a=chat.getInnerCopyrightImage();e.find("img").addClass("delayed-src").attr("delayed-src",a),e.find("a").attr("href",chat.siteParams.params.copyright.url)}else chat.siteParams.params.siteChatOptions.exportByClientAllowed?(e=$(".me-talk-copyright:not(.me-talk-copyright-chat)"),$(".me-talk-copyright-chat").children(".copyright-content").css({visibility:"hidden"})):t=5,e.remove(),$h.removeClass("showCopyright");$(".chat").css({overflow:"hidden"}).perfectScrollbar({includePadding:!0,marginTop:t,minScrollbarLength:20,wheelPropagation:!0}),chat.triggerBadge.updated()})}else"form"==e.type?(chat.form.draw($("#formContainer"),chat.siteParams.formTab),chat.drawCollectContactsForms(),chat.form.resize()):"payment"==e.type&&(chat.payment.draw($("#formContainer"),chat.siteParams.formTab),chat.form.resize())})},live:function(){$d.ready(function(){function e(){chat.messages.chatTextareaValue().length?$("#onlineChatSend").removeClass("disabled"):$("#onlineChatSend").addClass("disabled");var e=$("#chatTextarea").data("resize");null!=e&&e()}$("ul.supportTabs li a").live("click",function(){var e=$(this).parent();e.hasClass("current")||chat.tabs.open(e)}),$(".linkEula").live("click",function(e){e.stopPropagation(),e.preventDefault()}),$(".alert-title").click(function(){chat.alert.hide()}),$(".selectOperator[name=operator]").bind("change",function(){var e=$(this).val(),t=chat.operators.get(e);$(".operatorNameDisplay").html(t.fio),$(".avatar").attr("src",chat.staticDomain+t.avatar)}),$("#onlineChatSend").bind("click",function(){chat.messages.send()}),$("#chatTextarea").bind("keypress",function(t){13==t.keyCode&&(t.shiftKey||(t.preventDefault?t.preventDefault():t.returnValue=!1,chat.messages.send())),e()}).bind("keyup",function(t){void 0!==t.originalEvent&&chat.triggerBadge.empty();var a=chat.operators.get(chat.operators.getCurrent());a&&a.canViewTyping&&(null!=chat.messages.cometTypePublishTimeout||chat.siteParams.free||(chat.messages.cometTypePublishTimeout=setTimeout(function(){chat.messages.clearTyping();var e=chat.messages.chatTextareaValue(),t=$("#chatTextarea");e!=t.attr("placeholder")&&e!=t.data("prev-typing")&&(t.data("prev-typing",e),chat.operators.balancer.isEnabled(function(t){parseInt(chat.siteParams.params.operators.typingNotifications)||(t=1);var a={action:"typing",talkID:chat.siteParams.talkID,siteID:chat.siteParams.id,orgID:chat.siteParams.orgID,text:e,balancer:t?1:0},n="/cometTypePublish?op="+chat.operators.getCurrent(),a=JSON.stringify(a);chat.nodeAjax.send({url:n,method:"POST",data:a},function(e){}),RPC.post("cometPublish",{url:n,data:a})}))},1e3))),e()}),chat.windowResizeFunctions.push(function(){chat.messages.updatePaddings(),chat.resizeFeedbackTables(),chat.textareaHasScrollbar($("textarea")),chat.fixFeedbackFormHeight(),chat.tabs.scrollable.check()}),$("textarea, #chatTextarea").bind("keyup",function(){chat.textareaHasScrollbar(this)}),$(".ha").live("mouseover",function(){$(this).addClass("h")}).live("mouseout",function(){$(this).removeClass("h")}),chat.initMinSizeAllowed=!0,chat.initMinSize(),$(".mute").bind("click",function(){chat.makeMute()}),chat.initMute();
})}},payment:{drawed:{},currency:function(e){return e.content.currency?e.content.currency:{id:"rub",short_descr:"руб",icon:"rub"}},draw:function(e,t){var a=this;if("undefined"!=typeof t){this.drawed[t.id]=!0;var n=t.content.button;t.content.button=!1,$(".paymentSteps",e).data("formID",t.id).data("object",t).data("button",n);chat.form.draw(e,t);if(e.find(".eula").html(chat.eulaString("Продолжить","collectContactField")),chat.drawCollectContactsForms(),$(".sumForm_"+t.content.sumType,e).removeClass("none"),t.content.sumList)for(var r=0;r<t.content.sumList.length;r++){var i=t.content.sumList[r][0];$("select[name=sum_list]",e).append($("<option></option>").attr("value",i).text(t.content.sumList[r][1]+" ("+i+" "+a.currency(t).short_descr+")"))}e.find(".sumIcon").addClass("icon-"+a.currency(t).icon),e.find("[name=sum_client]").attr("placeholder","Введите сумму платежа ("+a.currency(t).short_descr+")");var o=$(".paymentMethodsList",e),s=$("button.sample",o);for(var c in t.content.paymentTypes)!function(e){var n=s.clone().removeClass("none sample");if(n.children("img").addClass("delayed-src").attr("delayed-src","/images/paymentSystems/"+e+".png"),n.children("span").text(chat.siteParams.paymentSystemTypes[e]),o.append(n),t.content.paymentTypes[e].length>1){for(var r=$(".paymentSystemList.sample",o).clone().removeClass("sample"),i=r.find("ul"),c=0;c<t.content.paymentTypes[e].length;c++){var l=t.content.paymentTypes[e][c],u=$("<li></li>").data("psID",l).data("psType",e);$("<img class='delayed-src' delayed-src='/images/paymentSystems/"+l+"_square.png' />").appendTo(u),$("<a></a>").text(chat.siteParams.paymentSystems[l].descr).appendTo(u);u.bind("click",function(){a.step3($(this).data("psID"),$(this).data("psType"),this)}),u.appendTo(i)}n.bind("click",function(){r.is(":visible")?(r.slideUp(200,function(){chat.windowResize()}),$(this).removeClass("selected")):($(this).addClass("selected"),r.slideDown(200,function(){chat.windowResize()}))}),o.append(r)}else n.data("psID",t.content.paymentTypes[e][0]).data("psType",e).bind("click",function(){a.step3($(this).data("psID"),$(this).data("psType"),this)})}(c);$(".sumInput",e).detach().prependTo($(".feedbackFormStep2",e).children("form")),$("input[name=sum_fixed]",e).val(t.content.sumFixed),$(".sumForm_fixed .sum",e).html(t.content.sumFixed+" "+a.currency(t).short_descr),chat.windowResize(),chat.loadDelayedSrc()}},getDivBySender:function(e){return $(e).parentsUntil(".paymentSteps").last().parent()},step2:function(e){var t=this,a=this.getDivBySender(e),n=$(".sumForm > .sumType:not(.none)",a).data("type"),r=parseFloat($("[name='sum_"+n+"']",a).val());r?r>0?($(e).attr("disabled","disabled"),chat.disableLiteMode(),chat.api("createBillByClient",{sum:r},function(n){if(1==n.code){a.data("billID",n.id),$(".step1",a).slideUp();var r=$(".step2",a);r.slideDown(function(){chat.windowResize()}),$("[name=sum]",r).val("Cумма платежа: "+n.sum+" "+t.currency(a.data("object")).short_descr)}else n.retry=function(){t.step2(e)},chat.alert.show(n);$(e).removeAttr("disabled")})):chat.alert.show({code:0,descr:"Сумма платежа должна быть больше 0"}):chat.alert.show({code:0,descr:"Не удалось получить сумму платежа"})},step3:function(e,t,a){var n=this,r=this.getDivBySender(a),i=r.data("billID"),o=r.data("formID");chat.overlay.show();var s=$.form.get("collectContactField",!1,!1,r);chat.api("loadFormForBill",{billID:i,formID:o,psID:e,psType:t,paymentComment:$(".form_"+o+"[name=paymentComment]").val(),contacts:$.form.get("collectContactField",!1,!1,r),currentUrl:chat.siteParams.currentUrl},function(i){if(chat.overlay.hide(),1==i.code){var c=chat.tabs.getTabParams(o);chat.sendEvent("Payment form submited","Посетитель заполнил форму [formName]".split("[formName]").join(c.title),"Payment form submited "+c.id),chat.captcha.reset(),$(".step2",r).slideUp();var l=$(".step3",r);s.tabID=o,s.currentPage={url:chat.siteParams.currentUrl,title:chat.siteParams.currentTitle},RPC.post("clientMakeSubscribe",s),"cloud_payments"==e?RPC.post("appendScript",{script:i.form}):l.append(i.form);var u=r.data("button"),h=l.find(".submit");u&&h.text(u),h.length?($(".step3Button",l).show(),$(".step3NoButton",l).hide()):($(".step3Button",l).hide(),$(".step3NoButton",l).show()),l.slideDown(function(){chat.windowResize()})}else i.retry=function(){n.step3(e,t,a)},chat.alert.show(i)})}},overlay:{show:function(){$b.addClass("overlay")},hide:function(){$b.removeClass("overlay")}},form:{drawed:{},draw:function(e,t){if("undefined"!=typeof t){this.drawed[t.id]=!0,this.drawUserHTML(e,t);var a="form_"+t.id,n=$("<div class='contacts_place'></div>");return n.data("class",a),n.data("type","form"),n.data("drawCaptcha",1),n.data("collectContacts",t.content.form),n.data("button",t.content.button),n.data("button-click",function(){chat.form.make($(this),t)}),e.find(".feedbackForm").append(n),{className:a}}},drawUserHTML:function(e,t){var a=[["html","userHTMLTop"],["html_footer","userHTMLFooter"]];for(var n in a){var r=chat.prepareHTML(t.content[a[n][0]]);if(r)var i=$("<div />").html(r).text().length;else var i=0;var o=$("."+a[n][1],e);i?o.removeClass("none").html(r).show():o.hide()}},make:function(e,t){var a=this,n=$.form.get(".form_"+t.id,!1);e.attr("disabled","disabled"),n.tabID=t.id,n.currentPage={url:chat.siteParams.currentUrl,title:chat.siteParams.currentTitle},chat.disableLiteMode(),chat.api("sendForm",n,function(r){e.removeAttr("disabled"),r.code!=-1?(1==r.code&&(supportStorage.remove("subscribe::"+n.id),chat.client.update(r.info),$("select.form_"+t.id+", input.form_"+t.id+"[type=text], textarea.form_"+t.id).val("").change()),r.retry=function(){a.make(e,t)},chat.alert.show(r),1==r.code&&(chat.captcha.reset(),chat.tabs.hideCurrentInvisibleTab(),chat.sendEvent("Form submited","Посетитель заполнил форму [formName]".split("[formName]").join(t.title),"Form submited "+t.id),RPC.post("clientMakeSubscribe",n))):(supportStorage.set("subscribe::"+t.id,n),chat.form.sendVerifyCode=!0,$(".form_"+t.id).attr("disabled","disabled"),$(".form_"+t.id+"[name=verifyCode]").removeAttr("disabled"),$(".verifyCode_"+t.id).removeClass("none"),setTimeout(function(){chat.form.resize()},200)),chat.form.resize()})},resize:function(){var e=$("#formContainer").position(),t=null==e?0:e.top;RPC.post("changeFormHeight",{height:$("#formContainer").outerHeight()+t+5})}},searchKeyword:{cache:null,get:function(){if(null!=this.cache)return this.cache;var e=!1,t=chat.siteParams.referrer;if(t.length&&null!=chat.siteParams.searchEngines)for(var a in chat.siteParams.searchEngines){var n=chat.siteParams.searchEngines[a];if(t.indexOf(n.host)!=-1){var r=getQueryStringParams(t);null!=r[n.key]&&(e=r[n.key]);break}}return this.cache=e,e},escapeFromOtherCharacters:function(e){return e||(e=""),e.replace(/[^a-zA-ZА-Яа-я0-9\s]/g,"")},check:function(e){var t=this.get();if(t){t=chat.searchKeyword.escapeFromOtherCharacters(t).split(/\s/);var e=chat.searchKeyword.escapeFromOtherCharacters(e.replace(/\+/g," ")).split(/\s/),a=!0;for(var n in e){var r=!1;for(var i in t)if(t[i]==e[n]||0==t[i].indexOf(e[n])||t[i].indexOf(" "+e[n])!=-1){r=!0;break}if(!r){a=!1;break}}return a}return!1}},targetClient:{checkIfTarget:function(){var e=this,t=[],a=chat.siteParams.targetParams;if(null!=a.referer){var n=this.prepareUrl(chat.siteParams.referrer);if(n.length)for(var r in a.referer){var i=this.prepareUrl(a.referer[r]);0==n.indexOf(i)&&t.push({param:"referer",value:a.referer[r],search:a.referer[r]})}}if(null!=a.url){var o=this.prepareUrl(chat.siteParams.currentUrl);for(var r in a.url){var i=this.prepareUrl(a.url[r]);i==o&&t.push({param:"url",value:a.url[r],search:a.url[r]})}}if(null!=a.urlSubstring){var o=chat.siteParams.currentUrl;for(var r in a.urlSubstring)o.indexOf(a.urlSubstring[r])!=-1&&t.push({param:"urlSubstring",value:a.urlSubstring[r],search:a.urlSubstring[r]})}if(null!=a.searchKeyword&&null!=chat.siteParams.searchEngines){var s=chat.searchKeyword.get();if(s)for(var r in a.searchKeyword){var c=chat.searchKeyword.check(a.searchKeyword[r]);c&&t.push({param:"searchKeyword",value:s,search:a.searchKeyword[r]})}}if(null!=a.city)for(var r in a.city)t.push({param:"city",value:a.city[r],search:a.city[r]});null!=a.all&&t.push({param:"all",value:"",search:""}),t.length&&e.send(t)},send:function(e,t){if(chat.siteParams&&!chat.isLiteModeEnabled()){var a=[],n=[];for(var r in e){"string"==typeof e[r]&&(e[r]={param:"custom",value:e[r],search:e[r]});var i=e[r].value;"city"==e[r].param&&(i=i.substr(0,10));var o=chat.siteParams.id+"::"+chat.siteParams.talkID+"::target::"+e[r].param+"::"+i;null==supportStorage.get(o)&&(n.push(o),a.push(e[r]))}if(t)return!!a.length;if(a.length)return chat.actions.filters.set("isTargetClient","1"),setTimeout(function(){var e="/writeMetalkQueue";chat.nodeAjax.send({url:e,method:"GET",headers:chat.getHeaders("notifyTargetClient",{why:a})},function(e){chat.listen.start({cid:"main"});for(var t=0;t<n.length;t++)supportStorage.set(n[t],1)})},500),!0}return!1},prepareUrl:function(e){return e=e.replace(/\\\?/gi,"?").replace(/\:\/\/www./gi,"://").replace(/http\:\/\//gi,"").replace(/https\:\/\//gi,""),e=e.split("#"),e=e[0],"/"==e.substr(e.length-1,1)&&(e=e.substr(0,e.length-1)),e.indexOf("?")!=-1&&e.indexOf("index.php?")==-1&&e.replace(/\\?/gi,"index.php?"),e}},setClientInfo:function(e){var t="programmaticlyChangedContactsNew::"+chat.siteParams.id,a=storeWithExpiration.get(t),n="cache value is "+JSON.stringify(e);null!=a&&a==n||chat.api("setClientInfo",e,function(e){1==e.code&&(chat.client.update(e.info),storeWithExpiration.set(t,n,36e5))})},changeContacts:function(e,t,a,n){if(null==a&&(a=1),e||(e=""),e&&e.length||!a){var r="programmaticlyChangedContactsNew::"+chat.siteParams.id,i=storeWithExpiration.get(r),o=e+t;n&&(o+=JSON.stringify(n)),null!=i&&i==o||chat.api("changeClientContacts",{contact:e,descr:t,important:a,custom:n},function(t){1==t.code&&(chat.client.update(t.info),$("input[name=contact]").attr("value",e),storeWithExpiration.set(r,o,36e5))})}},setCustomData:function(e){var t="programmaticlyChangedCustomDataNew::"+chat.siteParams.id,a=supportStorage.get(t),n=JSON.stringify(e);null!=a&&a==n||chat.api("changeClientCustomData",{data:e},function(e){1==e.code&&supportStorage.set(t,n)})},alert:{visible:!1,show:function(e){e=$.extend({hideOnClick:!0},e);var t=this;null==e.title&&(e.title="Системное сообщение",801==e.code&&(e.title="Внимание"));var a=$("#alert-message"),n=!0;if(a.length||(a=$(".alert-form > div"),n=!1),!a.length)return RPC.post("alert",{text:e.descr});if(this.visible=!0,1==e.code)var r="success";else if(e.code==-1)var r="warning";else var r="error";if($(".alert-title > span",a).html(e.title),$(".alert-text",a).addClass("relative").html(e.descr),801==e.code&&e.retry){var i=$("<div class='mt20'></div>"),o=$("<button class='b'>Я согласен</button>").bind("click",function(){$("[name=eulaAgreement]:visible").attr("checked","checked"),e.retry()}),s=$("<button class='fr'>Отмена</button></div>");i.append(o).append(s).appendTo($(".alert-text",a))}if($(a).attr("class",r),n){var c=2;chat.siteParams.mobile&&(c*=1.3),$(a).css({top:$(".wrapper").height()/c-$("#alert-message").height()/c}),$("#alert-background, #alert-message").fadeIn(300).unbind("click");var l="#alert-background";e.hideOnClick&&(l+=", #alert-message"),$(l).bind("click",function(){t.hide()})}else $(a).slideDown()},hide:function(){this.visible&&(this.visible=!1,$("#alert-background, #alert-message").fadeOut(300))}},textareaHasScrollbar:function(e){e=$(e),$.each($(e),function(){var e=$(this),t=!1;if(null!=e[0]){if(Math.ceil(e[0].clientHeight)<e[0].scrollHeight)var t=!0;if(t!=e.hasClass("hasScrollbar")){var a=chat.getScrollbarWidth,n=e.parent().children(".uploadIcon"),r=e.parent().children("#onlineChatSend");t?(e.addClass("hasScrollbar"),n.css({marginRight:a}),r.css({right:a})):(e.removeClass("hasScrollbar"),n.css({marginRight:0}),r.css({right:0}))}}})},getScrollbarWidthCache:null,getScrollbarWidth:function(){if(null!=chat.getScrollbarWidthCache)return chat.getScrollbarWidthCache;var e=document.createElement("div");return e.innerHTML='<div style="width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;"><div style="width:1px;height:100px;"></div></div>',e=e.firstChild,document.body.appendChild(e),width=e.offsetWidth-e.clientWidth,document.body.removeChild(e),chat.getScrollbarWidthCache=width,width},loadedSounds:[],playSound:function(e){chat.mute||"off"==e||RPC.post("playSound",{id:e})},initMute:function(){var e=supportStorage.get("mute");null==e&&(e=0),chat.mute=!e,chat.makeMute()},makeMute:function(){chat.mute=!chat.mute;var e=$(".mute").removeClass("icon-volume-up icon-volume-off");if(chat.mute){var t=1;e.addClass("icon-volume-off").attr("title","Звук выключен")}else{var t=0;e.addClass("icon-volume-up").attr("title","Звук включен")}var t=parseInt(t);supportStorage.get("mute")!=t&&supportStorage.set("mute",t)},getSclon:function(e,t,a,n){var r=!1,i=this.substr(e,-1,1);return r=e>20?i>1&&i<5?a:1==i?t:n:1==e?t:e>4&&e<=20||0==e?n:a},substr:function(e,t,a){return e=e.toString(),t<0&&(t+=e.length),void 0==a?a=e.length:a+=a<0?e.length:t,a<t&&(a=t),e.substring(t,a)},cookie:{set:function(e,t,a){RPC.post("setCookie",{name:e,value:t,expires:a})},get:function(e,t){var a=" "+document.cookie,n=" "+e+"=",r=null,i=0,o=0;if(a.length>0&&(i=a.indexOf(n),i!=-1&&(i+=n.length,o=a.indexOf(";",i),o==-1&&(o=a.length),r=unescape(a.substring(i,o)))),r)t(r);else{var s=chat.generateCode(20);this.callbacks[s]=t,RPC.post("getCookie",{name:e,code:s})}},callbacks:{}},rand:function(e,t){return Math.random()*(t-e)+e},generateCode:function(e){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";if(null==e)var e=32;for(var a="",n=0;n<e;n++){var r=Math.floor(Math.random()*t.length);a+=t.substring(r,r+1)}return a},shuffle:function(e){for(var t,a,n=e.length;n;t=Math.floor(Math.random()*n),a=e[--n],e[n]=e[t],e[t]=a);return e},showUploadFile:function(e,t){var a='<input type="file" name="file[]" multiple class="'+e+'" />';chat.alert.show({code:1,descr:a,title:"Загрузка файла",hideOnClick:!1}),$d.ready(function(){var a=chat.generateCode(50),n=$("."+e+'[name="file[]"]');$.form.makeUpload(n,{name:"file",autoLoad:!0,form:e,onComplete:function(r){n.parent().parent().find("iframe")[0];$.post("/LAPI/misc/fileShare.php?action=getLastUpload&key="+a,{},function(a){a.length&&chat.onUploadFile(e,t,$.parseJSON(a))},"html")},progress:!1,upload:"https://static.me-talk.ru/LAPI/misc/fileShare.php?action=upload&key="+a+"&org="+chat.siteParams.orgID})})},onUploadFile:function(e,t,a){if(chat.alert.hide(),1==a.code){var n=!0;if("onlineChat"==e)var r=chat.messages.chatTextareaValue();else{var i=$("."+e+"[name="+t+"]");n=$(i).data("append-file-name-to-link"),null!=n&&(n=parseInt(n));var r=i.val()}r.length&&(r+="\n");for(var o="<p>Передача файлов:</p>",s=0;s<a.multiple.length;s++){var c=a.multiple[s];if(c){r.length&&(r+="\n");var t=c.filename,l=$.form.fsize(c.size),u=a.domain+c.url;r+=u,n&&(r+=" ("+t+", "+l+")");var h="<a href='"+u+"' target='_blank'>";o+="<p class='ellipsis nobr'>"+h+t+"</a> ("+l+")</p>",c.imageSize&&c.imageSize.width&&(o+="<p>"+h+"<img src='"+u+"' style='max-height:60px; max-width:100%;' /></a></p>")}}a.multiple.length>1&&(r+="\n\nСкачать одним архивом: "+a.domain+a.multipleUrl);var d=function(){chat.alert.hide(),"onlineChat"==e?(chat.messages.chatTextareaValue(r),chat.messages.send()):i.val(r).change().keyup()};o=$("<div><div id='uploadPreview' style='height:180px; overflow:hidden; position:relative;'>"+o+"</div><hr class='mt20 mb20'></div>"),o.append($("<button class='b' style='margin-right:5px;'>Продолжить</button>").bind("click",function(){d()})),o.append($("<button>Отмена</button>").bind("click",function(){chat.alert.hide()})),chat.alert.show({code:1,hideOnClick:!1,descr:o}),$d.ready(function(){$("#uploadPreview").perfectScrollbar({includePadding:!1,minScrollbarLength:0,marginTop:0})})}else chat.alert.show(a)},onReady:function(e,t){var a=this;if(t||(t="siteParams"),"siteParams"==t&&(!supportStorage.isInit()||!chat.siteParams||!chat.siteParams.id)||"liteMode"==t&&chat.isLiteModeEnabled()){var n="liteMode"==t?1e3:5;return setTimeout(function(){a.onReady(e,t)},n)}e()},sendEvent:function(e,t,a){RPC.post("sendEvent",{action:e,label:t,alternativeAction:a})}};chat.instanceID=chat.generateCode(20),function(){var e,t,a,n,r,i,o,s,c,l;e=chat.device,chat.device={},a=window.document.documentElement,l=window.navigator.userAgent.toLowerCase(),chat.device.ios=function(){return chat.device.iphone()||chat.device.ipod()||chat.device.ipad()},chat.device.iphone=function(){return n("iphone")},chat.device.ipod=function(){return n("ipod")},chat.device.ipad=function(){return n("ipad")},chat.device.android=function(){return n("android")},chat.device.androidPhone=function(){return chat.device.android()&&n("mobile")},chat.device.androidTablet=function(){return chat.device.android()&&!n("mobile")},chat.device.blackberry=function(){return n("blackberry")||n("bb10")||n("rim")},chat.device.blackberryPhone=function(){return chat.device.blackberry()&&!n("tablet")},chat.device.blackberryTablet=function(){return chat.device.blackberry()&&n("tablet")},chat.device.windows=function(){return n("windows")},chat.device.windowsPhone=function(){return chat.device.windows()&&n("phone")},chat.device.windowsTablet=function(){return!1},chat.device.fxos=function(){return(n("(mobile;")||n("(tablet;"))&&n("; rv:")},chat.device.fxosPhone=function(){return chat.device.fxos()&&n("mobile")},chat.device.fxosTablet=function(){return chat.device.fxos()&&n("tablet")},chat.device.meego=function(){return n("meego")},chat.device.cordova=function(){return window.cordova&&"file:"===location.protocol},chat.device.nodeWebkit=function(){return"object"==typeof window.process},chat.device.mobile=function(){return chat.device.androidPhone()||chat.device.iphone()||chat.device.ipod()||chat.device.windowsPhone()||chat.device.blackberryPhone()||chat.device.fxosPhone()||chat.device.meego()},chat.device.tablet=function(){return chat.device.ipad()||chat.device.androidTablet()||chat.device.blackberryTablet()||chat.device.windowsTablet()||chat.device.fxosTablet()},chat.device.desktop=function(){return!chat.device.tablet()&&!chat.device.mobile()},chat.device.portrait=function(){return window.innerHeight/window.innerWidth>1},chat.device.landscape=function(){return window.innerHeight/window.innerWidth<1},chat.device.noConflict=function(){return window.chat.device=e,this},n=function(e){return-1!==l.indexOf(e)},i=function(e){var t;return t=new RegExp(e,"i"),a.className.match(t)},t=function(e){return i(e)?void 0:a.className+=" "+e},s=function(e){return i(e)?a.className=a.className.replace(e,""):void 0},chat.device.ios()?chat.device.ipad()?t("ios ipad tablet"):chat.device.iphone()?t("ios iphone mobile"):chat.device.ipod()&&t("ios ipod mobile"):t(chat.device.android()?chat.device.androidTablet()?"android tablet":"android mobile":chat.device.blackberry()?chat.device.blackberryTablet()?"blackberry tablet":"blackberry mobile":chat.device.windows()?chat.device.windowsTablet()?"windows tablet":chat.device.windowsPhone()?"windows mobile":"desktop":chat.device.fxos()?chat.device.fxosTablet()?"fxos tablet":"fxos mobile":chat.device.meego()?"meego mobile":chat.device.nodeWebkit()?"node-webkit":"desktop"),chat.device.cordova()&&t("cordova"),r=function(){return chat.device.landscape()?(s("portrait"),t("landscape")):(s("landscape"),t("portrait"))},c="onorientationchange"in window,o=c?"orientationchange":"resize",window.addEventListener?window.addEventListener(o,r,!1):window.attachEvent?window.attachEvent(o,r):window[o]=r,r()}.call(this),chat.ie=function(){for(var e,t=3,a=document.createElement("div");a.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",a.getElementsByTagName("i")[0];);return t>4?t:e}(),chat.server=window.location.protocol+"//"+window.location.hostname;var RPC={callbacks:{list:{},add:function(e){var t=chat.generateCode(20);return this.list[t]=e,t}},socket:null,post:function(e,t){this.socket.postMessage(JSON.stringify({action:e,data:t}))},get:function(e){var t=JSON.parse(e);null!=RPC.actions[t.action]&&RPC.actions[t.action](t.data)},actions:{isOnTabChanged:function(e){if(chat.siteParams){var t="/writeMetalkQueue";chat.nodeAjax.send({url:t,method:"GET",headers:chat.getHeaders("isOnTabChanged",{value:e.value,lastMessageId:chat.lastReceiveMessageID.get()})})}},suspend:function(e){e.value?chat.suspend.on():chat.suspend.off()},callback:function(e){e&&e.callbackID&&RPC.callbacks.list[e.callbackID]&&(RPC.callbacks.list[e.callbackID](e.data),delete RPC.callbacks.list[e.callbackID])},parentLocalStorageChanged:function(e){supportStorage.parentLocalStorageChanged(e.key,e.value)},getStorageValue:function(e){chat.onReady(function(){var t=storeWithExpiration.get(e.key+"::"+chat.siteParams.id);RPC.post("getStorageValueCallback",{value:t,callbackKey:e.callbackKey})})},setStorageValue:function(e){chat.onReady(function(){storeWithExpiration.set(e.key+"::"+chat.siteParams.id,e.value,e.expiration),e.callbackKey&&RPC.post("getStorageValueCallback",{callbackKey:e.callbackKey})})},init:function(e){chat.loading.start(e)},getCookieCallback:function(e){chat.cookie.callbacks[e.code](e.value)},close:function(){chat.actions.filters.set("widgetState","closed"),$h.removeClass("supportOpened").addClass("supportClosed")},alert:function(e){chat.openSupport(),chat.alert.show({descr:e.text})},loadInfoInt:null,loadInfoIntFunc:function(){(chat.isOpened()||"support"!=chat.type)&&$(".collectContactField:visible, .offlinePmLoading:visible, .askForContactsForm:visible").length&&(clearInterval(this.loadInfoInt),chat.tabs.loadClientFeedbackInfo())},open:function(e){e||(e={}),e=$.extend({focus:!0},e);var t=this;if(chat.actions.filters.set("widgetState","opened"),$h.addClass("supportOpened").removeClass("supportClosed"),chat.loadDelayedSrc(),"reviews"==chat.tabs.currentType&&chat.rate.drawTab(),$("#inititalStyles").remove(),clearInterval(this.loadInfoInt),this.loadInfoInt=setInterval(function(){t.loadInfoIntFunc()},500),chat.phoneMask.load(),t.loadInfoIntFunc(),chat.windowResize(),!$("#chatTextarea").hasClass("init")){var a=function(e){var t=parseInt($(".chat").css("bottom")),a=$(".onlineChatTextarea").height()+3+parseInt($(".onlineChatTextarea").css("bottom")),n=$(".chat").scrollTop(),r=n+a-t;$(".chat").css("bottom",a).scrollTop(r)};$("#chatTextarea").addClass("init").placeholder().data("resize",a).trigger("textchange")}chat.messages.scrollBottom(),chat.ie&&setTimeout(function(){var e=document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",t.styleSheet.cssText=":before,:after{content:none !important}",e.appendChild(t),setTimeout(function(){e.removeChild(t)},0)},200);for(var n=1;n<10;n++)setTimeout(function(){$("#chatTextarea").keyup().trigger("textchange")},200*n);$("#chatTextarea").keyup().trigger("textchange"),chat.tabs.scrollable.update(),e.focus&&$("textarea:visible, #chatTextarea:visible").focus()},loadNewPage:function(e){chat.activity.close(),chat.siteParams.currentUrl=e.url,chat.siteParams.currentTitle=e.title,chat.activity.start()},getActivityActionUrl:function(e,t){var a="/"+e+"?",n=[];for(var r in t)n.push(r+"="+encodeURIComponent(t[r]));return a+=n.join("&")},queryActivityAction:function(e,t){var a=this;$("<img />").attr("src",a.getActivityActionUrl(e,t))},updateActivityAction:function(e){var t=this;if(chat.siteParams){if(null==e&&(e={}),chat.activity.pageID){var a=chat.generateCode(5);chat.nodeAjax.send({simpleQuery:e.simpleQuery,url:this.getActivityActionUrl("writeMetalkUpdateActivityQueue",{random:a,orgID:chat.siteParams.orgID,siteID:chat.siteParams.id,pageID:chat.activity.pageID,talkID:chat.siteParams.talkID})},function(e){chat.operators.refresh(e)})}}else setTimeout(function(){t.updateActivityAction(e)},5)},openReviewsTab:function(e){chat.tabs.openByType("reviews"),!e||e.form?chat.rate.showForm(!0):chat.rate.hideForm()},openByType:function(e){chat.tabs.openByType(e.type)},openTab:function(e){chat.tabs.open("tab"+parseInt(e.index))},showTab:function(e){chat.tabs.showTab(e)},setName:function(e){chat.onReady(function(){chat.client.get("descr")!=e.name&&chat.api("setClientName",{name:e.name},function(e){1==e.code&&chat.tabs.loadClientFeedbackInfoCallback(e.info)})})},setClientInfo:function(e){chat.onReady(function(){chat.setClientInfo(e)})},changeContacts:function(e){chat.onReady(function(){chat.changeContacts(e.contacts,e.name,e.important,e.custom)})},setCustomData:function(e){chat.onReady(function(){chat.setCustomData(e.data)})},lastUsedLess:{},updateLess:function(e){var t=this;if(null!=window.less){var a={"@triggerBackground":e.triggerBackground,"@triggerColor":e.triggerColor,"@triggerTextShadow":e.triggerTextShadow,"@font":e.font,"@defaultFontSize":e.defaultFontSize,"@linkColor":e.linkColor,"@linkHoverColor":e.linkHoverColor,"@buttonSaveBg":e.buttonSaveBg,"@buttonSaveColor":e.buttonSaveColor,"@operatorMessageBackground":e.operatorMessageBackground,"@operatorMessageColor":e.operatorMessageColor};for(var n in a)a[n]?t.lastUsedLess[n]=a[n]:t.lastUsedLess[n]?a[n]=t.lastUsedLess[n]:delete a[n];less.modifyVars(a);var r=$("#advancedStyles");0==r.length&&(r=$("<style id='advancedStyles'>").appendTo("body")),r.html(e.advanced)}else setTimeout(function(){t.updateLess(e)},5)},getContacts:function(e){var t=this;chat.onReady(function(){var a=chat.client,n=chat.actions.filters.get("cc");if(n){var r={id:chat.actions.filters.get("cc"),name:a.get("descr"),phone:a.get("phone"),email:a.get("email"),skype:a.get("skype"),custom:a.get("customData"),searchKeyword:chat.actions.filters.get("searchKeyword")};RPC.post("getContactsCallback",r),e&&(chat.sendEvent("User update contacts","Посетитель обновил контактные данные"),RPC.post("contactsUpdatedCallback",r))}else setTimeout(function(){t.getContacts(e)},500)})},clearHistory:function(){chat.messages.history.clear()},setOperator:function(e){"object"!=typeof e.login&&(e.login=[e.login]),chat.onReady(function(){e.offlineModeIfOperatorNotExists?chat.operators.offlineModeIfOperatorNotExists=e.login:chat.operators.offlineModeIfOperatorNotExists=!1;for(var t=0;t<e.login.length;t++)if(chat.operators.isOnline(e.login[t])){e.dontSetTalkWithOperator||chat.operators.setTalkWithOperator(e.login[t]),e.dontDisableBalancer||chat.operators.balancer.disable(),chat.operators.select({operator:e.login[t],group:e.group,remember:e.remember});break}chat.operators.refreshWithLastData()})},cometPublish:function(e){e.cid&&(null==cometPublish.stack[e.cid]&&(cometPublish.stack[e.cid]=[],cometPublish.cids.push(e.cid)),cometPublish.stack[e.cid].push(JSON.stringify(e.content)))},cometListen:function(e){chat.listen.start({cid:e.cid,callback:function(t){RPC.post("cometListen",{cid:e.cid,data:t})}})},sendMessage:function(e){e.text&&("online"==chat.chatMode||"simulation"==chat.siteParams.params.leadGen.mode?chat.messages.send(e.text,e.messageType,!0):($(".meTalkPM[name=text],.lcabPM[name=text]").val(e.text),chat.pm.metalk.send(!0)))},setMessage:function(e){chat.messages.chatTextareaValue(e.text)},getBalancedOperator:function(e){chat.operators.getBalancedOperator({exclude:e.exclude},function(t){RPC.post("getStorageValueCallback",{value:t,callbackKey:e.callbackKey})})},fetchReviews:function(e){chat.rate.fetchReviews(e,function(t){RPC.post("getStorageValueCallback",{value:t,callbackKey:e.callbackKey})})},removeMessage:function(e){chat.messages.history.removeByText(e.text,"supportAPI")},receiveMessage:function(e){if(e.text&&("online"==chat.chatMode||"simulation"==chat.siteParams.params.leadGen.mode)&&(e.operator&&(chat.operators.isOnline(e.operator)||(e.operator=!1)),e.operator||(e.operator=chat.operators.getCurrent()),e.operator)){var t=100;e.simulateTyping>0&&(t=e.simulateTyping,chat.messages.operatorTyping(e.operator,!1,t)),e.disableChatSimulation&&chat.operatorAway.setActivity(),chat.messages.history.removeByText(e.text,"supportAPI"),setTimeout(function(){chat.api("sendMessageToClientBySupportAPI",{operator:e.operator,text:e.text,silent:e.simulateTyping==-1})},t)}},setTarget:function(e){chat.onReady(function(){chat.targetClient.send(e)})},mouseLeavePage:function(e){chat.actions.filters.set("mouseLeavePage",e.edge),setTimeout(function(){chat.actions.filters.get("mouseLeavePage")==e.edge&&chat.actions.filters.set("mouseLeavePage",null)},2e3)},setActionFilterValue:function(e){chat.onReady(function(){"url"===e.name?chat.activity.setCurrentUrlFilter(e.value):chat.actions.filters.set(e.name,e.value),chat.actions.listeners.make()})},browser:function(e){null!=chat.browser.rpcActions[e.action]?chat.browser.rpcActions[e.action](e):chat.log(e.action+" is unknown browser rpc action")}}},cometPublish={active:!1,stack:{},cids:[],postDone:function(){cometPublish.active=!1},send:function(){if(!cometPublish.active)for(var e in cometPublish.cids){var t=cometPublish.cids[e];if(cometPublish.stack[t].length){cometPublish.active=!0;var a="["+cometPublish.stack[t].join(",")+"]";cometPublish.stack[t]=[];var n="/cometPublish?cid="+t;$.post(n,a,cometPublish.postDone,"html").always(cometPublish.postDone).done(cometPublish.postDone).error(cometPublish.postDone),RPC.post("cometPublish",{url:n,data:a})}}}};setInterval(cometPublish.send,2e3);var Url={encode:function(e){return escape(this._utf8_encode(e))},decode:function(e){return this._utf8_decode(unescape(e)).replace(/\+/g," ")},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",a=0;a<e.length;a++){var n=e.charCodeAt(a);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t},_utf8_decode:function(e){for(var t="",a=0,n=c1=c2=0;a<e.length;)n=e.charCodeAt(a),n<128?(t+=String.fromCharCode(n),a++):n>191&&n<224?(c2=e.charCodeAt(a+1),t+=String.fromCharCode((31&n)<<6|63&c2),a+=2):(c2=e.charCodeAt(a+1),c3=e.charCodeAt(a+2),t+=String.fromCharCode((15&n)<<12|(63&c2)<<6|63&c3),a+=3);return t}};if(function(e){function t(t){this.input=t,"password"==t.attr("type")&&this.handlePassword(),e(t[0].form).submit(function(){t.hasClass("placeholder")&&t[0].value==t.attr("placeholder")&&(t[0].value="")})}t.prototype={show:function(e){if(""===this.input[0].value||e&&this.valueIsPlaceholder()){if(this.isPassword)try{this.input[0].setAttribute("type","text")}catch(e){this.input.before(this.fakePassword.show()).hide()}this.input.addClass("placeholder"),this.input[0].value=this.input.attr("placeholder")}},hide:function(){if(this.valueIsPlaceholder()&&this.input.hasClass("placeholder")&&(this.input.removeClass("placeholder"),this.input[0].value="",this.isPassword)){try{this.input[0].setAttribute("type","password")}catch(e){}this.input.show(),this.input[0].focus()}},valueIsPlaceholder:function(){return this.input[0].value==this.input.attr("placeholder")},handlePassword:function(){var t=this.input;if(t.attr("realType","password"),this.isPassword=!0,e.browser.msie&&t[0].outerHTML){var a=e(t[0].outerHTML.replace(/type=(['"])?password\1/gi,"type=$1text$1"));this.fakePassword=a.val(t.attr("placeholder")).addClass("placeholder").focus(function(){t.trigger("focus"),e(this).hide()}),e(t[0].form).submit(function(){a.remove(),t.show()})}}};var a=!!("placeholder"in document.createElement("input"));e.fn.placeholder=function(){return a?this:this.each(function(){var a=e(this),n=new t(a);n.show(!0),a.focus(function(){n.hide()}),a.blur(function(){n.show(!1)}),e.browser.msie&&(e(window).load(function(){a.val()&&a.removeClass("placeholder"),n.show(!0)}),a.focus(function(){if(""==this.value){var e=this.createTextRange();e.collapse(!0),e.moveStart("character",0),e.select()}}))})}}(jQuery),$d.ready(function(){$d.bind("keyup",function(e){27==e.keyCode&&chat.overlay.hide()})}),$.ajaxSetup({cache:!1,retryLimit:100,tryCount:0,beforeSend:function(e,t){t.data&&t.data.indexOf("postuid")!=-1||t.url.indexOf("api.php")>-1&&(t.data+="&returnDataType="+t.dataType+"&postuid="+chat.generateCode(30))},error:function(e,t,a){if(("timeout"==t||200!=e.status)&&(this.tryCount++,
this.tryCount<=this.retryLimit)){var n=this;setTimeout(function(){$.ajax(n)},5e3)}}}),jQuery.form={get:function(e,t,a,n){if(null==a&&(a=!1),null==t&&(t=!0),null==e||0==e.length)return t?JSON.stringify({}):{};var r="input."+e+":radio:checked,input."+e+"[type=tel],input."+e+":checkbox:checked,input."+e+":text,input."+e+":hidden,input."+e+":file,input."+e+":password,textarea."+e+",select."+e;if(null==n)var i=$(r);else var i=$(n).find(r);var o={};return $.each(i,function(){var e=$(this).attr("name"),t=$(this).attr("value");if(!($.isArray(t)&&null==t[0]||null==t)){if($(this).is("select")){var n=$(this).children("optgroup");if(0==n.length&&(n=$(this)),$(this).attr("multiple")){var t=[];$.each(frm.children("option[selected]"),function(){t[t.length]=$(this).attr("value")})}}if(a||$(this).is(":checkbox")){if($(this).is(":checkbox")&&!$(this).is(":checked"))return;null==o[e]&&(o[e]=new Array),o[e][o[e].length]=t}else o[e]=t}}),0==t?o:JSON.stringify(o)},uploadChange:function(e,t,a){$("input[key='"+e+"'][name='"+t+"']").attr("value",a)},removeUpload:function(e){$.each($(e),function(){var e=$(this).parent();e.is("form")&&($(this).removeAttr("key").unbind("click change").detach().appendTo(e.parent()),e.remove())})},makeUpload:function(e,t,a){var n=$(e);$.each(n,function(){var n={progress:"/progress",serverFileName:"%real%",directory:"",userParam:"",autoUpload:!0,multi:!1,wasMulti:!1,onSelect:function(){},onStart:function(){},onComplete:function(){},name:$(e).attr("name")};if(n=$.extend(n,t),n.upload&&null==$(this).attr("key")){var r=new Date,i=r.getMilliseconds().toString()+r.getMinutes().toString()+r.getSeconds().toString()+Math.round(1e6*Math.random()).toString();n=$.extend(n,t),null==a?n.wasMulti=n.multi:n.wasMulti=!0,n.selector="[type=file][key="+i+"]",n.upload.indexOf("?")==-1?n.upload+="?":n.upload+="&",n.upload+="X-Progress-ID="+i,n.key=i,n.serverFileName_def=n.serverFileName,$(this).attr("key",i).change(function(){0==$("#submit_"+i).length&&($.form.intervals[i].onSelect($.form.intervals[i]),$(this).after("<input type=submit value='Загрузить' id=submit_"+i+" style='display:none;'>"),1==$.form.intervals[i].autoUpload&&$("#submit_"+i).click())}),$(this).wrap("<form key='"+i+'\' onsubmit="return $.form.uploadSelectedFile(this);" name=wfUpload_'+i+" action='"+n.upload+"' target=iframe_"+i+" enctype='multipart/form-data' method=post></form>"),$(this).parent().append("<input type=hidden name=key value='"+i+"'>"),$(this).before('<input type="hidden" name="UPLOAD_IDENTIFIER" value="'+i+'">');var o=$(this).parent(),s="<input type=hidden name='"+n.name+"_directory' key='"+i+"' value='"+n.directory+"'><input type=hidden name='"+n.name+"_serverFileName' key='"+i+"' value='"+n.serverFileName+"'><input type=hidden name='"+n.name+"_serverFileName_def' key='"+i+"' value='"+n.serverFileName_def+"'><input type=hidden name='"+n.name+"_path' key='"+i+"' value=''><input type=hidden name='inputName' key='"+i+"' value='"+n.name+"'><input type=hidden name='userParam' key='"+i+"' value='"+n.userParam+"'><input type=hidden name='"+n.name+"_isUploaded' key='"+i+"' value='0'><input type=hidden name='"+n.name+"_size' key='"+i+"' value=''><div uploaded=0 class=uploadDescr style='display:none' key='"+i+"'></div><iframe style='display:none;' onLoad=$.form.uploadComplete('"+i+"') name=iframe_"+i+" id=iframe_"+i+"></iframe>";$(o).append(s),null==$.form.intervals[i]&&($.form.intervals[i]=n)}})},uploadSelectedFile:function(e,t){var a={width:100,height:15};a=$.extend(a,t);var n=$(e).attr("key");$("#submit_"+n).attr("disabled","disabled");var r=$(e).children(".uploadDescr"),i={margin:"15px 0px"};$(r).html("<div class='progressbar ui-progressbar ui-widget ui-widget-content ui-corner-all' role='progressbar'><div class='ui-progressbar-value ui-widget-header ui-corner-left' style='display: block; width: 0%;'></div></div> <span style='text-align:right;' class=uploadedFileDetailInfo>Загрузка началась. Пожалуйста, подождите...</span>").css(i);var o=$(r).children("div.progressbar"),s=$($.form.intervals[n].selector).attr("value");s=s.split("\\"),$.form.intervals[n].realFileName=s[s.length-1],$.form.intervals[n].key=n,$.form.intervals[n].bar=o,$.form.intervals[n].span=r,r.show(),$($.form.intervals[n].span).attr("uploaded",0),$.form.intervals[n].onStart($.form.intervals[n]),$.form.intervals[n].interval=setInterval('$.form.uploadProgress("'+n+'")',1e3)},uploadProgress:function(key){$.form.intervals[key].progress&&$.ajax({error:function(e,t,a){},start:function(){},beforeSend:function(e){},url:$.form.intervals[key].progress,data:{"X-Progress-ID":key},dataType:"html",type:"get",success:function(data){if(data=eval(data),"uploading"==data.state){var total=data.size,bytes=data.received,percents=Math.round(100*bytes/total);$.form.intervals[key].size=total,$($.form.intervals[key].span).children(".uploadedFileDetailInfo").html("<b>"+percents+"%</b>, <i>загружено</i> <b>"+$.form.fsize(bytes)+"</b> <i>из</i> <b>"+$.form.fsize(total)+"</b>"),$.form.intervals[key].bar.children(".ui-progressbar-value").css("width",percents+"%")}data.result==-1&&($.form.intervals[key].size=data.size),0==data.result&&($.form.intervals[key].size=data.size,0==$($.form.intervals[key].span).attr("uploaded")&&$($.form.intervals[key].span).html("Сервер не поддерживает отображение процесса загрузки. Подождите завершения загрузки файла...")),$($.form.intervals[key].span).slideDown()}})},uploadCompleteAfterTimer:function(e){clearInterval($.form.intervals[e].interval);var t="false";$($.form.intervals[e].span).attr("uploaded",1),$("#submit_"+e).remove(),$(".uploadDescr[key="+e+"]").html("Загрузка завершена!");var a={size:t};$.form.intervals[e].onComplete(a),$(".customField").length>0&&core.customFieldChanged($(".customField").eq(0))},uploadComplete:function(e){setTimeout("$.form.uploadCompleteAfterTimer('"+e+"')",500)},intervals:{},fsize:function(e){return e=Math.round(e/1024),e<1e3?e+" Кб":(e=Math.round(100*e/1024)/100,e+" Мб")},speeds:function(e){return e=Math.round(e/1024),e<1e3?e+" Кб/сек":(e=Math.round(100*e/1024)/100,e+" Мб/сек")},str_replace:function(e,t,a,n){var r=0,i=0,o="",s="",c=0,l=0,u=[].concat(e),h=[].concat(t),d=a,p=h instanceof Array,f=d instanceof Array;for(d=[].concat(d),n&&(this.window[n]=0),r=0,c=d.length;r<c;r++)if(""!==d[r])for(i=0,l=u.length;i<l;i++)o=d[r]+"",s=p?void 0!==h[i]?h[i]:"":h[0],d[r]=o.split(u[i]).join(s),n&&d[r]!==o&&(this.window[n]+=(o.length-d[r].length)/u[i].length);return f?d:d[0]},set:function(e,t,a,n){if(null!=a){if($("."+e+"[name="+t+"][type=checkbox]").removeAttr("checked"),$("select."+e+"[name="+t+"]").children().removeAttr("selected"),$("."+e+"[name="+t+"][type=radio]").removeAttr("checked"),"object"!=typeof a&&(a=[a]),a.length<2)$("."+e+"[name="+t+"][type=text]").attr("value",a[0]),$("."+e+"[name="+t+"][type=password]").attr("value",a[0]),$("."+e+"[name="+t+"][type=hidden]").attr("value",a[0]),$("textarea."+e+"[name="+t+"]").attr("value",a[0]),$("select."+e+"[name="+t+"]").length>0&&$("select."+e+"[name="+t+"]").attr("value",a[0]);else for(var r=0;r<a.length;r++)$("."+e+"[name="+t+"][type=text]").eq(r).attr("value",a[r]),$("."+e+"[name="+t+"][type=password]").eq(r).attr("value",a[r]),$("."+e+"[name="+t+"][type=hidden]").eq(r).attr("value",a[r]),$("textarea."+e+"[name="+t+"]").eq(r).attr("value",a[r]),$("select."+e+"[name="+t+"]").length>0&&$("select."+e+"[name="+t+"]").eq(r).children("[value='"+a[r]+"']").attr("selected","selected");if($("input."+e+"[name="+t+"][type=radio]").length>0&&$("input."+e+"[name="+t+"][type=radio][value="+a[0]+"]").attr("checked","checked"),$("input."+e+"[name="+t+"][type=checkbox]").length>0)for(var r=0;r<=a.length;r++)$("input."+e+"[name="+t+"][type=checkbox][value='"+a[r]+"']").attr("checked","checked");n&&$("."+e+"[name="+t+"]").change()}}},function(){function e(){try{return s in i&&i[s]}catch(e){return!1}}function t(e){return function(){var t=Array.prototype.slice.call(arguments,0);t.unshift(n),l.appendChild(n),n.addBehavior("#default#userData"),n.load(s);var a=e.apply(r,t);return l.removeChild(n),a}}function a(e){return e.replace(h,"___")}var n,r={},i=window,o=i.document,s="localStorage",c="__storejs__";if(r.disabled=!1,r.set=function(e,t){},r.get=function(e){},r.remove=function(e){},r.clear=function(){},r.transact=function(e,t,a){var n=r.get(e);null==a&&(a=t,t=null),"undefined"==typeof n&&(n=t||{}),a(n),r.set(e,n)},r.getAll=function(){},r.serialize=function(e){return JSON.stringify(e)},r.deserialize=function(e){if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e||void 0}},e())n=i[s],r.set=function(e,t){return void 0===t?r.remove(e):(n.setItem(e,r.serialize(t)),t)},r.get=function(e){return r.deserialize(n.getItem(e))},r.remove=function(e){n.removeItem(e)},r.clear=function(){n.clear()},r.getAll=function(){for(var e={},t=0;t<n.length;++t){var a=n.key(t);e[a]=r.get(a)}return e};else if(o.documentElement.addBehavior){var l,u;try{u=new ActiveXObject("htmlfile"),u.open(),u.write('<script>document.w=window</script><iframe src="/favicon.ico"></frame>'),u.close(),l=u.w.frames[0].document,n=l.createElement("div")}catch(e){n=o.createElement("div"),l=o.body}var h=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");r.set=t(function(e,t,n){return t=a(t),void 0===n?r.remove(t):(e.setAttribute(t,r.serialize(n)),e.save(s),n)}),r.get=t(function(e,t){return t=a(t),r.deserialize(e.getAttribute(t))}),r.remove=t(function(e,t){t=a(t),e.removeAttribute(t),e.save(s)}),r.clear=t(function(e){var t=e.XMLDocument.documentElement.attributes;e.load(s);for(var a,n=0;a=t[n];n++)e.removeAttribute(a.name);e.save(s)}),r.getAll=t(function(e){for(var t,n=e.XMLDocument.documentElement.attributes,i={},o=0;t=n[o];++o){var s=a(t.name);i[t.name]=r.deserialize(e.getAttribute(s))}return i})}try{r.set(c,c),r.get(c)!=c&&(r.disabled=!0),r.remove(c)}catch(e){r.disabled=!0}r.enabled=!r.disabled,"undefined"!=typeof module&&"function"!=typeof module?module.exports=r:"function"==typeof define&&define.amd?define(r):this.store=r}(),!store.disabled)try{var key="__test";localStorage.setItem(key,1),localStorage.removeItem(key)}catch(e){store.disabled=!0}var supportStorage={data:{},isTemporary:function(){if(store.disabled)return!0;document.cookie="cookietest=1";var e=document.cookie.indexOf("cookietest=")!=-1;return document.cookie="cookietest=1; expires=Thu, 01-Jan-1970 00:00:01 GMT",!e},localStorageAcessible:function(){var e=!0;try{null==window.localStorage&&(e=!1)}catch(t){e=!1}return e},_isInited:!1,isInit:function(){return this._isInited},fromParent:!1,init:function(e){var t=this,a=!1;if("function"!=typeof e&&(e=function(){}),this.isTemporary()||!this.localStorageAcessible()){var n=RPC.callbacks.add(function(n){if(1==n.code)store.disabled=!1,t.fromParent=!0,t.data=n.values,t._isInited=!0,e();else{store.disabled=!0,chat.nodeAjax.send({url:"/loadLocalStorage",method:"POST",data:JSON.stringify({talkID:chat.siteParams.talkID,orgID:chat.siteParams.orgID,siteID:chat.siteParams.id})},function(n){if(n&&(n=JSON.parse(n)))for(var r in n)var i=t.set(r,n[r],!0);t._isInited=!0,a=!0,e()});var r=3e4;setTimeout(function(){a||(e(),e=function(){})},r)}});RPC.post("localStorage_getAll",{callbackID:n,setEvent:!0})}else t._isInited=!0,e()},get:function(e){if(this.fromParent||store.disabled){var t=this.data[e];return"object"==typeof t&&null!=t?JSON.parse(JSON.stringify(t)):t}return store.get(e)},setTimeout:!1,setData:[],_rememberStoreByThisTab:{},rememberStoreByThisTab:function(e,t){this._rememberStoreByThisTab[e]=t},checkStoreByThisTab:function(e,t){return this._rememberStoreByThisTab[e]==t},saveToServerTimeout:null,saveToServer:function(e,t){if(this.isTemporary()&&(!store.disabled&&JSON.stringify(store.get(e))!=JSON.stringify(t)||store.disabled&&JSON.stringify(this.data[e])!=JSON.stringify(t))){var a=this;a.setData.push([e,t]),a.saveToServerTimeout||(clearTimeout(a.saveToServerTimeout),a.saveToServerTimeout=setTimeout(function(){a.saveToServerTimeout=null,a.makeSet()},500))}},parentLocalStorageChanged:function(e,t){null==t?(this.data[e]=null,delete this.data[e]):this.data[e]=t;for(var a=0;a<this.listeners.length;a++)this.listeners[a]({key:e,newValue:null==t?null:JSON.stringify(t)})},set:function(e,t,a){if(a||this.saveToServer(e,t),store.disabled)this.data[e]=t;else{var n=chat.siteParams?chat.siteParams.id:null;if(this.rememberStoreByThisTab(e,t),this.fromParent||n&&e.indexOf(n)>-1){var r=RPC.callbacks.add(function(e){});this.data[e]=t,RPC.post("localStorage_set",{callbackID:r,key:e,value:t})}if(!this.fromParent)return store.set(e,t)}},makeSet:function(){var e=this,t=e.setData.length;if(t){for(var a={},n=0;n<t;n++){var r=e.setData.shift();a[r[0]]=r[1]}a=JSON.stringify(a),a.length&&"{}"!=a&&chat.nodeAjax.send({url:"/setLocalStorage",method:"POST",data:JSON.stringify({talkID:chat.siteParams.talkID,orgID:chat.siteParams.orgID,siteID:chat.siteParams.id,data:JSON.parse(a)})},function(e){})}},remove:function(e,t){if(t||this.saveToServer(e,null),store.disabled)null!=this.data[e]&&(this.data[e]=null,delete this.data[e]);else{if(!this.fromParent)return store.remove(e);this.data[e]=null,delete this.data[e];var a=RPC.callbacks.add(function(e){});RPC.post("localStorage_remove",{callbackID:a,key:e})}},getAll:function(){return store.disabled?this.data:store.getAll()},clearBySite:function(e,t){var a=[],n=this.get("talkIdList::"+e);n&&(a=JSON.parse(n));var r=t,i=this.getAll();for(var o in i)if(o.indexOf(r)!=-1){var s=!0;for(var c in a)if(o.indexOf(a[c])!=-1){s=!1;break}s&&this.remove(o)}},listeners:[],setListener:function(e){"function"!=typeof window.addEventListener||this.fromParent||window.addEventListener("storage",e),this.listeners.push(e)}},storeWithExpiration={set:function(e,t,a,n){supportStorage.set(e,{val:t,exp:a,time:chat.now(),l:n},n)},get:function(e){var t=supportStorage.get(e);return t?null!=t.exp&&null!=t.time&&null!=t.val&&parseInt(t.exp)>0&&chat.now()-t.time>parseInt(t.exp)?(this.remove(e,t.l),null):null==t.val?t:t.val:null},remove:function(e,t){supportStorage.remove(e,t)}};!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){"use strict";function t(e){return"string"==typeof e?parseInt(e,10):~~e}var a={wheelSpeed:1,wheelPropagation:!1,swipePropagation:!0,minScrollbarLength:null,maxScrollbarLength:null,useBothWheelAxes:!1,useKeyboard:!0,suppressScrollX:!1,suppressScrollY:!1,scrollXMarginOffset:0,scrollYMarginOffset:0,includePadding:!1,marginTop:0},n=0,r=function(){var e=n++;return function(t){var a=".perfect-scrollbar-"+e;return"undefined"==typeof t?a:t+a}},i="WebkitAppearance"in document.documentElement.style;e.fn.perfectScrollbar=function(n,o){var s=e(this);return chat.ie&&chat.ie<9?s.css({overflowY:"auto"}):this.each(function(){function c(e,a){var n=e+a,r=I-E;R=n<0?0:n>r?r:n;var i=t(R*(O-I)/(I-E));s.scrollTop(i)}function l(e,a){var n=e+a,r=P-A;N=n<0?0:n>r?r:n;var i=t(N*(D-P)/(P-A));s.scrollLeft(i)}function u(e){return $.minScrollbarLength&&(e=Math.max(e,$.minScrollbarLength)),$.maxScrollbarLength&&(e=Math.min(e,$.maxScrollbarLength)),e}function h(){var e={width:F};_?e.left=s.scrollLeft()+P-D:e.left=s.scrollLeft(),V?e.bottom=q-s.scrollTop():e.top=G+s.scrollTop(),B.css(e);var t={top:s.scrollTop(),height:j};Q?_?t.right=D-s.scrollLeft()-Y-K.outerWidth():t.right=Y-s.scrollLeft():_?t.left=s.scrollLeft()+2*P-D-Z-K.outerWidth():t.left=Z+s.scrollLeft(),J.css("margin-top",$.marginTop),J.css(t),U.css({left:N,width:A-z}),K.css({top:R,height:E-ee})}function d(){s.removeClass("ps-active-x"),s.removeClass("ps-active-y"),P=$.includePadding?s.innerWidth():s.width(),I=$.includePadding?s.innerHeight():s.height(),D=s.prop("scrollWidth"),O=s.prop("scrollHeight"),!$.suppressScrollX&&P+$.scrollXMarginOffset<D?(M=!0,F=P-X,A=u(t(F*P/D)),N=t(s.scrollLeft()*(F-A)/(D-P))):(M=!1,A=0,N=0,s.scrollLeft(0)),!$.suppressScrollY&&I+$.scrollYMarginOffset<O?(L=!0,j=I-te-$.marginTop,E=u(t(j*I/O)),R=t(s.scrollTop()*(j-E)/(O-I))):(L=!1,E=0,R=0,s.scrollTop(0)),N>=F-A&&(N=F-A),R>=j-E&&(R=j-E),h(),M&&s.addClass("ps-active-x"),L&&s.addClass("ps-active-y")}function p(){var t,a,n=function(e){l(t,e.pageX-a),d(),e.stopPropagation(),e.preventDefault()},r=function(t){B.removeClass("in-scrolling"),e(W).unbind(H("mousemove"),n)};U.bind(H("mousedown"),function(i){a=i.pageX,t=U.position().left,B.addClass("in-scrolling"),e(W).bind(H("mousemove"),n),e(W).one(H("mouseup"),r),i.stopPropagation(),i.preventDefault()}),t=a=null}function f(){var t,a,n=function(e){c(t,e.pageY-a),d(),e.stopPropagation(),e.preventDefault()},r=function(t){J.removeClass("in-scrolling"),e(W).unbind(H("mousemove"),n)};K.bind(H("mousedown"),function(i){a=i.pageY,t=K.position().top,J.addClass("in-scrolling"),e(W).bind(H("mousemove"),n),e(W).one(H("mouseup"),r),i.stopPropagation(),i.preventDefault()}),t=a=null}function m(e,t){var a=s.scrollTop();if(0===e){if(!L)return!1;if(0===a&&t>0||a>=O-I&&t<0)return!$.wheelPropagation}var n=s.scrollLeft();if(0===t){if(!M)return!1;if(0===n&&e<0||n>=D-P&&e>0)return!$.wheelPropagation}return!0}function g(e,t){var a=s.scrollTop(),n=s.scrollLeft(),r=Math.abs(e),i=Math.abs(t);if(i>r){if(t<0&&a===O-I||t>0&&0===a)return!$.swipePropagation}else if(r>i&&(e<0&&n===D-P||e>0&&0===n))return!$.swipePropagation;return!0}function v(){function e(e){var t=e.originalEvent.deltaX,a=-1*e.originalEvent.deltaY;return"undefined"!=typeof t&&"undefined"!=typeof a||(t=-1*e.originalEvent.wheelDeltaX/6,a=e.originalEvent.wheelDeltaY/6),e.originalEvent.deltaMode&&1===e.originalEvent.deltaMode&&(t*=10,a*=10),t!==t&&a!==a&&(t=0,a=e.originalEvent.wheelDelta),[t,a]}function t(t){if(i||!(s.find("select:focus").length>0)){var n=e(t),r=n[0],o=n[1];a=!1,$.useBothWheelAxes?L&&!M?(o?s.scrollTop(s.scrollTop()-o*$.wheelSpeed):s.scrollTop(s.scrollTop()+r*$.wheelSpeed),a=!0):M&&!L&&(r?s.scrollLeft(s.scrollLeft()+r*$.wheelSpeed):s.scrollLeft(s.scrollLeft()-o*$.wheelSpeed),a=!0):(s.scrollTop(s.scrollTop()-o*$.wheelSpeed),s.scrollLeft(s.scrollLeft()+r*$.wheelSpeed)),d(),a=a||m(r,o),a&&(t.stopPropagation(),t.preventDefault())}}var a=!1;"undefined"!=typeof window.onwheel?s.bind(H("wheel"),t):"undefined"!=typeof window.onmousewheel&&s.bind(H("mousewheel"),t)}function y(){var t=!1;s.bind(H("mouseenter"),function(e){t=!0}),s.bind(H("mouseleave"),function(e){t=!1});var a=!1;e(W).bind(H("keydown"),function(n){if((!n.isDefaultPrevented||!n.isDefaultPrevented())&&t){for(var r=document.activeElement?document.activeElement:W.activeElement;r.shadowRoot;)r=r.shadowRoot.activeElement;if(!e(r).is(":input,[contenteditable]")){var i=0,o=0;switch(n.which){case 37:i=-30;break;case 38:o=30;break;case 39:i=30;break;case 40:o=-30;break;case 33:o=90;break;case 32:case 34:o=-90;break;case 35:o=n.ctrlKey?-O:-I;break;case 36:o=n.ctrlKey?s.scrollTop():I;break;default:return}s.scrollTop(s.scrollTop()-o),s.scrollLeft(s.scrollLeft()+i),a=m(i,o),a&&n.preventDefault()}}})}function b(){function e(e){e.stopPropagation()}K.bind(H("click"),e),J.bind(H("click"),function(e){var a=t(E/2),n=e.pageY-J.offset().top-a,r=I-E,i=n/r;i<0?i=0:i>1&&(i=1),s.scrollTop((O-I)*i)}),U.bind(H("click"),e),B.bind(H("click"),function(e){var a=t(A/2),n=e.pageX-B.offset().left-a,r=P-A,i=n/r;i<0?i=0:i>1&&(i=1),s.scrollLeft((D-P)*i)})}function w(){function t(){var e=window.getSelection?window.getSelection():document.getSlection?document.getSlection():{rangeCount:0};return 0===e.rangeCount?null:e.getRangeAt(0).commonAncestorContainer}function a(){r||(r=setInterval(function(){return S()?(s.scrollTop(s.scrollTop()+i.top),s.scrollLeft(s.scrollLeft()+i.left),void d()):void clearInterval(r)},50))}function n(){r&&(clearInterval(r),r=null),B.removeClass("in-scrolling"),J.removeClass("in-scrolling")}var r=null,i={top:0,left:0},o=!1;e(W).bind(H("selectionchange"),function(a){e.contains(s[0],t())?o=!0:(o=!1,n())}),e(window).bind(H("mouseup"),function(e){o&&(o=!1,n())}),e(window).bind(H("mousemove"),function(e){if(o){var t={x:e.pageX,y:e.pageY},r=s.offset(),c={left:r.left,right:r.left+s.outerWidth(),top:r.top,bottom:r.top+s.outerHeight()};t.x<c.left+3?(i.left=-5,B.addClass("in-scrolling")):t.x>c.right-3?(i.left=5,B.addClass("in-scrolling")):i.left=0,t.y<c.top+3?(c.top+3-t.y<5?i.top=-5:i.top=-20,J.addClass("in-scrolling")):t.y>c.bottom-3?(t.y-c.bottom+3<5?i.top=5:i.top=20,J.addClass("in-scrolling")):i.top=0,0===i.top&&0===i.left?n():a()}})}function C(t,a){function n(e,t){s.scrollTop(s.scrollTop()-t),s.scrollLeft(s.scrollLeft()-e),d()}function r(e){y=!0}function i(e){y=!1}function o(e){return e.originalEvent.targetTouches?e.originalEvent.targetTouches[0]:e.originalEvent}function c(e){var t=e.originalEvent;return!(!t.targetTouches||1!==t.targetTouches.length)||!(!t.pointerType||"mouse"===t.pointerType||t.pointerType===t.MSPOINTER_TYPE_MOUSE)}function l(e){if(c(e)){b=!0;var t=o(e);p.pageX=t.pageX,p.pageY=t.pageY,f=chat.now(),null!==v&&clearInterval(v),e.stopPropagation()}}function u(e){if(!y&&b&&c(e)){var t=o(e),a={pageX:t.pageX,pageY:t.pageY},r=a.pageX-p.pageX,i=a.pageY-p.pageY;n(r,i),p=a;var s=chat.now(),l=s-f;l>0&&(m.x=r/l,m.y=i/l,f=s),g(r,i)&&(e.stopPropagation(),$h.hasClass("inlineSupportWindow")||e.preventDefault())}}function h(e){!y&&b&&(b=!1,clearInterval(v),v=setInterval(function(){return S()?Math.abs(m.x)<.01&&Math.abs(m.y)<.01?void clearInterval(v):(n(30*m.x,30*m.y),m.x*=.8,void(m.y*=.8)):void clearInterval(v)},10))}var p={},f=0,m={},v=null,y=!1,b=!1;t&&(e(window).bind(H("touchstart"),r),e(window).bind(H("touchend"),i),s.bind(H("touchstart"),l),s.bind(H("touchmove"),u),s.bind(H("touchend"),h)),a&&(window.PointerEvent?(e(window).bind(H("pointerdown"),r),e(window).bind(H("pointerup"),i),s.bind(H("pointerdown"),l),s.bind(H("pointermove"),u),s.bind(H("pointerup"),h)):window.MSPointerEvent&&(e(window).bind(H("MSPointerDown"),r),e(window).bind(H("MSPointerUp"),i),s.bind(H("MSPointerDown"),l),s.bind(H("MSPointerMove"),u),s.bind(H("MSPointerUp"),h)))}function T(){s.bind(H("scroll"),function(e){d()})}function k(){s.unbind(H()),e(window).unbind(H()),e(W).unbind(H()),s.data("perfect-scrollbar",null),s.data("perfect-scrollbar-update",null),s.data("perfect-scrollbar-destroy",null),U.remove(),K.remove(),B.remove(),J.remove(),s=B=J=U=K=M=L=P=I=D=O=A=N=q=V=G=E=R=Y=Q=Z=_=H=null}function x(){d(),T(),p(),f(),b(),w(),v(),(ae||ne)&&C(ae,ne),$.useKeyboard&&y(),s.data("perfect-scrollbar",s),s.data("perfect-scrollbar-update",d),s.data("perfect-scrollbar-destroy",k)}var $=e.extend(!0,{},a);$h.hasClass("inlineSupportWindow")||s.bind("touchmove",function(e){e.preventDefault()});var S=function(){return!!s};if("object"==typeof n?e.extend(!0,$,n):o=n,"update"===o)return s.data("perfect-scrollbar-update")&&s.data("perfect-scrollbar-update")(),s;if("destroy"===o)return s.data("perfect-scrollbar-destroy")&&s.data("perfect-scrollbar-destroy")(),s;if(s.data("perfect-scrollbar"))return s.data("perfect-scrollbar");s.addClass("ps-container");var P,I,D,O,M,A,N,F,L,E,R,j,_="rtl"===s.css("direction"),H=r(),W=this.ownerDocument||document,B=e("<div class='ps-scrollbar-x-rail'>").appendTo(s),U=e("<div class='ps-scrollbar-x'>").appendTo(B),q=t(B.css("bottom")),V=q===q,G=V?null:t(B.css("top")),z=t(B.css("borderLeftWidth"))+t(B.css("borderRightWidth")),X=t(B.css("marginLeft"))+t(B.css("marginRight")),J=e("<div class='ps-scrollbar-y-rail'>").appendTo(s),K=e("<div class='ps-scrollbar-y'>").appendTo(J),Y=t(J.css("right")),Q=Y===Y,Z=Q?null:t(J.css("left")),ee=t(J.css("borderTopWidth"))+t(J.css("borderBottomWidth")),te=t(J.css("marginTop"))+t(J.css("marginBottom")),ae="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,ne=null!==window.navigator.msMaxTouchPoints;return x(),s})}}),$.fn.hasParent=function(e){e=$(e);var t=!1;return $(this[0]).parents().andSelf().each(function(){if($.inArray(this,e)!=-1)return t=!0,!1}),t},$(window).resize(function(){chat.windowResize()}),$d.ready(function(){$("[contenteditable]").live("paste",function(e){function t(e){window.document.execCommand("insertText",!1,e)}if(e.clipboardData||e.originalEvent&&e.originalEvent.clipboardData){e.preventDefault();var a=($(this),(e.clipboardData||e.originalEvent.clipboardData).items),n=[];for(index in a){var r=a[index];"file"===r.kind&&0==r.type.indexOf("image/")&&n.push(r)}var i=(e.originalEvent||e).clipboardData.getData("text/plain");if(i&&!n.length)t(i);else for(index in n){var r=n[index];if("file"===r.kind&&0==r.type.indexOf("image/")){var o="image.jpg",s=r.getAsFile(),c=new FileReader;c.onload=function(e){if(e.target.result){var a=$("<img />").attr("src",e.target.result);$("#uploadingImage").attr("src",e.target.result),$("#uploadingImages").fadeIn(),a.bind("load",function(){var e=convertImageToCanvas(this,1200),a=convertCanvasToImage(e,"jpeg",.5);a&&a.src&&(setTimeout(function(){$("#uploadingImages").fadeOut()},6e4),setTimeout(function(){$.post("/LAPI/misc/fileShare.php?action=upload",{filename:o,org:chat.siteParams.orgID,base64:a.src.split("base64,")[1]},function(e){if($("#uploadingImages").fadeOut(),1==e.code){var a=e.fullURL;t(a)}else chat.alert.show(e)},"json")},1e3))})}},c.readAsDataURL(s)}}}}),$(".dropdown-toggle").live("click",function(e){var t=$(this).data("dropdown");t?"string"==typeof t&&(t=$("#"+$(this).data("dropdown"))):t=$(this).next(".dropdown");var a=t.hasClass("dropdown-show");$(".dropdown-show").removeClass("dropdown-show").trigger("dropdown-hide"),a||(t.parent().hasClass("dropdown-toggle")?(t.hasClass("dropdown-right")?t.css("left",$(this).outerWidth()-t.outerWidth()):t.css("left",0),t.hasClass("dropdown-top")?t.css("bottom",$(this).outerHeight()+1):t.css("top",$(this).outerHeight()+1)):(t.hasClass("dropdown-right")?t.css("left",$(this).position().left+$(this).outerWidth()-t.outerWidth()):t.css("left",$(this).position().left),t.hasClass("dropdown-top")?t.css("bottom",$(this).position().top+$(this).outerHeight()+1):t.css("top",$(this).position().top+$(this).outerHeight()+1)),t.toggleClass("dropdown-show").trigger("dropdown-show")),e.stopPropagation()}),$("*").live("click",function(e){!$(this).not(".dropdown-toggle")||$(this).hasParent(".dropdown-toggle")||$(this).hasParent(".dropdown")?$(this).parent().is(".dropdown")&&e.stopPropagation():$(".dropdown-show").removeClass("dropdown-show").trigger("dropdown-hide")}),$(".bottom-tabs > ul > li").live("click",function(){$(this).hasClass("selected")||($(this).parent().children(".selected").removeClass("selected"),$(this).addClass("selected"),interfaceTabs.select($(this).data("id")))})});var interfaceTabs={select:function(e){var t=$("#"+e);if(t.length){var a=t.parent().children(".selected:not(#"+e+")");a.removeClass("selected"),$.each(a,function(){$(this).data("clear")&&$(this).empty()}),t.addClass("selected")}}};if(Date.prototype.toMysqlFormat=function(){return this.getFullYear()+"-"+twoDigits(1+this.getMonth())+"-"+twoDigits(this.getDate())+" "+twoDigits(this.getHours())+":"+twoDigits(this.getMinutes())+":"+twoDigits(this.getSeconds())},null==window.emojione)var emojione={unicodeToImage:function(e){return e},toShort:function(e){return e},toImage:function(e){return e},shortnameToUnicode:function(e){return e}};$.fn.calculateFirstVisible=function(e){return $.each(this,function(){e||(e=":not(.none)");var t=$(this).parent().children();if(t.length){t.removeClass("firstVisible lastVisible");var a=t.filter(e);a.length?(a.first().addClass("firstVisible"),a.last().addClass("lastVisible")):$(this).parent().addClass("none")}}),this},$.fn.myShow=function(){return $(this).removeClass("none").parent().removeClass("none"),$.each(this,function(){$(this).calculateFirstVisible()}),this},$.fn.myHide=function(){return $(this).addClass("none"),$.each(this,function(){$(this).calculateFirstVisible()}),this},$.fn.myToggle=function(){return $(this).toggleClass("none"),$.each(this,function(){$(this).calculateFirstVisible()}),this},jQuery.cachedScript=function(e,t){return t=$.extend(t||{},{dataType:"script",cache:!0,url:e}),jQuery.ajax(t)},window.emojiList=[{id:"smiles",icon:"icon-child",descr:"Смайлики",list:["😀","😬","😁","😂","😃","😄","😅","😆","😇","😉","😊","🙂","🙃","☺️","😋","😌","😍","😘","😗","😙","😚","😜","😝","😛","🤑","🤓","😎","🤗","😏","😶","😐","😑","😒","🙄","🤔","😳","😞","😟","😠","😡","😔","😕","🙁","☹️","😣","😖","😫","😩","😤","😮","😱","😨","😰","😯","😦","😧","😢","😥","😪","😓","😭","😵","😲","🤐","😷","🤒","🤕","😴","💤","💩","😈","👿","👍","👊","✊","✌️","👌","💋"]},{id:"nature",icon:"icon-tree",descr:"Животные и природа",list:["🐶","🐱","🐭","🐹","🐰","🐻","🐼","🐨","🐯","🦁","🐮","🐷","🐽","🐸","🐙","🐵","🙈","🙉","🙊","🐒","🐔","🐧","🐦","🐤","🐣","🐥","🐺","🐗","🐴","🦄","🐝","🐛","🐌","🐞","🐜","🕷","🦂","🦀","🐍","🐢","🐠","🐟","🐡","🐬","🐳"]},{id:"food",icon:"icon-glass",descr:"Еда и напитки",list:["🍏","🍎","🍐","🍊","🍋","🍌","🍉","🍇","🍓","🍈","🍒","🍑","🍍","🍅","🍆","🌶","🌽","🍠","🍯","🍞","🧀","🍗","🍖","🍤","🍳","🍔","🍟","🌭","🍕","🍝","🌮","🌯","🍜","🍲","🍥","🍣","🍱","🍛","🍙","🍚","🍘","🍢","🍡","🍧","🍨","🍦","🍰","🎂","🍮","🍬","🍭","🍫","🍿","🍩","🍪","🍺","🍻","🍷","🍸","🍹","🍾","🍶","🍵","☕️","🍼","🍴","🍽"]},{id:"sport",icon:"icon-futbol-o",descr:"Увлечения и спорт",list:["⚽️","🏀","🏈","⚾️","🎾","🏐","🏉","🎱","⛳️","🏌","🏓","🏸","🏒","🏑","🏏","🎿","⛷","🏂","⛸","🏹","🎣","🚣","🏊","🏄","🛀","⛹","🏋","🚴","🚵","🏇","🕴","🏆","🎽","🏅","🎖","🎗","🏵","🎫","🎟","🎭","🎨","🎪","🎤","🎧","🎼","🎹","🎷","🎺","🎸","🎻","🎬","🎮","👾","🎯","🎲","🎰","🎳"]}],!function(e,t,a,n,r,i){function o(e,t){var a=typeof e[t];return"function"==a||!("object"!=a||!e[t])||"unknown"==a}function s(e,t){return!("object"!=typeof e[t]||!e[t])}function c(e){return"[object Array]"===Object.prototype.toString.call(e)}function l(){if(!_){_=!0;for(var e=0;e<H.length;e++)H[e]();H.length=0}}function u(e,t){return _?void e.call(t):void H.push(function(){e.call(t)})}function h(){var e=parent;if(""!==N)for(var t=0,a=N.split(".");t<a.length;t++)e=e[a[t]];return e.easyXDM}function d(t){return e.easyXDM=L,N=t,N&&(E="easyXDM_"+N.replace(".","_")+"_"),F}function p(e){var t=e.toLowerCase().match(O),a=t[2],n=t[3],r=t[4]||"";return("http:"==a&&":80"==r||"https:"==a&&":443"==r)&&(r=""),a+"//"+n+r}function f(e){if(e=e.replace(A,"$1/"),!e.match(/^(http||https):\/\//)){var t="/"===e.substring(0,1)?"":a.pathname;"/"!==t.substring(t.length-1)&&(t=t.substring(0,t.lastIndexOf("/")+1)),e=a.protocol+"//"+a.host+t+e}for(;M.test(e);)e=e.replace(M,"");return e}function m(e,t){var a="",n=e.indexOf("#");-1!==n&&(a=e.substring(n),e=e.substring(0,n));var r=[];for(var o in t)t.hasOwnProperty(o)&&r.push(o+"="+i(t[o]));return e+(R?"#":-1==e.indexOf("?")?"?":"&")+r.join("&")+a}function g(e){return void 0===e}function v(e,t,a){var n;for(var r in t)t.hasOwnProperty(r)&&(r in e?(n=t[r],"object"==typeof n?v(e[r],n,a):a||(e[r]=t[r])):e[r]=t[r]);return e}function y(){var e=t.body.appendChild(t.createElement("form")),a=e.appendChild(t.createElement("input"));a.name=E+"TEST"+I,x=a!==e.elements[a.name],t.body.removeChild(e)}function b(e){g(x)&&y();var a;x?a=t.createElement('<iframe name="'+e.props.name+'"/>'):(a=t.createElement("IFRAME"),a.name=e.props.name),a.id=a.name=e.props.name,delete e.props.name,"string"==typeof e.container&&(e.container=t.getElementById(e.container)),e.container||(v(a.style,{position:"absolute",top:"-2000px",left:"0px"}),e.container=t.body);var n=e.props.src;if(e.props.src="javascript:false",v(a,e.props),a.border=a.frameBorder=0,a.allowTransparency=!0,e.container.appendChild(a),e.onLoad&&$(a,"load",e.onLoad),e.usePost){var r,i=e.container.appendChild(t.createElement("form"));if(i.target=a.name,i.action=n,i.method="POST","object"==typeof e.usePost)for(var o in e.usePost)e.usePost.hasOwnProperty(o)&&(x?r=t.createElement('<input name="'+o+'"/>'):(r=t.createElement("INPUT"),r.name=o),r.value=e.usePost[o],i.appendChild(r));i.submit(),i.parentNode.removeChild(i)}else a.src=n;return e.props.src=n,a}function w(e,t){"string"==typeof e&&(e=[e]);for(var a,n=e.length;n--;)if(a=e[n],a=RegExp("^"==a.substr(0,1)?a:"^"+a.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"),a.test(t))return!0;return!1}function C(n){var r,i=n.protocol;if(n.isHost=n.isHost||g(B.xdm_p),
R=n.hash||!1,n.props||(n.props={}),n.isHost)n.remote=f(n.remote),n.channel=n.channel||"default"+I++,n.secret=Math.random().toString(16).substring(2),g(i)&&(i=p(a.href)==p(n.remote)?"4":o(e,"postMessage")||o(t,"postMessage")?"1":"0");else if(n.channel=B.xdm_c.replace(/["'<>\\]/g,""),n.secret=B.xdm_s,n.remote=B.xdm_e.replace(/["'<>\\]/g,""),i=B.xdm_p,n.acl&&!w(n.acl,n.remote))throw Error("Access denied for "+n.remote);switch(n.protocol=i,i){case"1":r=[new F.stack.PostMessageTransport(n)];break;case"4":r=[new F.stack.SameOriginTransport(n)]}return r.push(new F.stack.QueueBehavior({lazy:n.lazy,remove:!0})),r}function T(e){for(var t,a={incoming:function(e,t){this.up.incoming(e,t)},outgoing:function(e,t){this.down.outgoing(e,t)},callback:function(e){this.up.callback(e)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}},n=0,r=e.length;r>n;n++)t=e[n],v(t,a,!0),0!==n&&(t.down=e[n-1]),n!==r-1&&(t.up=e[n+1]);return t}function k(e){e.up.down=e.down,e.down.up=e.up,e.up=e.down=null}var x,$,S,P=this,I=Math.floor(1e4*Math.random()),D=Function.prototype,O=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,M=/[\-\w]+\/\.\.\//,A=/([^:])\/\//g,N="",F={},L=e.easyXDM,E="easyXDM_",R=!1;if(o(e,"addEventListener"))$=function(e,t,a){e.addEventListener(t,a,!1)},S=function(e,t,a){e.removeEventListener(t,a,!1)};else{if(!o(e,"attachEvent"))throw Error("Browser not supported");$=function(e,t,a){e.attachEvent("on"+t,a)},S=function(e,t,a){e.detachEvent("on"+t,a)}}var j,_=!1,H=[];if("readyState"in t?(j=t.readyState,_="complete"==j||~navigator.userAgent.indexOf("AppleWebKit/")&&("loaded"==j||"interactive"==j)):_=!!t.body,!_){if(o(e,"addEventListener"))$(t,"DOMContentLoaded",l);else if($(t,"readystatechange",function(){"complete"==t.readyState&&l()}),t.documentElement.doScroll&&e===top){var W=function(){if(!_){try{t.documentElement.doScroll("left")}catch(e){return void n(W,1)}l()}};W()}$(e,"load",l)}var B=function(e){e=e.substring(1).split("&");for(var t,a={},n=e.length;n--;)t=e[n].split("="),a[t[0]]=r(t[1]);return a}(/xdm_e=/.test(a.search)?a.search:a.hash),U=function(){var e={},t={a:[1,2,3]},a='{"a":[1,2,3]}';return"undefined"!=typeof JSON&&"function"==typeof JSON.stringify&&JSON.stringify(t).replace(/\s/g,"")===a?JSON:(Object.toJSON&&Object.toJSON(t).replace(/\s/g,"")===a&&(e.stringify=Object.toJSON),"function"==typeof String.prototype.evalJSON&&(t=a.evalJSON(),t.a&&3===t.a.length&&3===t.a[2]&&(e.parse=function(e){return e.evalJSON()})),e.stringify&&e.parse?(U=function(){return e},e):null)};v(F,{version:"2.4.20.7",query:B,stack:{},apply:v,getJSONObject:U,whenReady:u,noConflict:d}),F.DomHelper={on:$,un:S,requiresJSON:function(a){s(e,"JSON")||t.write('<script type="text/javascript" src="'+a+'"></script>')}},function(){var e={};F.Fn={set:function(t,a){e[t]=a},get:function(t,a){if(e.hasOwnProperty(t)){var n=e[t];return a&&delete e[t],n}}}}(),F.Socket=function(e){var t=T(C(e).concat([{incoming:function(t,a){e.onMessage(t,a)},callback:function(t){e.onReady&&e.onReady(t)}}])),a=p(e.remote);this.origin=p(e.remote),this.destroy=function(){t.destroy()},this.postMessage=function(e){t.outgoing(e,a)},t.init()},F.Rpc=function(e,t){if(t.local)for(var a in t.local)if(t.local.hasOwnProperty(a)){var n=t.local[a];"function"==typeof n&&(t.local[a]={method:n})}var r=T(C(e).concat([new F.stack.RpcBehavior(this,t),{callback:function(t){e.onReady&&e.onReady(t)}}]));this.origin=p(e.remote),this.destroy=function(){r.destroy()},r.init()},F.stack.SameOriginTransport=function(e){var t,r,i,o;return t={outgoing:function(e,t,a){i(e),a&&a()},destroy:function(){r&&(r.parentNode.removeChild(r),r=null)},onDOMReady:function(){o=p(e.remote),e.isHost?(v(e.props,{src:m(e.remote,{xdm_e:a.protocol+"//"+a.host+a.pathname,xdm_c:e.channel,xdm_p:4}),name:E+e.channel+"_provider"}),r=b(e),F.Fn.set(e.channel,function(e){return i=e,n(function(){t.up.callback(!0)},0),function(e){t.up.incoming(e,o)}})):(i=h().Fn.get(e.channel,!0)(function(e){t.up.incoming(e,o)}),n(function(){t.up.callback(!0)},0))},init:function(){u(t.onDOMReady,t)}}},F.stack.PostMessageTransport=function(t){function r(e){if(e.origin)return p(e.origin);if(e.uri)return p(e.uri);if(e.domain)return a.protocol+"//"+e.domain;throw"Unable to retrieve the origin of the event"}function i(e){if("string"==typeof e.data){var a=r(e);a==h&&e.data.substring(0,t.channel.length+1)==t.channel+" "&&s.up.incoming(e.data.substring(t.channel.length+1),a)}}function o(a){a.data==t.channel+"-ready"&&(l="postMessage"in c.contentWindow?c.contentWindow:c.contentWindow.document,S(e,"message",o),$(e,"message",i),n(function(){s.up.callback(!0)},0))}var s,c,l,h;return s={outgoing:function(e,a,n){l.postMessage(t.channel+" "+e,a||h),n&&n()},destroy:function(){S(e,"message",o),S(e,"message",i),c&&(l=null,c.parentNode.removeChild(c),c=null)},onDOMReady:function(){h=p(t.remote),t.isHost?($(e,"message",o),v(t.props,{src:m(t.remote,{xdm_e:p(a.href),xdm_c:t.channel,xdm_p:1}),name:E+t.channel+"_provider"}),c=b(t)):($(e,"message",i),l="postMessage"in e.parent?e.parent:e.parent.document,l.postMessage(t.channel+"-ready",h),n(function(){s.up.callback(!0)},0))},init:function(){u(s.onDOMReady,s)}}},F.stack.ReliableBehavior=function(){var e,t,a=0,n=0,r="";return e={incoming:function(i,o){var s=i.indexOf("_"),c=i.substring(0,s).split(",");i=i.substring(s+1),c[0]==a&&(r="",t&&t(!0)),i.length>0&&(e.down.outgoing(c[1]+","+a+"_"+r,o),n!=c[1]&&(n=c[1],e.up.incoming(i,o)))},outgoing:function(i,o,s){r=i,t=s,e.down.outgoing(n+","+ ++a+"_"+i,o)}}},F.stack.QueueBehavior=function(e){function t(){if(e.remove&&0===s.length)return void k(a);if(!c&&0!==s.length&&!o){c=!0;var r=s.shift();a.down.outgoing(r.data,r.origin,function(e){c=!1,r.callback&&n(function(){r.callback(e)},0),t()})}}var a,o,s=[],c=!0,l="",u=0,h=!1,d=!1;return a={init:function(){g(e)&&(e={}),e.maxLength&&(u=e.maxLength,d=!0),e.lazy?h=!0:a.down.init()},callback:function(e){c=!1;var n=a.up;t(),n.callback(e)},incoming:function(t,n){if(d){var i=t.indexOf("_"),o=parseInt(t.substring(0,i),10);l+=t.substring(i+1),0===o&&(e.encode&&(l=r(l)),a.up.incoming(l,n),l="")}else a.up.incoming(t,n)},outgoing:function(n,r,o){e.encode&&(n=i(n));var c,l=[];if(d){for(;0!==n.length;)c=n.substring(0,u),n=n.substring(c.length),l.push(c);for(;c=l.shift();)s.push({data:l.length+"_"+c,origin:r,callback:0===l.length?o:null})}else s.push({data:n,origin:r,callback:o});h?a.down.init():t()},destroy:function(){o=!0,a.down.destroy()}}},F.stack.VerifyBehavior=function(e){function t(){n=Math.random().toString(16).substring(2),a.down.outgoing(n)}var a,n,r;return a={incoming:function(i,o){var s=i.indexOf("_");-1===s?i===n?a.up.callback(!0):r||(r=i,e.initiate||t(),a.down.outgoing(i)):i.substring(0,s)===r&&a.up.incoming(i.substring(s+1),o)},outgoing:function(e,t,r){a.down.outgoing(n+"_"+e,t,r)},callback:function(){e.initiate&&t()}}},F.stack.RpcBehavior=function(e,t){function a(e){e.jsonrpc="2.0",i.down.outgoing(o.stringify(e))}function n(e,t){var n=Array.prototype.slice;return function(){var r,i=arguments.length,o={method:t};i>0&&"function"==typeof arguments[i-1]?(i>1&&"function"==typeof arguments[i-2]?(r={success:arguments[i-2],error:arguments[i-1]},o.params=n.call(arguments,0,i-2)):(r={success:arguments[i-1]},o.params=n.call(arguments,0,i-1)),l[""+ ++s]=r,o.id=s):o.params=n.call(arguments,0),e.namedParams&&1===o.params.length&&(o.params=o.params[0]),a(o)}}function r(e,t,n,r){if(!n)return void(t&&a({id:t,error:{code:-32601,message:"Procedure not found."}}));var i,o;t?(i=function(e){i=D,a({id:t,result:e})},o=function(e,n){o=D;var r={id:t,error:{code:-32099,message:e}};n&&(r.error.data=n),a(r)}):i=o=D,c(r)||(r=[r]);try{var s=n.method.apply(n.scope,r.concat([i,o]));g(s)||i(s)}catch(e){o(e.message)}}var i,o=t.serializer||U(),s=0,l={};return i={incoming:function(e){var n=o.parse(e);if(n.method)t.handle?t.handle(n,a):r(n.method,n.id,t.local[n.method],n.params);else{var i=l[n.id];n.error?i.error&&i.error(n.error):i.success&&i.success(n.result),delete l[n.id]}},init:function(){if(t.remote)for(var a in t.remote)t.remote.hasOwnProperty(a)&&(e[a]=n(t.remote[a],a));i.down.init()},destroy:function(){for(var a in t.remote)t.remote.hasOwnProperty(a)&&e.hasOwnProperty(a)&&delete e[a];i.down.destroy()}}},P.easyXDM=F}(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent);
